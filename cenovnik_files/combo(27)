YUI.add("mail-ui-convpane-bind",function(D){D.namespace("mail.ui");var A=D.mail.ui._ConvPane,C=A.prototype;var B=function(F,E){var G=this;D.use("mail-ui-proxyevents",function(){D.mail.ui.MailEventsProxy.handleUI({action:E},G.getMsgFid(F),null,[F]);});};C.handleUI=B;},"1.0.0");YUI.add("mail-ui-mailpane-read",function(e){function r(e,t,n){var r=this,i,o;n=n||r.message,o={fid:r.fid,mid:n.mid,pid:e},i=n.nonImgAttachments;for(var u=0;u<i.length;u++){var a=i[u];(a.type==="message"||a.type==="text")&&a.partId==e&&(o.filename=a.filename)}typeof t!="undefined"&&t!==""&&t!=="null"&&(o.tnefid=t),s([o])}function i(e,t,n){var r=this,i,o=[],u,a;n=n||r.message,u={image:n.imgAttachments,"non-image":n.nonImgAttachments,all:n.attachments},a=u[e]||[];for(var f=0;f<a.length;f++){var l=a[f],c={fid:r.fid,mid:n.mid,pid:l.partId},h=l.tnefId;if(l.type==="message"||l.type==="text")c.filename=l.filename;typeof h!="undefined"&&(c.tnefid=h),o.push(c)}t&&t.target&&(t.target.get("nodeName")==="A"?i={restoreFocusNode:t.target}:i={restoreFocusNode:t.target.ancestor("A")}),o.length&&s(o,i)}function s(n,r){e.use("mail-common-downloader-v"+(NeoConfig.downloaderVersion||"1"),function(){t.common.downloader.render(n,r)})}function o(){e.fire("openOptions",{view:"security"})}function u(n,r,i){var s=this,o,u;i=i||s.fid,r=r||s.message;if(r&&!s.loading_slow&&!s.loading_error&&!s.loading_moved&&!r.flags.isRead){o=e.mail.persist.MetaData.get("cg.pref.general.markasreadinterval");if(o!="999")return o=o?parseInt(o,10)*1e3:750,isNaN(o)&&(o=750),u=o===0,e.use("mail-controller-messages-ops",function(){var e=function(){var e=t.Controller.batch();return e.Messages.flag({fid:i,mid:r,setFlags:{read:1},enableRetry:!0},{suppressCodes:["*"]}),e};u||(s.tmFireRead&&(clearTimeout(s.tmFireRead),s.tmFireRead=null),s.tmFireRead=setTimeout(function(){var t=e&&e();t&&t.execute()},o)),n&&n(u?e:null)}),!0}return!1}function a(t,n){var r={metaKey:n.metaKey,ctrlKey:n.ctrlKey,altKey:n.altKey,shiftKey:n.shiftKey};e.UA.ie>=12?window.open("/neo/rd?url="+window.encodeURIComponent(t.get("href"))+"&ncrumb="+NeoConfig.ncrumb):t.simulate("click",r)}function f(t){var n=t.target,r=n.get("parentNode"),i=null;n.hasAttribute("ymailto")?i=n.getAttribute("ymailto"):r.hasAttribute("ymailto")&&(i=r.getAttribute("ymailto")),i&&i.length>0&&(t.preventDefault(),e.use("mail-ui-shortcuts",function(e){e.mail.ui.ShortCuts.composeMailToMessage(i)})),NeoConfig.isWinApp||(n.test("a[rel=nofollow]")?(n.setAttribute("rel","noreferrer"),t.preventDefault(),a(n,t)):r.test("a[rel=nofollow]")&&(r.setAttribute("rel","noreferrer"),t.preventDefault(),a(r,t)))}e.namespace("mail.ui");var t=e.mail,n=function(){};e.mix(n.prototype,{bindPaneContent:function(){},onSuccess:function(){},setFullFormatters:function(){},postRender:function(){},downloadAttachment:r,downloadAllAttachments:i,loadOptions:o,markAsRead:u,handleBodyLinkClick:f}),e.mail.ui.MailPaneRead=n},"1.0.0",{requires:["mail-ui-common-string-utils","common-utils","common-utils-stats","mail-controller-base"]});
YUI.add("mail-ui-messagepane-warnings",function(e){function r(e){return window.confirm(t([n.str_warning_msg_read_form_part1,n.str_warning_msg_read_form_part2].join("  "),n))&&e.submit(),!1}function i(e){return e.rel==="nofollow"?!0:strings.str_cfg_tog_exlink_alert_page?(window.open(strings.str_cfg_url_exlink_alert_page+encodeURIComponent(e),"new"),!1):(window.confirm(t([n.str_warning_msg_read_link_part1,n.str_warning_msg_read_link_part2,n.str_warning_msg_read_link_part3].join("  "),n))&&window.open(e.href),!1)}function s(e){e.warningShown||(window.alert(t([n.str_warning_msg_read_password_part1,n.str_warning_msg_read_password_part2].join("  "),n)),e.warningShown=1)}e.namespace("mail.ui");var t=e.common.Utils.substitute,n=strings;e.mail.ui.Warnings={showFormWarning:r,showLinkWarning:i,showPasswordWarning:s},window.theMainWindow=e.mail.ui.Warnings},"1.0.0",{requires:["common-utils"]});
YUI.add("mail-ui-convpane-read",function(e){function K(t,n){var r=[];return e.Array.each(t.slice(n,t.length),function(e){r.push(e.email)}),r.join(",")}function Q(e){var t={to:p.getName(e),rcpt_id:p.getAddress(e),rcpt_name:p.getName(e)};return t}function G(e,t,n,i){var s=e&&e.header,o=f.recipient_list,u=f.more_recipients_str,a=f.hide_recipients_str,l="",c=["to","cc","bcc"],h,d,v,m,g,y,b;i=i||[];if(s){for(d=0;d<c.length;d++)v=c[d],b=s[v]||[],h=f[v+"_group"],g=i[v]||!1,y=g?"":n+1===b.length?b.length:n,b.length&&(m={recipients_built:p.createRecipientList(b,o,t,y,Q,""),hide:U&&g&&(!y||b.length>parseInt(y,10))?r(a,{data_field:v},0,0,strings):"",more_built:!g&&b.length>parseInt(y,10)?r(u,{num_more_recipients:b.length-y,data_address:K(b,y),data_field:v},0,0,strings):""},l+=r(h,m,null,null,strings));return l}}function Y(){e.fire("recalculateScrollToRepositionSend")}function Z(e){var t=this,n=e.srvmap,r,i,s="";if(!n){i=t.inboxservices||[],e.srvmap=n={};for(r=i.length-1;r>=0;r--)n[i[r].name]=i[r].value}return!strings.str_cfg_tog_certified_icon&&n.crt&&delete n.crt,(F||!n.crt)&&(n[j]||n.siu||t.msgicon)&&(n&&n[j]?s=I[n[j]]||"":t.msgicon&&(s=t.msgicon)),NeoConfig.isSSL&&s==="certified"&&(s="certified-ssl"),n.inboxService=s,s}function et(t,o,a,l,c,h){t||n.report("Shouldn't come into getMsgMarkUp with empty message");if(!t.header)return;var d=this,v=d.message,m=t.flags.hasAttachment,g,b=d.getMsgFid(t),w=$.isDraftFid(b)?!0:!1;return g={from:function(){var e=t.header.from;if(e){var n={from_name:p.getName(e),from_id:p.getAddress(e),sender_email_address:p.displaySenderAddress(e)};return r(f.from,n,null,null,strings)}},super_collapsed:function(){return c?f.super_collapsed:""},isFlagged:function(){return t.flags.isFlagged?f.isFlagged:""},isFlagged1:function(){return t.flags.isFlagged?r(f.isFlagged1,null,null,null,strings):""},isFlagged2:function(){return t.flags.isFlagged?r(f.isFlagged2,null,null,null,strings):""},isFlagged_else:function(){return t.flags.isFlagged?"":r(f.isFlagged_else,null,null,null,strings)},isFlagged_else1:function(){return t.flags.isFlagged?"":r(f.isFlagged_else1,null,null,null,strings)},isUnread:function(){return t.flags.isRead?"":f.isUnread},snippet:function(){var n;return typeof t.snippet=="string"?n=t.snippet:t.header&&typeof t.header.snippet=="string"?n=t.header.snippet:n="",s(u(e.Lang.trim(n)))},expanded:function(){return o?f.expanded:""},ariaExpanded:function(){return o?"true":"false"},expanded_else:function(){return o?"":f.expanded_else},date:function(){var e=t.header.receivedDate*1e3;return!e&&d.getMsgFid(t)==="Sent"&&(e=t.header&&t.header.sentDate*1e3),n.dateFormatter(new Date(e),Neo.getDateFormat(e,!1,!0))},received_date:function(){return t.header.receivedDate?n.dateFormatter(new Date(t.header.receivedDate*1e3),strings.str_tog_dateformat_header_long_l10n):""},hasAttachmentDownload:function(){return m?r(f.hasAttachmentDownload):""},thread_reply:function(){return r(f.thread_reply,null,g,null,strings)},mid:function(){return y(t.mid)||""},hasDraft:function(){return w?r(f.hasDraft,null,null,null,strings):""},hasDraft1:function(){return w?r(f.hasDraft1,null,null,null,strings):""},hasDraft2:function(){return w?r(f.hasDraft2,null,null,null,strings):""},hasDraft_else:function(){return w?"":r(f.hasDraft_else,null,g,null,strings)},hasAttachment:function(){return m?r(f.hasAttachment,null,null,null,strings):""},recipients:function(e,n){return t=e||t,G(t,g,z,n)},ariaStr:function(n,i){var s=[],o=[],u=strings.str_thread_to_recipients,a,f,l=0,c;return t=n||t,t.header&&(s=t.header.to||[],s=s.concat(t.header.cc||[]),s=s.concat(t.header.bcc||[]),e.Array.each(s,function(e){o.push(p.getName(e))}),a=o.length,a&&(!i&&a>3&&(o=o.slice(0,3),l=a-3),f=o.join(strings.str_thread_to_concatenate_recipients_delimiter)),u=r(u,{recipients:f}),l&&(c=r(strings.str_thread_hdr_more_recipients_btn,{number:l}),u+=", "+c)),u},thread_attachments:function(){return m?r(f.thread_attachments,null,g):""},msg_blocked:function(){if(!o)return;return p.getBlockedMsgMarkup(t,f,g)},msg_has_photo_attachment:function(){var e=t,n=e?e.imgAttachments||[]:[];return n.length?r(f.msg_has_photo_attachment,e,g,null,strings):""},attached_photos:function(){return p.getAttPhotosMarkup(t,f,g)},msg_has_attachment:function(){var e=t,n=e?e.nonImgAttachments||[]:[];return!d.isChat(e)&&n.length?r(f.msg_has_attachment,e,g,null,strings):""},hide_attachments_else:function(){return r(f.hide_attachments_else,t,g,null,strings)},attached_files:function(){return p.getAttFilesMarkup(t,f,g)},msg_loading:function(){return t.loading_slow||t.loading_error||t.loading_moved?r(f.page_loading,null,g,null,strings):""},loading_error:function(){return t.loading_error?d.getFailureMarkup(t):""},msg_truncated:function(){return t.body&&t.isTruncated&&!d.msgTrucationStatus.disabled[t.mid]?r(f.msg_truncated,null,null,null,strings):""},isInternal:function(){return NeoConfig.showFeedback?r(f.isInternal,null,null,null,strings):""},unsubscribe:function(e){return n.Features.enabled("unsubscribr")?r(e.unsubscribe,0,0,0,strings):""},flag_info:function(){var e=v&&v.srvmap&&v.srvmap.inboxService,t=e?"info-"+e:"";return t},flag_info_hover:function(){var e=v&&v.srvmap&&v.srvmap.inboxService,t=e==="certified"||e==="certified-ssl"?"info-"+e:"info-unread";return t},status_title:function(){var e=v&&v.srvmap&&v.srvmap.inboxService,n=e==="certified"||e==="certified-ssl"?r(strings.str_msg_list_info_verified_attr,strings):"";return n===""&&t&&t.flags&&(n=t.flags.isRead?strings.str_msg_list_click_mark_as_unread:strings.str_msg_list_click_mark_as_read),n},mark_unread:function(){var e="";return t&&t.flags&&(e=t.flags.isRead?strings.str_msg_list_read:strings.str_msg_list_unread),e},loadhide:function(){return h?r(f.loadhide,null,g,null,strings):""},with_icons:function(){return NeoConfig.convBtmIcons?r(f.with_icons,null,g,null,strings):""},with_icons_else:function(){return NeoConfig.convBtmIcons?"":i(f.with_icons_else)}},d.messageFormatter||(d.messageFormatter=g),d.getInboxService(v),l?r(f.thread_reply
,null,g,null,strings):r(f.thread_item,null,g,null,strings)}function tt(){var t=this,n=function(e){var n=e.s||"",i=e.o||0,s=e.f||t.readFormatters,o=e.a||0,u=e.strs||strings;return r(n,i,s,o,u)};t.showDetails=A.get("neo.pref.showHeaderDetails"),this.readFormatters={anyUnread:function(){var e=t.message;return e.totalUnread>0?f.anyUnread:""},anyFlagged:function(){var e=t.message;return e.totalFlagged>0?f.anyFlagged:""},anyFlagged1:function(){var e=t.message;return e.totalFlagged>0?r(f.anyFlagged1,null,null,null,strings):""},anyFlagged2:function(){var e=t.message;return e.totalFlagged>0?r(f.anyFlagged2,null,null,null,strings):""},anyFlagged_else:function(){var e=t.message;return e.totalFlagged<=0?r(f.anyFlagged_else,null,null,null,strings):""},anyFlagged_else1:function(){var e=t.message;return e.totalFlagged<=0?r(f.anyFlagged_else1,null,null,null,strings):""},ariaLabelStrMsgHeaderUnread:function(){var e=t.message;return e.totalUnread>0?strings.str_msg_list_convUnread:strings.str_msg_list_convRead},titleStrMsgHeaderUnread:function(){var e=t.message;return e.totalUnread>0?strings.str_msg_list_conv_click_mark_as_read:strings.str_msg_list_conv_click_mark_as_unread},qr_bar:function(){return r(f.qr_bar,{},t.readFormatters,null,strings,a)},popoutToolbar:function(){return X?f.popoutToolbar:""},squeezeToolbar:function(){return V?f.squeezeToolbar:""},show_formatter_well:function(){return X?"":r(f.show_formatter_well,{},t.readFormatters,null,strings,a)},show_popout_toolbar:function(){return X?r(f.show_popout_toolbar,{},t.readFormatters,null,strings,a):""},show_attachment_icon:function(){return r(f.show_attachment_icon,{},t.formatters,null,strings,a)},spellCheckEnabled:function(){return M.enabled("spellCheck")?r(f.spellCheckEnabled,{},t.readFormatters,null,strings,a):""},thread_item:function(){var r,i=t.message,s=!0,o="",u,a,l=!1,c=0,h=0,p=0,d=0,v=!1;if(t.loading_error||!i.cid)return"";u=i.msgs,a=u&&u.length;if(a!==i.totalMsgs)return"";for(r=0;r<a;r++){var m=u[r],g,b=y(m.mid);if(e.Lang.isUndefined(m.header))return;r!==0&&r!==a-1&&h++,g=m.body?!0:!1,t.midObjMap[b]=r,$.isSentFid(t.fid)?($.isSentFid(m.fid)&&r<_?(l=!1,d++):r>=_&&!l&&!$.isSentFid(m.fid)?l=!1:r>=_&&!d&&(l=!0,r<a-1&&h--),r===a-1&&!l&&!d&&a>_&&(l=!0)):$.isDraftFid(t.fid)?($.isDraftFid(m.fid)&&r<_?(l=!1,p++):r>=_&&!l&&!$.isDraftFid(m.fid)&&u[r+1]&&!$.isDraftFid(u[r+1].fid)?l=!1:r>=_&&!p&&u[r+1]&&$.isDraftFid(u[r+1].fid)&&(l=!0,r<a-1&&h--),r===a-1&&!l&&!p&&a>_&&(l=!0)):(!m.flags.isRead&&r<_?(l=!1,c++):r>=_&&!l&&m.flags.isRead?l=!1:r>=_&&!c&&(l=!0,r<a-1&&h--),r===a-1&&!l&&!c&&a>_&&(l=!0)),l&&!t.submessage&&!t.midtocid&&!v&&(o+=n({s:f.super_collapsed_btn,o:{collapsed_msg_count:h}}),v=!0),o+=t.getMsgMarkUp(m,g,null,null,!1,s)}return o},message_selection:function(){var e=t.numSelected>0&&!t.message?n({s:f.message_selection}):"";return e},message_selection_else:function(){return t.numSelected===1&&t.message?n({s:f.message_selection_else}):""},multiple_selected_msgs:function(){return t.numSelected>1?n({s:f.page_conversation_history,o:{num_selected_msgs:t.numSelected}}):""},num_selected_msgs:function(){return t.numSelected},multiple_selected_msgs_else:function(){return t.numSelected===1?n({s:f.page_conversation_history1}):""},folder_message:function(e){var r=e||t.message;if(t.loading_error||!r.cid)return;return n({s:f.folder_message,o:r})},folder_message1:function(e){var r=e||t.message,i=r&&r.header;return i&&(i.subject||i.to&&i.to[0]||i.from.name)?n({s:f.folder_message1,o:r}):""},expanded:function(){return t.showDetails?f.expanded:""},mail_search_enabled:function(e){var r=e||t.message;return strings.str_cfg_tog_mailSearchEnabled!==undefined&&strings.str_cfg_tog_mailSearchEnabled===!1||!(r&&r[0]&&r[0].subject)?"":n({s:f.mail_search_enabled})},mail_search_enabled1:function(e){var r=e||t.message;return strings.str_cfg_tog_mailSearchEnabled!==undefined&&strings.str_cfg_tog_mailSearchEnabled===!1||!(r&&r[0]&&r[0].subject)?"":n({s:f.mail_search_enabled1})},msg_subject:function(){var n=e.mail.Tabs,r=p.getMsgSub(t.message),i,s;return t.loading_error&&(i=n.getActiveTab(),i&&i.prevTabId&&(s=n.getTabById(i.prevTabId),s&&s.widgetType==="search"&&(r=r.split("^_").join("")))),r},msg_subjectDir:function(){return p.getMsgSubDir(t.message)},page_loading:function(){return t.loading_slow||t.loading_error||t.loading_moved?n({s:f.page_loading}):""},conv_loading:function(){return t.loading_error?"":n({s:f.conv_loading})},nav_arrows:function(){return n({s:f.nav_arrows})},summary:function(){var e=t.message,n=e.totalMsgs;return n>1?"("+n+")":""},showAllReplyActions:function(){return M.enabled("messageReadPaneV2")?r(f.showAllReplyActions,null,null,null,strings):""},showAllReplyActions_else:function(){return M.enabled("messageReadPaneV2")?"":r(f.showAllReplyActions_else,null,null,null,strings)},plus_icon:function(){return M.enabled("messageReadPaneV2")?"":f.plus_icon},ca_icon:function(){return M.enabled("richcompose")?r(f.ca_icon,null,null,null,strings):""}},t.setFull=1}function nt(t,r,i,s){var u=this,a,l=n.Stopwatch.get("MsgInPreview")||u.stopwatch,c=t&&t.cid,h,d,v,g,w,E,S=!1,x=[];u.wasCached=r||"";try{l&&l.start(3,"OnSuccessLMTRender"),clearTimeout(u.loadingTimer);if(c&&u.message&&(u.message.cid&&b(u.message.cid)===b(c)||u.midtocid&&e.Lang.isValue(u.getMessageIdxByMidLookup(u.midtocid,t.msgs,!0)))){u.loading_moved=0,u.resetRequestLoadingState(!1),u.inboxservices=u.message.inboxservices||u.message.msgs&&u.message.msgs[0]&&u.message.msgs[0].inboxservices,u.msgicon=u.message.msgicon,u.midtocid?(u.message=t,S=!0):(u.message=t,u.allMsgsInConvInfo=t.msgs),u.message.toggleState="expanded";if(s&&t.fullmsg.mid){v=u.getMessageIdxByMidLookup(t.fullmsg.mid,u.message.msgs),t.fullmsg=e.clone(t.fullmsg),t.fullmsg.cid=t.cid,t.fullmsg.header.snippet=t.msgs[v].header.snippet,t.fullmsg.fid=u.getMsgFid(t.msgs[v]),u.message.msgs[v]=t.fullmsg,u.primaryMid=t.fullmsg.mid,x.push(u.message.msgs[v]);for(d=0;d<x.length;d++)a=m.getQueryParams(x[d],"midRequest"),x[d].blockImages=a&&a.blockImages,E=u.midObjMap
[y(x[d].mid)],p.extractQuotedText(x[d],f.quoted_text_collapse,f.quoted_text_expand,q,E)}u.setRefreshTimer(),u.fireEvent("getSuccess"),u.render(r);if(s&&v!==undefined&&v>=0){u.showMessages(v,[u.message.msgs[v]],!1,!1,l,S,!1,!1);if(!NeoConfig.hasConvV3)return}l&&l.start(1,"ThreadMsgRead"),w=u.submessage?u.submessage:u.midtocid?{mid:u.midtocid}:s&&t.fullmsg?t.fullmsg:u.message.msgs[u.message.msgs.length-1],v=u.getMessageIdxByMid(w.mid),g=u.getMsgNodeByMid(w.mid),$.isDraftFid(w.fid)?u.showMessages(v,[u.message.msgs[v]],!1,!1,l,!1,!1,!0):u.submessage?u.expandMessages(v,"adjacent","no",!0,{scroll_to_msg:!0},l,!0):u.midtocid?s||u.expandMessages(v,"one",!1,!0,{scroll_to_msg:!0},l,!0):u.fid==="Sent"?s?u.expandMessages(v,"other-send",!1,!0,null,l,!0):u.expandMessages(v,"send",!1,!0,null,l,!0):$.isDraftFid(u.fid)?u.expandMessages(v,"draft",!1,!0,null,l,!0):s?u.expandMessages(v,"other-unread",!1,!0,{no_focus:!0},l,!0):u.expandMessages(v,"unread",!1,!0,{no_focus:!0},l,!0),o.stat("convread","result=>success,env=>"+NeoConfig.mailEnv)}else t||u.loadExtra(function(){this.onFailure({msg:u.message,reason:h},i)},1)}catch(T){typeof globals!="undefined"&&globals.report?globals.report("caughterror:..-build-mail-ui-mailpane-conv-convpaneread:1",T,"TRY_CATCH",1,1,1):window.console&&console.log&&console.log("caughterror:..-build-mail-ui-mailpane-conv-convpaneread:1")}}function rt(){return this.activeComposeWidget.cv.view}function it(t){var n=this,r,i,s;n.activeComposeWidget&&n.activeComposeWidget.cv.view!==t&&n.activeComposeWidget.cv.view.save(),n.activeComposeWidget=null;for(r in n.composeWidgets)s=n.composeWidgets[r].cv.view,i=n.getComposeNodeByMid(r),s===t&&(n.activeComposeWidget=n.composeWidgets[r],i&&i.addClass("active"),e.fire("draftCardAdded"),Y(),!NeoConfig.smartscroll&&n.composeAction&&i&&(n.listNode.set("scrollTop",i.get("offsetTop")-10),n.composeAction=!1))}function st(e){var t=this,n,r,i,s,o,u=[],a=0;for(r in t.composeWidgets)i=t.composeWidgets[r].cv.view,i.get("dirty")&&u.push(i);if(u.length<=0)e&&e(!0);else{s=function(t,n){n.detach("compose:saveFail",o),n.dirty=!1,a--,a===0&&e&&e(!0)},o=function(t,n){n.detach("compose:saveSuccess",s),n.dirty=!0,e&&e(!1)},a=u.length;for(n=0;n<u.length;n++)i=u[n],i.once("compose:saveSuccess",s,null,i),i.once("compose:saveFail",o,null,i),i.save()}}function ot(){J.superclass.closeAllCompose.call(this,{})}function ut(t,n){var r=this,i;if(r.convUserUnread||r.msgUserUnread&&r.msgUserUnread[y(n.mid)]||!r.get("active"))return;if(n&&!r.loading_slow&&!r.loading_error&&!r.loading_moved&&!n.flags.isRead){i=parseInt(e.mail.persist.MetaData.get("cg.pref.general.markasreadinterval"),10);if(i!==999)return i=i?i*1e3:750,isNaN(i)&&(i=750),i===0&&(i=100),r.flagMsgList.push({fid:t,msg:n}),e.use("mail-controller-messages-ops",function(){r.tmFireRead&&(clearTimeout(r.tmFireRead),r.tmFireRead=null),r.tmFireRead=setTimeout(function(){e.Array.forEach(r.flagMsgList,function(e){r.markAsReadBatch(e.fid,e.msg)}),r.readBatch&&r.readBatch.execute({suppressCodes:["*"]}),r.readBatch=null,r.flagMsgList=[]},i)}),!0}return!1}function at(e,t){var n=this;n.readBatch=n.readBatch||l.Controller.batch(),n.readBatch.Messages.flag({fid:e,mid:t,setFlags:{read:1},enableRetry:!0})}function ft(t,n,r){var i=this;try{n&&n.ancestor("body")?i.neoFire("rendered",[],t,n,{headerClassName:"thread-body",insertPos:"append",att:{container:".thread-body",insertPos:"append"},rsvp:{container:".thread-item-header .contents",insertPos:"append"}},r):i.once("convAddedToDOM",function(){n.ancestor("body")||(n=i.getMsgNodeByMid(t.mid)),i.neoFire("rendered",[],t,n,{headerClassName:"thread-body",insertPos:"append",att:{container:".thread-body",insertPos:"append"},rsvp:{container:".thread-item-header .contents",insertPos:"append"}},r)},n),n&&i.inspectMessageForBadContent(n,t)}catch(s){typeof globals!="undefined"&&globals.report?globals.report("caughterror:..-build-mail-ui-mailpane-conv-convpaneread:2",s,"TRY_CATCH",1,1,1):window.console&&console.log&&console.log("caughterror:..-build-mail-ui-mailpane-conv-convpaneread:2")}M.enabled("selectToSearch")&&e.use("mail-ui-pane-utils-s2s",function(e){e.mail.ui.PaneUtils.handleS2S(i)}),M.enabled("enhancrV2")&&e.use("mail-ui-enhancr",function(e){e.mail.ui.enhancr.enhancr.prepareEnhancrCards(n),i._evts.push(i.on("MessagePane:unload",e.mail.ui.enhancr.enhancr.handleUnload,e.mail.ui.enhancr.enhancr))}),M.enabled("readLinkEnhancr")&&e.use("mail-ui-pane-utils-linkEnhancr",function(e){e.mail.ui.PaneUtils.initializeReadLinkEnhancr(i)}),M.enabled("deepLinkedMail")&&i.message.srvmap.inboxService==="certified-ssl"&&e.use("mail-ui-deeplink-manager",function(e){i._evts.push(e.mail.ui.deeplink.manager.attachEvents(n.one(".body")))})}function lt(t){var n=this,r=n.listNode,i,s,o,u=e.ACWidgetInst;if(!r)return;i=r.get("scrollTop"),s=r.get("offsetHeight"),o=r.all("."+x),!t&&u&&u.isVisible()&&u.hide(),o.size()>1&&n.checkAdsOnScroll(i,s),clearTimeout(n.markAsReadTimer),n.markAsReadTimer=setTimeout(function(){n.checkMsgCardsOnScroll(o,t)},200)}function ct(t,n){var r=this,i=window.DARLA,s,o,u=200;e.Lang.isNumber(r.prevY)||(r.prevY=t),r.scrollAdTimer&&clearTimeout(r.scrollAdTimer),i&&(i.inProgress()||(s=Math.abs(r.prevY-t),o=n*i.scrollThreshold,s>o&&(r.scrollAdTimer=setTimeout(function(){e.mail.ui.darla.fireDarlaOnScroll(),r.prevY=t},u))))}function ht(t,n){if(M.enabled("markExpandedAsRead"))return;var r=this,i,s,o,u;r.message&&(s=r.message.msgs);if(!t||!s)return;i=t.size();for(u=0;u<i;u++)o=t.item(u),o.hasClass(T)&&o.hasClass(N)&&o.inRegion(r.listNode)&&(r.markConvMsgAsRead(r.getMsgFid(s[u]),s[u]),n&&e.fire("MailLog",{m:"Marking message as read silently",cid:s[u].cid,mid:s[u].mid}))}function pt(){var e=this,t=e.listNode,n="has-scrolled";!M.enabled("messageReadPaneV2")&&t&&(t.get("scrollTop")>B?e.hdr.addClass(n):e.hdr.removeClass(n)),e.scrollTimer&&window.clearTimeout(e.scrollTimer),e.scrollTimer=window.setTimeout(function(){e.onPaneScroll()},200)}function dt(){var e=this,t=this.getRoot();e.listNode=t.one(".thread-item-list"
);if(!e.listNode||!e.message)return;e.listNode.on("scroll",pt,e)}function vt(e){var t=null,n,r,i=!1;if(!e||!e.getDOMNode())return;t=e.one(".msg-truncated");if(!t)return;n=e.all(".thread-quoted-body"),r=n&&n.size()>0,r&&(i=n.item(0).hasClass("expanded")),r&&!i?t.hide():t.show()}function mt(e,t,n){var r=!1;if(!(t&&t.getDOMNode()&&e.isTruncated&&t.one(".body")))return;r=d.hasOnlyNonDisplayableContent(t.one(".body")),r&&!this.msgTrucationStatus.loading[e.mid]&&(this.msgTrucationStatus.loading[e.mid]=!0,this.viewFullMsg(e,n),t.one(".msg-truncated").hide(),t.one(".body").setContent('<div class="s-loader"></div>'))}function gt(){var t=this,r=this.getRoot();t.listNode=r.one(".thread-item-list"),t.after("activeChange",function(e){var t=this;e.newVal||t.saveDraftAction(null,!0)}),t.on("activeChange",function(e){e.newVal&&t.refreshOnActive&&t.updatePaneContent()}),t.on("closeChange",function(e){e.newVal&&t.closeAllCompose()}),t.threadHeaderHandler=r.delegate(["click","keydown"],function(r){if(r.type==="keydown"&&r.keyCode!==13)return;var i;r.stopPropagation();var s,o=n.getDataAction(r).action,u=t.message,a=r.target;i="";switch(o){case"thread-flag":s=u.totalFlagged?"unflagged":"flagged",i=u.totalFlagged?"unflag_thrd_hdr":"flag_thrd_hdr",t.handleUI(u,s);break;case"thread-unread":s=u.totalUnread?"read":"unread",i=u.totalUnread?"read_thrd_hdr":"unread_thrd_hdr",s==="unread"?(t.convUserUnread=!0,r.target.setAttribute("aria-label",strings.str_msg_list_convUnread),r.target.setAttribute("title",strings.str_msg_list_convRead_attr)):(r.target.setAttribute("aria-label",strings.str_msg_list_convRead),r.target.setAttribute("title",strings.str_msg_list_convUnread_attr)),t.handleUI(u,s);break;case"thread-toggle":s=u.toggleState==="expanded"?"collapse":"expandall",t.handleToggleAllMessageCards(a,s,u,t.getMsgFid(u));break;case"update":t.saveDraftAction(function(){t.loadPaneContent(7,null,{force:!0},null)})}i&&e.fire("mt:click",{action:i})},w),t._evts.push(r.delegate(["focus","blur"],function(e){e.type==="focus"?e&&e.currentTarget&&!e.currentTarget.hasClass("thread-focus")&&(e.currentTarget.addClass("thread-focus"),e.currentTarget.hasClass("thread-item")&&(t.selNode=e.currentTarget)):e.type==="blur"&&e&&e.currentTarget&&e.currentTarget.hasClass("thread-focus")&&(e.currentTarget.removeClass("thread-focus"),e.currentTarget.hasClass("thread-item")&&(t.selNode=null))},".thread-item, .add-to-conv, .supercollapsed")),t._evts.push(r.delegate("contextmenu",function(t){e.fire("HoverCard:hideHoverCard")},".lozengfy.hcard")),t._evts.push(r.delegate("click",t.logLinkClicks,".thread-body a",t)),t.threadItemHandler=r.delegate(["click","keydown"],function(r){if(!(r.type!=="keydown"||r.keyCode===13&&!r.target.hasClass("recipients")))return;r.type==="keydown"&&r.stopPropagation(),r.target.getAttribute("href")==="#"&&r.halt(),e.fire("as:close-window-click",r);var i,s,o,u,a=r.target,f=a.get("parentNode"),l=r.currentTarget,c=n.getDataAction(r).action,h=a.hasClass("thread-item")?a:a.ancestor(".thread-item",!0),p,d,v,m=t.message.msgs,g,y,b=r.type==="keydown";(f.get("nodeName")==="A"||a.get("nodeName")==="A")&&t.handleBodyLinkClick(r),h&&(v=h.getAttribute("data-mid"),v&&(p=t.getMessageIdxByMid(v),d=m[p],t.selNode=h)),c==="contact-card-menu"&&r.halt(),c==="contact-card-menu"&&!h.hasClass("expanded")&&(c="select-thread"),o="",e.fire("MailLog",{m:"Initializing Action from Conversation Pane",action:c});switch(c){case"thread-super-collapse":t.expandSuperCollapsedNodes();break;case"select-thread":window.getSelection?y=window.getSelection().toString():y=document.body.createTextRange().text;if(a.hasClass("thread-item")&&b||(a.hasClass("thread-item-header")||a.ancestor(".thread-item-header")||a.hasClass("thread-item")&&!h.hasClass("expanded"))&&!a.hasClass("more_recp")&&!a.hasClass("info-hover")&&!a.hasClass("flag")&&!e.Lang.trim(y))h.hasClass("expanded")?!h.hasClass("collapsing")&&!h.hasClass("expanding")&&(t.collapseMessage(h),o="collapse_thrd_msg_hdr",t.selNode=h,t.focusMessageCard()):(e.fire("MessagePane:expandClick",{cid:t.message.cid,mid:d.mid}),t.selNode!==h&&(t.selNode=h,t.focusMessageCard()),t.expandMessageTimers[v]=e.later(5e3,null,function(){var r={yid:NeoConfig.loginId,cid:t.message.cid,mid:d.mid};n.netError("Expand Message Failed:"+e.JSON.stringify(r))}),t.expandMessages(p,"one","yes",!1),o="expand_thrd_msg_hdr");break;case"quoted-text":var w,E=h.all(".thread-quoted-body"),S,x,T=h.one(".thread-quoted-body");E&&E.size()>0&&(w=!E.item(0).hasClass("expanded"),o=w?"expand_qtd_thrd_msg":"collapse_qtd_thrd_msg",S=h.one(".thread-quoted-text"),S&&(S.one(".icon").toggleClass("icon-chevron-down"),S.one(".icon").toggleClass("icon-chevron-right"),S.one(".qtd-expansion-text").set("text",w?strings.str_qtd_collapse:strings.str_qtd_expand),S.one(".qtd-expansion-text").set("aria-label",w?strings.str_qtd_collapse:strings.str_qtd_expand),S.setAttribute("title",w?strings.str_qtd_collapse:strings.str_qtd_expand)),E.each(function(t){w?(t.addClass("no-transition"),t.setStyles({display:"block",transition:""}),x=parseInt(t.getComputedStyle("height"),10)+"px",t.setStyle("height",0),t.removeClass("no-transition").addClass("expanded"),e.later(0,t,t.setStyle,["height",x]),e.later(200,null,function(e){Y(),e.setStyles({transition:"none",height:"auto"})},[t])):(x=parseInt(t.getComputedStyle("height"),10)+"px",t.setStyle("transition",""),t.setStyle("height",x),t.removeClass("expanded"),e.later(0,t,t.setStyle,["height",0]),e.later(200,null,function(e){Y(),e.setStyles({display:"none",height:"auto"})},[t]))}),vt(h),w?e.later(0,null,function(){T.setAttribute("role","gridcell"),T.setAttribute("tabindex","0"),T.focus()}):T.setAttribute("tabindex",-1));break;case"thread-item-flag":i=d.flags.isFlagged?"unflagged":"flagged",o=d.flags.isFlagged?"unflag_thrd_msg_hdr":"flag_thrd_msg_hdr",t.handleUI(d,i);break;case"thread-item-delete":i="delete",t.handleUI(d,i);break;case"thread-item-unread":i=d.flags.isRead?"unread":"read",i==="unread"&&(t.msgUserUnread||(t.msgUserUnread={}),t.msgUserUnread
[v]=!0),o=d.flags.isRead?"unread_thrd_msg_hdr":"read_thrd_msg_hdr",t.handleUI(d,i);break;case"reply_all":case"reply_sender":case"forward":case"thread-item-replyall":s={},s.action=c==="thread-item-replyall"?"reply_all":c,e.fire("rc:flow",{name:c}),c==="thread-item-replyall"?o="quick_reply_all_thrd_msg":l.hasClass("add-to-conv")?o="quick_"+c+"_tlbr_thrd_msg":o=c+"_thrd_msg",d||(p=m.length-1,d=m[p]),t.composeAction=!0,t.initReplyForward(s.action,d);break;case"edit-to":t.composeWidgets[v]&&(h.one(".thread-reply-to").setStyle("display","none"),h.one(".thread-reply-to-edit").setStyle("display","block"));break;case"menu":h.hasClass("quickReply")||(t.loadMenu(r,d,h,p),o="actnMnu_thrd_msg");break;case"show-images":t.unblockImages(d,p),o="show_images_thrd_msg";break;case"mail-options":t.loadOptions(),o="options_thrd_msg";break;case"attach-download-all":case"attach-download-all-photos":var N=c==="attach-download-all-photos"?"image":"non-image";t.downloadAllAttachments(N,r,d);break;case"attach-download":var C=0,k="";l&&(C=l.get("id"),k=l.getAttribute("tnefid")),t.downloadAttachment(C,k,d);break;case"retry-msg-load":t.expandMessages(p,"one","yes",!1),o="retry_thrd_msg";break;case"retry-conv-load":t.retryLoad(),o="retry_thrd_hdr";break;case"view-full-msg":t.viewFullMsg(d,p);break;case"thread-item-edit":s={},s.action="edit",e.fire("editMessage",e.mix(s,{fid:t.getMsgFid(d),oMsg:d}));break;case"hide":g=a.getAttribute("data-field"),W[g]=!1,h.one(".recipients").set("innerHTML",t.messageFormatter.recipients(d,W)),h.one(".recipients").setAttribute("aria-label",t.messageFormatter.ariaStr(d,!0)),h.one(".recipients").setAttribute("title",t.messageFormatter.ariaStr(d,!0));break;case"more":g=a.getAttribute("data-field"),W[g]=!0,h.one(".recipients").set("innerHTML",t.messageFormatter.recipients(d,W)),h.one(".recipients").setAttribute("aria-label",t.messageFormatter.ariaStr(d,!0)),h.one(".recipients").setAttribute("title",t.messageFormatter.ariaStr(d,!0)),e.later(0,null,function(){h.one(".recipients").focus()}),e.mail.e2e&&e.mail.e2e.hasStarted&&e.mail.e2e.hasStarted()&&e.mail.e2e.isValid()&&e.mail.e2e.installReadGlass()}e.fire("ConvPane",c),u={action:o,append:{t1:"thrdRdTb"}},o&&e.fire("mt:click",u)},".thread-item, .msg-attachments .file-attach li, .conv-loadingpane, .supercollapsed, .add-to-conv"),e.on("ds:conv:change",function(){}),e.on("ds:folder:rename",function(e,n){var r,i=0;if(t&&t.message&&t.message!==null){r=t.message.msgs;if(e.folderInfo.fid===t.message.fid){t.message.fid=n.folderInfo.fid;for(i=0;i<r.length;i++)e.folderInfo.fid===r[i].fid&&(r[i].fid=n.folderInfo.fid,r[i].folderInfo&&r[i].folderInfo.fid!==undefined&&(r[i].folderInfo.fid=n.folderInfo.fid),r[i].sourceFolderInfo&&r[i].sourceFolderInfo.fid!==undefined&&(r[i].sourceFolderInfo.fid=n.folderInfo.fid))}}}),t.refreshHandler=e.on("ds:conv:refresh",function(r,i,s){var o,u,a,f=!0,l,c;if(!t.message||!t.message.cid)return;u=b(t.message.cid),r==="lft"?o=s[u]:r==="lmt"&&s[0]&&b(s[0].cid)===u&&(o=s[0],f=!1,a=o.checksum);if(o){l=t.lftCongruencyCheck(o,t.message);if(l)if(!t.fullView&&!t.get("active"))t.saveDraftAction(function(){try{t.loadPaneContent(8,null,{force:f,checksum:a},null)}catch(i){typeof globals!="undefined"&&globals.report?globals.report("caughterror:..-build-mail-ui-mailpane-conv-convpaneread:3",i,"TRY_CATCH",1,1,1):window.console&&console.log&&console.log("caughterror:..-build-mail-ui-mailpane-conv-convpaneread:3"),e.use("common-utils-error",function(){n.error.report("loadpane convpanerefresherror "+r,i,1,1,1)})}});else{if(r!=="lmt"||!t.currentLmtContext||!(t.currentLmtContext.draftMID||t.currentLmtContext.newMsg&&$.isDraftFid(t.currentLmtContext.newMsg.fid)))c=t.getRoot().one(E)||t.getRoot().one(S),c&&c.replace('<span class="badge" data-action="update">'+l+"</span>"),t.isStale=!0;t.setRefreshTimer()}}}),t.newMessageHandler=e.on("newConvMessage",function(e){t.composeAction=!0,t.get("active")&&t.initReplyForward(e.action,e.oMsg)}),t.eventsBound=!0}function yt(e,t){var n=!0;return e.totalMsgs>t.totalMsgs?(n=!1,e.totalMsgs-t.totalMsgs):0}function bt(e,t,n){var r,i,s={oldIdx:-1,newIdx:-1,remainder:!0};r=i=0;while(r<e.msgs.length||i<t.msgs.length)r<e.msgs.length&&n.draftMID&&y(e.msgs[r].mid)===y(n.draftMID)?(s.oldIdx=r,r++):i<t.msgs.length&&y(t.msgs[i].mid)===y(n.newMsg.mid)?(s.newIdx=i,i++):(i<t.msgs.length&&r<e.msgs.length&&y(e.msgs[r].mid)!==y(t.msgs[i].mid)&&(s.remainder=!1),r++,i++);if(r!==e.msgs.length||i!==t.msgs.length)s.remainder=!1;return s}function wt(){var e=this,t=e.listNode;t.all(".super-hidden").removeClass("super-hidden"),t.one(".supercollapsed")&&t.one(".supercollapsed").remove()}function Et(t){var n=this,r,i=t||n.message,s=i.totalMsgs,o,u="",a,f,l,c,h,p,d=e.one("#inboxcontainer"),v=d.hasClass("prevPaneVisible")&&!d.hasClass("offscreen"),m=[],g,y;n.destroyRichCompose(),n.composeWidgets={};for(r=0;r<s;r++)g=i.msgs[r],g&&$.isDraftFid(g.fid)&&m.push(r);for(r=0;r<m.length;r++){y=m[r],a=i.msgs[y],c=!0;if(!a.oMsgMid){var b=n.getMessageIdxByMid(a.mid);if(b>0)for(var w=b-1;w>=0;w--)if(a.inReplyTo===i.msgs[w].mimeMsgId){a.oMsgMid=i.msgs[w].mid;break}}f=a,o=n.getMsgNodeByMid(a.mid),a.oMsgMid?(l=n.message.msgs[n.getMessageIdxByMid(a.oMsgMid)],h=n.getMsgNodeByMid(a.oMsgMid)):(l=a,h=n.getMsgNodeByMid(n.message.msgs[s-1].mid)),o&&y!==s-1&&(o.remove(),o=null),y===n.message.msgs.length-1&&n.quickReplyBox&&n.quickReplyBox.hide(),s>=_&&(u=y!==0&&y!==s-1&&h.hasClass("super-hidden")&&!$.isDraftFid(n.fid)?"super-hidden":"",y===s-1&&(h=n.listNode.one(".supercollapsed")?n.listNode.one(".supercollapsed"):h)),($.isDraftFid(n.fid)&&y===m[m.length-1]||y===s-1)&&!v&&(c=!1),a.cookedHeader&&a.cookedHeader.subject&&a.oMsgMid?p=!1:p=!0,l.fid||(l.fid=n.getMsgFid(a.fid)),n.initializeCompose({action:"edit",fid:n.getMsgFid(a),oMsg:a,parentMsg:l,showSubject:p},h,!0,c,u),o&&o.remove()}n.once("convAddedToDOM",function(){$.isDraftFid(n.fid)&&n.parentCW.msgList&&!a.oMsgMid&&s===1&&(n.subjectHandle=e.one("#subject-field").on("valueChange",n.updateSubject))})}function St(t,n
,r,i,s){var o=this,u,a,f,l,c,h,p,d=typeof r!="undefined"?r:!1,v=t&&t.action==="forward",m=t&&t.showSubject,g,b=typeof s!="undefined"?s:"",w=typeof i!="undefined"?i:!1,E=y(t.parentMsg.mid),S="",x="quickReply";o.dirty=!0,u=o.composeWidgets[E];if(!d&&u)l=u.cv.draft.origin,f=l.action,f!==t.action?u.cv.view.header.switchReplyMode(t.action):u.cv.view.setFocus("body"),o.activeComposeWidget?o.setActiveCompose(u.cv.view):o.activeComposeWidget=u;else{d?(a=" loadhide active",S=' data-mid = "'+y(t.oMsg.mid)+'"'):(a=" active",S=""),n||(n=o.getMsgNodeByMid(o.message.msgs[o.message.msgs.length-1].mid)),n.insert('<div class = "thread-item '+x+" expanded"+a+" "+b+'" '+S+' tabIndex="-1" data-draftmid="'+E+'"> <div class="compose-loading-wrapper"><div class="cm-loadingpane"><div class="s-loader"></div></div></div></div>',"after"),g=n.next(),c={isQuickReply:!0,noFocus:w,containerNode:o.listNode,showSubject:m,maxHeightFn:function(){return o.listNode.get("offsetHeight")-20}},h={setActiveCompose:function(t){t.cv.getDraftMID()&&(t.cv.scrollFocus=!1),e.later(0,o,o.setActiveCompose,[t.cv]),e.fire("compose:rte:active",{editor:t.editor,cv:t.cv})},closeAction:function(){var t=g&&g.one("#rtetext");e.UA.gecko>0&&t&&(t.focus(),t.blur()),p.view.closeCompose(),delete o.composeWidgets[E],o.activeComposeWidget&&o.activeComposeWidget.cv===p&&(o.activeComposeWidget=null,o.richcompose&&!o.hasDrafts()&&o.destroyRichCompose()),e.fire("draftCardRemoved"),g.remove(!0),o.message&&o.message.msgs.length>0&&!$.isDraftFid(o.message.msgs[o.message.msgs.length-1].fid)&&o.quickReplyBox&&(o.quickReplyBox.show(),o.quickReplyBox.removeClass("loadhide"),o.quickReplyBox.focus())},bindComplete:function(e){v&&o.expandReplyCard(g,e.ccv.view)},updateTitle:function(e){o.fullView&&o.parentCW&&(e.sending?o.parentCW.tab.elTab.addClass("sending"):(o.parentCW.tab.elTab.removeClass("sending"),o.setTitle()))},showDeleteDraftDialog:function(e){e&&e.sdcbk(!1)},qrCancel:function(){p.view.cancelCompose()},switchToTab:function(){o.parentCW&&o.parentCW.tab!==e.mail.Tabs.getActiveTab()&&e.mail.Tabs.switchToTab(o.parentCW.tab)},darlaEvent:function(e){e.action=e.type,o.fire("darlaEvent",e)}};var T=["mail-ui-composeview-compose-loader"],N=function(){e.use(T,function(){var n={},r=new e.mail.ui.Compose.ComposeLoader(n);p=r.create_conv_compose_view(t,d,g,c,h),M.enabled("richcomposeInQuickReply")&&e.use("mail-ui-richcompose-view",function(e){o.richcompose?o.richcompose.addComposeView(p.view):o.richcompose=new e.mail.Views.RichCompose(o,p.view)}),o.composeWidgets[E]={cv:p}})};T.push("mail-controller-compose-v3"),T.push("mail-ui-rteview-v3"),T.push("mail-ui-rte-formatter-v3"),N()}}function xt(){var e=!1,t;for(t in this.composeWidgets)e=!0;return e}function Tt(t,r,i){var s=this,o,u,a,f,l,c;if(r){o=s.getMessageIdxByMid(r.mid),u=s.getMsgNodeByMid(r.mid),c=y(r.mid);if(!u)return;f=e.one('[data-draftmid="'+c+'"]');if(i&&f){l=n.getVal(s.composeWidgets[c],"cv.view.focusNode"),l?l.focus():f.focus();return}t==="forward"?a=!0:a=!1,o===s.message.msgs.length-1&&s.quickReplyBox&&s.quickReplyBox.hide(),s.initializeCompose({action:t,fid:s.getMsgFid(r),oMsg:r,parentMsg:r,showSubject:a},u),e.fire("draftCardAdded"),Y()}}function Nt(t,n,r){function l(t){var l,c=o.ancestor("div"),h=c?c.one(".card-actions-menu"):null,p=["removeAddress","spam","notspam","notmymail","sendercompromised","phished","delete"],d=t.dataAction;if(t.dataAction==="conv-help")return;t.dataAction==="bug"?(u=encodeURI(r.getAttribute("data-mid")),a=u.lastIndexOf("_")+1,f="php/qtd_r.php?cid="+i.message.cid+"&mid="+(a?u.slice(a):u)+"&fid="+s,NeoConfig.isCorpmail&&(f+="&isCorpMail=1"),window.open(f,"_bug")):e.Array.indexOf(p,d)!==-1&&h&&h.menu&&h.menu.hide();if(NeoConfig.hasConvRefactor)if(t.dataAction==="reply_sender"||t.dataAction==="forward"){i.initReplyForward(t.dataAction,n);return}var v={action:t.dataAction,context:"msg",id:r?r.get("id"):0,forwardAsAttachment:0,fid:s,item:t.item,hasMsgList:!1,tbAction:!1};e.mail.ui.MessageEvents.handleUI(v,s,null,[n?n:null]),l=t.dataAction+"_thrd_msg",l&&e.fire("mt:click",{action:l,append:{t1:"thrdRdTb"}})}var i=this,s=i.getMsgFid(n),o=t.target,u,a,f;t.preventDefault(),e.use("common-ui-menu-helper",function(e){var n=e.common.ui.MenuHelper,r=o.ancestor("div"),i=r.one(".card-actions-menu");i.addClass("pressed"),e.use("mail-ui-inboxmenu-base","mail-ui-messageevents",function(e){e.mail.ui.InboxMenu.insert("menu-bubble-actions",function(){var r=e.one("#menu-bubble-actions");n.create(i,{menu:r,flushLeft:!1,isContext:!1,xy:[t.clientX,t.clientY],blur:!0},function(){r.on("menuSelected",l),r.after("menu:state",function(t){var n=t.state;n==="hide"&&(i.removeClass("pressed"),i.unplug(e.Plugin.Menu),this.destroy(!0))})})},s,{fid:s})})})}function Ct(t,r,i,s,o,u,a){var l=this,h,d,v,g,b,w,E,S=l.message,x=null,T,N,C=o&&o.no_show_hidden_cards?!0:!1,k=o&&o.scroll_to_msg?!!o.scroll_to_msg:!1,L=o&&o.no_focus?!0:!1;l.messageFound=0,u&&u.start(2,"LoadMessageCard"),v=new n.Stopwatch("LoadMessageCard"),x=e.later(500,l,function(){l.loadExtra(function(){if(!l.messageFound)for(T=0;T<r.length;T++)E=l.getMsgNodeByMid(S.msgs[r[T]].mid),E&&(E.hasClass("expanded")||E.addClass("loading"))},1)}),g={success:function(n,s){e.fire("MessagePane:loadMessageSuccessStart",n);var o=g&&g.respProps&&g.respProps.wasCached?!0:!1,d=g&&g.respProps&&g.respProps.callPerf,b,w=0,T=0,N,A=new Date;u&&(u.start(1,"GDMFetchEnd"),u.YCMSGGetEnd2=A,u.wasCached2=o,u.BECallTime2=d),v&&(v.wasCached=o,v.YCMSGGetEnd=A,v.BECallTime=d,v.stop());if(!l.isConvActive(S.cid))return;for(T=0;T<r.length;T++){N=r[T];if(l.message.msgs&&l.message.msgs[N]){if(!l.message.msgs[N].flags||!l.message.msgs[N].header)l.message.msgs[N]=c.Messages.toMessage(l.getMsgFid(l.message.msgs[N]),l.message.msgs[N]);n[w]&&(n[w]=e.clone(n[w]),n[w].header.snippet=l.message.msgs[N].header.snippet,n[w].fid=l.getMsgFid(l.message.msgs[N]),l.message.msgs[N]=n[w],h=m.getQueryParams(n[w],"midRequest"),n[w].blockImages=h&&h.blockImages,b=l.midObjMap[y(n[w].mid)],p.extractQuotedText(n[w],f.quoted_text_collapse
,f.quoted_text_expand,q,b))}w++}l.showMessages(t,n,!1,i,u,k,C,!1,L),s&&s.length&&(a==="one"||a==="all")&&l.showNotification(t,s),l.messageFound=1;if(x){x.cancel();for(w=0;w<r.length;w++)E=l.getMsgNodeByMid(S.msgs[r[w]].mid),E.removeClass("loading")}L||(l.selNode||(l.selNode=e.all(".thread-item").item(t)),l.focusMessageCard())},failure:function(e){l.loadExtra(function(){var n=S.msgs[t],r=l.getMsgNodeByMid(n);e.data=n,n.body={},n.body.display=l.onMsgFailure.apply(l,[e,!1]),u&&u.stop(l.fullView?"MsgInTabFailure":"MsgInPreviewFailure"),l.showMessage(n,0,r,!1,i)},1),l.messageFound=1,l.primaryMid=null;if(x){x.cancel();for(T=0;T<r.length;T++)E=l.getMsgNodeByMid(S.msgs[r[T]].mid),E.removeClass("loading")}},errorPosition:401,suppressCodes:["*"]},b=[];for(T=0;T<r.length;T++)b.push(S.msgs[r[T]]);if(b.length===1&&l.message.msgs.length>1){w=l.getMsgNodeByMid(b[0].mid),N=function(){var e=w.one(".thread-body"),t=w.one(".thread-body .body"),n=e&&e.getAttribute("original_content"),r=!$.isDraftFid(l.getMsgFid(b[0])),i=t&&t.get("children").size()>0;return n||!o&&r&&i};if(N()){l.messageFound=1,l.showMessage(b[0],r[0],w,!1,"yes"),l.listNode.all(".loadhide").removeClass("loadhide"),l.getRoot()&&l.getRoot().one(".conv-loading").addClass("hidden");return}}e.fire("MessagePane:loadMessageCardsStart",l.message,b),d=l.requestAllMessages(b,l.message.fid,g,o,{stopwatch:u,RSstopwatch:v}),l.abortRequests(),l.outboundReq&&(l.request=d,l.requestType="loadcard")}function kt(t){var n=this,r=n.getMessageIdxByMid(t.mid),i=n.getMsgNodeByMid(t.mid),s=n.message.msgs[r];return!e.Lang.isValue(r)||!i||!s?!1:(i.hasClass("expanded")?n.scrollToMsg(s):(n.scrollOnExpansion=!0,n.expandMessages(r,"one","yes",!1)),!0)}function Lt(t){var n=this,r=n.getMsgNodeByMid(t.mid),i=n.getMessageIdxByMid(t.mid),s,o;i===0?n.listNode.set("scrollTop",0):(o=r.get("offsetTop")-12,e.use("anim",function(){var r=new e.Anim({node:n.listNode,duration:n.fullView?.2:0,to:{scroll:[0,o]}});r.run(),r.on("end",function(){s=n.getMsgFid(t),n.markConvMsgAsRead(s,t)})})),n.scrollOnExpansion=!1}function At(e,t,n){var r=this;r.toggleAllMessageCards(e,t,n)}function Ot(e,t,n){var r=this,i,s={};r.expandSuperCollapsedNodes(),r.lastExpandedMsgIdx=0,t==="expandall"?(n.toggleState="expanded",i=r.getMessageIdxByMid(r.message.msgs[0].mid),s.no_focus=!0,r.expandMessages(i,"all",!1,"no",s),e&&e.removeClass("thread-cards-collapsed"),e&&e.addClass("thread-cards-expanded"),e.setAttribute("title",strings.str_collapse_all_attr),e.one(".icon-text").setContent(strings.str_collapse_all)):(n.toggleState="collapsed",r.collapseAllMessageCards(),e&&e.removeClass("thread-cards-expanded"),e&&e.addClass("thread-cards-collapsed"),e.setAttribute("title",strings.str_expand_all_attr),e.one(".icon-text").setContent(strings.str_expand_all))}function Mt(e){var t=this,n=t.lastExpandedMsgIdx;if(!(t.message.msgs.length>n)){t.fetchMoreTimer=null;return}t.fetchMoreTimer=setTimeout(function(){t.expandMessages(n,"all",!1,"no",e)},100)}function _t(t,n,r,i,s,o,u){var a=this,f=a.message,l,c,h=null,p=[],d,v=0,m,g,y;switch(n){case"all":a.lastExpandedMsgIdx=a.lastExpandedMsgIdx?a.lastExpandedMsgIdx:0,u=!1,t=0,v=0;for(a.lastExpandedMsgIdx;a.lastExpandedMsgIdx<f.msgs.length;a.lastExpandedMsgIdx++){if(!(v<L)){a.fetchMoreMsgs(s);break}if($.isDraftFid(a.getMsgFid(f.msgs[a.lastExpandedMsgIdx])))continue;p.push(a.lastExpandedMsgIdx),v++}a.scrollLoad=!0,a.expandAllMode=!0;break;case"one":p.push(t);break;case"unread":case"other-unread":m=n==="other-unread"?t:0,u=u&&n==="unread",y=function(e){a.expandMessages(e+1,"other-unread",!1,!1,{scroll_to_msg:!1,no_show_hidden_cards:!0,no_focus:!0})};for(d=m;d<f.msgs.length;d++){if($.isDraftFid(a.getMsgFid(f.msgs[d]))||n==="other-unread"&&d===0)continue;if(!f.msgs[d].flags.isRead){if(!(v<k))break;if(h===null&&n==="unread"){h=d,t=h,p.push(d),g=d,a.fetchOther=e.Lang.later(P,a,y,g);break}n==="other-unread"&&p.push(d),v++}}!p.length&&n!=="other-unread"&&(t=f.msgs.length-1,p.push(t));break;case"adjacent":l=t,t+C+1>f.msgs.length?c=f.msgs.length:c=t+C+1;for(l;l<c;l++)p.push(l);break;case"send":case"other-send":t=null;for(d=0;d<f.msgs.length;d++)a.getMsgFid(f.msgs[d])==="Sent"&&(p.push(d),t=d);n==="other-send"&&p.length&&p.pop();break;case"draft":t=null,u=!1,a.listNode.all(".loadhide").removeClass("loadhide"),a.getRoot()&&a.getRoot().one(".conv-loading").addClass("hidden")}a.selMsgIdx=t,u&&e.Lang.isNumber(t)&&(a.primaryMid=a.message.msgs[t].mid),a.loadMessageCards(t,p,r,i,s,o,n)}function Dt(e){var t=this,n=parseInt(e.getComputedStyle("height"),10);e.setStyles({height:n+"px",overflow:"hidden"}),setTimeout(function(){e.setStyle("transition",""),e.setStyle("height",D+"px"),M.enabled("messageReadPaneV2")&&e.removeClass("expanded")},0),setTimeout(function(){e.removeClass("expanded"),e.setAttribute("aria-expanded","false"),e.one(".thread-body").setContent(""),t.fire("darlaEvent",{action:t.fullView?"message_tabpane":"msgread_reading_pane"}),t.fire("MessagePane:unload",e),Y()},200)}function Pt(t,n,r,i,s,o,u){function E(e,t){h=a.getMsgFid(e),t.inRegion(a.listNode)&&t.hasClass("expanded")&&t.hasClass("unread")&&a.markConvMsgAsRead(h,e)}var a=this,f,l=t.mid,c=this.getMsgMarkUp(t,!0,i),h,p=s!==!1,v,m,g,b,w;try{if(r.hasClass("collapsing")||r.hasClass("expanding"))return;return r.hasClass("thread-focus")&&(w=!0),r.replace(c),r=a.getMsgNodeByMid(l),w&&(a.selNode=r,a.focusMessageCard()),r.removeClass("loadhide"),t.body&&(r.one(".body").setContent(d.processBodyMarkup(t.body.display||"")),vt(r),a.autoLoadNonDisplaybleTruncMsg(t,r,n),p&&a.initialRender?(f=parseInt(r.getComputedStyle("height"),10),r.setStyles({transition:"none",height:D+"px"}),u&&a.scrollOnExpansion&&a.scrollToMsg(t),M.enabled("markExpandedAsRead")||E(t,r),a.fire("darlaEvent",{action:a.fullView?"message_tabpane":"msgread_reading_pane"}),setTimeout(function(){r.setStyle("transition",""),r.setStyle("height",f+"px")},0),e.later(200,r,r.setStyles,{height:"auto",overflow:"visible",transition:"none"})):r.setStyles({height:"auto",overflow:"visible",transition
:"none"}),d.plainTextMessage(t.part)?(v=r.one(".thread-body .body"))!==null&&(b="addClass"):b="removeClass",b&&v&&v.parentNode&&(v[b]("plaintextMsg"),v.parentNode[b]("compose"),b=undefined),r.removeClass("loading"),a.scrollTop&&(g=a.get("rootNode").one(R),setTimeout(function(){g.set("scrollTop",a.scrollTop)},200))),t.loading_error||a.convMsgRenderComplete(t,r,o),m=a.expandMessageTimers[y(t.mid)],m&&m.cancel(),e.fire("MessagePane:messageExpandDone",{mid:t.mid,cid:a.message.cid}),Y(),r}catch(S){typeof globals!="undefined"&&globals.report?globals.report("caughterror:..-build-mail-ui-mailpane-conv-convpaneread:4",S,"TRY_CATCH",1,1,1):window.console&&console.log&&console.log("caughterror:..-build-mail-ui-mailpane-conv-convpaneread:4")}}function Ht(e,t){var n,r,i=t||[],s,o=this;for(n=0;n<i.length;n++)r=i[n],s=o.getMsgNodeByMid(r.mid),s&&(s.addClass("load-error"),s.one(".load-error-msg").setContent(r.msgPermDeleted?strings.str_msg_deleted_error:strings.str_msg_load_error_generic))}function Bt(t,r,i,s,o,u,a,f,l){function b(){var n,r,i;r=e.Lang.isArray(t)?t[0]:t,n=c.getMsgNodeByMid(c.message.msgs[r].mid);if(!c.expandAllMode){l||(c.selNode=n);if(!a||y&&r>0)i=n,setTimeout(function(){a||(c.listNode&&c.listNode.all(".loadhide").removeClass("loadhide"),g.one(".conv-loading")&&g.one(".conv-loading").addClass("hidden")),y&&r>0&&c.listNode&&c.listNode.set("scrollTop",i.get("offsetTop")-12)},0)}else c.selNode=null}var c=this,h=0,p,d,v,m,g=this.getRoot(),y=u===!0;o&&o.start(1,"MessageInDOM");for(h=0;h<r.length;h++)p=r[h],d=c.getMessageIdxByMid(p.mid),v=c.getMsgNodeByMid(p.mid),f?(v.hasClass("expanded")||v.addClass("expanded"),c.convMsgRenderComplete(p,v,o)):$.isDraftFid(p.fid)||c.showMessage(p,d,v,i,s,o,y),M.enabled("markExpandedAsRead")&&c.markConvMsgAsRead(c.getMsgFid(p),p);f&&(g.all(".loadhide").removeClass("loadhide"),g.one(".conv-loading").addClass("hidden")),c.initialRender=!0,o&&(c.fire("renderConvComplete"),c.fullView&&c.fire("read-stat:renderCompleteOnUpdate"),NeoConfig.hasConvView&&setTimeout(function(){e.fire("tutorConvMsgPaneRendered")},200)),h=c.primaryMid?1:0,m=function(){var e=new n.Stopwatch(c.fullView?"MsgInTab":"MsgInPreview");e.wasCached=!0,e.stop()};for(;h<r.length;h++)setTimeout(m,(h+1)*250);c.primaryMid=null,c.parentNode&&c.parentNode.ancestor("body")?(b(),setTimeout(function(){M.enabled("markExpandedAsRead")?c.markExpandedMsgsAsRead():c.checkMsgCardsOnScroll(c.getAllCards())},300)):c.once("activeChange",function(){b(),setTimeout(function(){M.enabled("markExpandedAsRead")?c.markExpandedMsgsAsRead():c.checkMsgCardsOnScroll(c.getAllCards())},300)})}function jt(){var e=0,t=this.message.msgs;for(e=0;e<t.length;e++){var n=t[e];!n.flags.isRead&&n.body&&this.markConvMsgAsRead(this.getMsgFid(n),n)}}function Ft(){var e=this;return e.listNode?e.listNode.all("."+x):null}function It(e,t){t.scrollFocus&&this.listNode.set("scrollTop",e.get("offsetTop")-5)}function qt(e,t){var n=this,r={truncateAt:null},i=n.get("rootNode").one(R);n.scrollTop=i.get("scrollTop"),n.msgTrucationStatus.disabled[e.mid]=!0,n.expandMessages(t,"one","yes",!1,r)}function Rt(e,t){var n=this,r={midRequest:{blockImages:"none"}};n.expandMessages(t,"one","yes",!1,r)}function Ut(e,t,n){var r=this,i=r.message;t||(i.body=i.attachments=i.imgAttachments=i.nonImgAttachments=0),r.loadMessage(1,e,n)}function zt(){var e=this,t=e.loading_slow?2:1;e.loading_slow=e.loading_error=e.loading_moved=0,t>0&&t<=6&&(e.numRetries=e.numRetries?e.numRetries+1:1,e.numRetries>=e.maxRetries),e.loading_slow=e.loading_error=e.loading_moved=0,e.fireEvent("retry"),e.loadPaneContent(6,t),e.set("transferFocus",1)}function Wt(t,n){var r=this,i=t||[],s,o,u=i.length;if(NeoConfig.enableMessagePrefetch){e.fire("prefetchConversations",{fid:r.fid,cids:i});return}for(o=0;o<u;o++)s||(s=v.batch()),s.setAsReadOp(!0),g.batchAddConvPrefetch(s,o,r.fid,i[o],n);s&&s.execute({suppressCodes:["*"],backgroundLogs:["*"]})}function Xt(){var t=this,n;!NeoConfig.backButtonFull&&t.fullView===!0&&e.fire("initPage"),t.quickReplyBox&&(t.quickReplyBox.one("#switchtext-plain").addClass("hidden"),t.quickReplyBox.one("#switchtext-rich").removeClass("hidden")),NeoConfig.hasConvPerf&&t.fid!=="%40B%40Bulk"&&t.fid!=="Trash"&&!t.midtocid&&setTimeout(function(){t.prefetch(t.neighbors,"Neighbors")},Math.min(P+50,H)),t.fullView?n="thread_tabpane":n="msgread_reading_pane",e.fire("mt:view",{action:n})}function Vt(){}function $t(e,t){var n=this,r,i,s,o,u,a,f,l,p;r=e.msg,s=e.replace||0;if(n.message){i=e.pos!==undefined?e.pos:n.message.msgs.length,a=r.fid,r.header||(r=c.Messages.toMessage(a,r)),n.message.msgs.splice(i,s,r),n.message.midMap.splice(i,s,{fid:r.fid,mid:r.mid}),n.message=h.Conversations.calcConvSummary(n.message),p=n.message.msgs,u=p.length;for(o=0;o<u;o++)l=y(p[o].mid),n.midObjMap[l]=o;t&&(f=n.getMsgMarkUp(r,!1),n.quickReplyBox?n.listNode.insertBefore(f,n.quickReplyBox):n.listNode.append(f),n.expandMessages(n.message.msgs.length-1,"one","yes")),n.updateCount()}}function Jt(){var e=this,t,n=e.message.totalMsgs,r=e.getRoot().one(E);r&&(n>1?t="("+n+")":t="",r.set("innerHTML",t))}function Kt(){var t=e.one("#subject-field"),n=e.one(w+" .thread-subject");t.get("value")!==""?(n.set("innerHTML",t.get("value")),n.set("title",t.get("value"))):(n.set("innerHTML",strings["str_msg-view_no_subject"]),n.set("title",strings["str_msg-view_no_subject"]))}e.namespace("mail.ui");var t=e.mail.ui._ConvPane,n=e.common.Utils,r=n.substitute,i=n.ezSub,s=n.escapeHtml,o=n.ymmastats,u=n.unescapeHtml,a=e.ui.Templates,f=a._shared_module_thread_thread_display_rollup,l=e.mail,c=l.model.DataStore,h=l.model.ConvStore,p=l.ui.PaneUtils,d=l.ui.MessagePaneUtils,v=l.Controller,m=l&&l.Controller?l.Controller.Messages:{},g=l&&l.Controller?l.Controller.Conversations:{},y=c.Messages.getPermMidPart,b=h.Conversations.getPermCidPart,w=".message-header",E=w+" .summary",S=w+" .badge",x="thread-item",T="expanded",N="unread",C=2,k=NeoConfig.convMsgsToOpenCount||5,L=NeoConfig.convMsgsToOpenCount||5,A=e.mail.persist.MetaData,O=n.settings,M=n.features
,_=O.value("SUPER_COLLAPSE_THRESHOLD")||6,D=M.enabled("messageReadPaneV2")?24:21,P=10,H=175,B=5,j=strings.str_cfg_tog_hkr_siu===!0?"hkr_siu":"cg_siu",F=strings.str_cfg_tog_hkr_siu===!0,I={"http://mail.yimg.com/a/i/cal/bell4.gif":"bell","http://mail.yimg.com/a/i/us/pim/ybang_16x16_1.gif":"certified"},q=[],R=".thread-item-list",U=M.enabled("hideRecipients"),z=O.value("recipientThresholdVal")||5,W={to:!1,cc:!1,bcc:!1},X=M.enabled("rtePopoutToolbar"),V=M.enabled("squeezeToolbar"),$=e.mail.ui.FolderUtils,J=function(e){var t=this;e=e||{},J.superclass.constructor.call(t,e)};e.extend(J,l.ui.MailPaneRead,{setFullFormatters:tt,onSuccess:nt,bindPaneContent:gt,retryLoad:zt,unblockImages:Rt,viewFullMsg:qt,autoLoadNonDisplaybleTruncMsg:mt,changeRequest:Ut,searchRecipients:Vt,postRender:Xt,prefetch:Wt,getMsgMarkUp:et,selectMessage:kt,scrollToMsg:Lt,expandMessages:_t,collapseMessage:Dt,loadMessageCards:Ct,showMessage:Pt,showMessages:Bt,showNotification:Ht,setActiveCompose:it,getActiveCompose:rt,hasDrafts:xt,saveDrafts:st,insertMsgAtPos:$t,loadMenu:Nt,expandReplyCard:It,toggleAllMessageCards:Ot,handleToggleAllMessageCards:At,lftCongruencyCheck:yt,lftSendSaveCongruencyCheck:bt,expandSuperCollapsedNodes:wt,initializeCompose:St,initializeAllDrafts:Et,initReplyForward:Tt,updateCount:Jt,updateSubject:Kt,closeAllCompose:ot,markConvMsgAsRead:ut,convMsgRenderComplete:ft,bindContentUI:dt,fetchMoreMsgs:Mt,checkMsgCardsOnScroll:ht,checkAdsOnScroll:ct,scheduleScrollHandler:pt,onPaneScroll:lt,getAllCards:Ft,markAsReadBatch:at,getInboxService:Z,markExpandedMsgsAsRead:jt}),e.mix(t.prototype,J.prototype),e.mix(t.prototype,l.ui.MailPaneRead.prototype)},"1.0.0",{requires:["_shared_module_thread_thread_display_rollup","common-persist-user-data","common-ui-tabs-base","common-utils-stats","contacts-api","contacts-api-utils","mail-persist-meta-data","mail-platform","mail-ui-common-fonts","mail-ui-convpane-base","mail-ui-convpane-bind","mail-ui-mailpane-read","mail-ui-messagepane-utils","mail-ui-messagepane-warnings","mod-conversation-history_css","mail-common-utils-features","mail-common-utils-settings","mail-ui-pane-utils","common-utils","mail-ui-folder-utils"]});
YUI.add("mail-common-cachewarmer",function(B){B.namespace("mail.common.cachewarmer");var H=5000,L=3000,A=10,J=NeoConfig.pfm,N=50,D=B.Env._loader,K={isIdle:function(){return true;}},M=B.common.net.Session||K,I={},E=B.on("ds:msg:remove",function(Q,P){if(Q==="Inbox"){for(var O in P){I[P[O].mid]=true;}}}),G={},C=B.on("ds:conv:remove",function(Q,P){if(Q==="Inbox"){for(var O in P){G[P[O].cid]=true;}}});var F=function(O){try{return function(){this.queue[O].apply(this.queue,arguments);};}catch(P){typeof globals!=="undefined"&&globals.report?globals.report("caughterror:..-build-mail-common-cachewarmer:1",P,"TRY_CATCH",1,1,1):window.console&&console.log&&console.log("caughterror:..-build-mail-common-cachewarmer:1");}return false;};B.mail.common.cachewarmer={queue:(function(){var O=new B.AsyncQueue();O.defaults.timeout=N;return O;})(),add:function(){this.queue.add.apply(this.queue,arguments);return this;},run:function(){this.queue.add(this.queue.stop);this.queue.run();return this;},clear:function(){this.queue.stop();B.detach("cachewarmer:stopMessagePrefetch");},warmUp:function(Q,R,P,O){P&&this.addDelay(P);!O&&this.addIdleCheck();if(B.Lang.isArray(R)&&R.length){this.queue.add({fn:function(){B.use.apply(B,R);},timeout:10,id:Q});return this;}return false;},addDelay:function(O){if(O){this.queue.add({fn:function(){},timeout:O});return true;}return false;},addIdleCheck:function(Q){var O=0,P=this.queue;Q=Q||A;P.add({fn:function(){O++;},timeout:400,until:function(){return(M.isIdle()&&(!D||!D._loading))||(O===Q&&P.stop());}});return true;},setupLaunch:function(O){this.addDelay(O?L:H);this.addIdleCheck();return true;},preFetchMessages:function(R,Q,P,O){if(NeoConfig.hasConv){return;}this.clear();P&&this.addDelay(P);(R==="Inbox"&&!Q)?this.addInboxPreFetching():this._preFetchMessages(R,Q,O);return this.run();},addInboxPreFetching:function(){var O=this;if(NeoConfig.hasConv&&NeoConfig.hasConvPerf){O._preFetchConvs("Inbox",B.mail.ui.ConvList.getConvHdrList(),null,true);}else{if(!NeoConfig.hasConv){O._preFetchMessages("Inbox",B.mail.ui.MessageList.getMsgHdrList(),null,true);}}},_preFetchConvs:function(P,d,O,b){function R(e,h,g){var f=function(){var k=[],j;for(j in e){if(!G[e[j].cid]){k.push(e[j]);}}if(k.length>0){V=B.mail.Controller.batch();V.setAsReadOp(true);for(j=0;j<k.length;j++){if(!B.mail.model.ConvStore.Conversations.isCached(P,k[j].cid)){B.mail.Controller.Conversations.batchAddConvPrefetch(V,j,P,k[j],"CacheWarmer");}}V.execute({suppressCodes:["*"],backgroundLogs:["*"]});}else{}if(h){B.detach(g);}};this.timeout=100;this.id="convsPrefetch";this.fn=f;}var U,Q,X=[],V,Y,c,T,S=J.batch.split(","),W=J.count,a=J.maxSize,Z=B.mail.ui.ConvList;if(O&&O[0]){X=O;}else{Z&&d&&Z.getNeighbors(d,-1,X,P,W,a);}while((T=S.shift()||10)&&(c=X.splice(0,T))&&(Q=c.length)){Y=[];for(U=0;U<Q;U++){Y.push(c[U]);}this.addIdleCheck();this.queue.add(new R(Y,b,C));}B.once("cachewarmer:stopMessagePrefetch",function(e){var f=["convsPrefetch"];this.queue.remove("convsPrefetch");this.clear();if(!B.Lang.isUndefined(e)&&B.Lang.isFunction(e.done)){if(!B.Lang.isUndefined(e.data)){f.push(e.data);}e.done.apply(this,f);}},this);this.queue.on("complete",function(){B.detach("cachewarmer:stopMessagePrefetch");});return true;},_preFetchMessages:function(O,Y,V,b){function Q(d,g,f){var e=function(){var j=[];for(var h in d){if(!I[d[h].mid]){j.push(d[h]);}}if(j.length>0){B.mail.Controller.Messages.get({fid:O,prefetch:j,cachekey:"CacheWarmer"},{suppressCodes:["*"],backgroundLogs:["*"]});}else{}if(g){B.detach(f);}};this.timeout=10;this.id="messagePrefetch";this.fn=e;}if(!J||NeoConfig.hasConv){return false;}if(NeoConfig.grid){J.batch="6,6";J.count=12;}var U,P,X=[],Z,c,T,S=J.batch.split(","),W=J.count,a=J.maxSize,R=B.mail.ui.MessageList;if(V&&V[0]){X=V;}else{R&&Y&&R.getNeighbors(Y,-1,X,O,W,a);}while((T=S.shift()||10)&&(c=X.splice(0,T))&&(P=c.length)){Z=[];for(U=0;U<P;U++){Z.push(c[U]);}this.addIdleCheck();this.queue.add(new Q(Z,b,E));}B.once("cachewarmer:stopMessagePrefetch",function(d){var e=["messagePrefetch"];this.queue.remove("messagePrefetch");this.clear();if(!B.Lang.isUndefined(d)&&B.Lang.isFunction(d.done)){if(!B.Lang.isUndefined(d.data)){e.push(d.data);}d.done.apply(this,e);}},this);this.queue.on("complete",function(){B.detach("cachewarmer:stopMessagePrefetch");});return true;},addCompose:function(P,O,Q){this.warmUp("compose",Q,P,O);},before:F("before"),on:F("on"),after:F("after"),fire:F("fire")};},"1.0.0",{requires:["async-queue","loader","common-net-session","mail-controller-messages"]});