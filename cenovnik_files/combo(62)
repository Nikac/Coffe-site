YUI.add("tictac-mim-strings",function(a){a.namespace("Tictac.mim").strings={str_add_error_noval:"You must enter a Yahoo Messenger ID or a phone number.",str_add_error_phone:"The phone number you entered is invalid.",str_branding_messenger_generic_lower:"messenger",str_branding_messenger_generic:"Messenger",str_branding_messenger_generic_upper:"MESSENGER",str_branding_messenger:"Yahoo Messenger",str_click_to_hide_contacts:"Click to hide messenger contacts",str_click_to_show_contacts:"Click to show messenger contacts",str_comp_send_error:"Sorry, there was a problem sending your message. Please try again.",str_cont_add_contact_error_id_already_in_list:"{{user}} already exists in your Yahoo Messenger List.",str_cont_add_contact_error_invalid_email:"Please enter a valid email address format: name@example.com.",str_cont_add_contact_error_invalid_id:"{{user}} is not a valid {{network}} ID.",str_cont_add_request_denied_body:"{{user}} has denied your request to add them to your Yahoo Messenger List.",str_cont_add_request_denied_header:"Add to Yahoo Messenger List Request Denied",str_cont_add_to_cont:"Add to Contacts",str_cont_edit_cont:"Edit Contact",str_cont_list_default_group_empty:"Send IM and SMS from Yahoo Messenger. <a href",str_cont_list_default_group_sign_out_msg_fresh:"You're signed out of Yahoo Messenger. Click {{bttn_img}}to sign in.",str_cont_list_default_group_sign_out_msg:"You are signed out of Yahoo Messenger. Click the{{bttn_img}}to sign in.",str_cont_list_status_away:"Away",str_cont_list_status_be_right_back:"Be right back",str_cont_list_status_busy:"Busy",str_cont_list_status_idle:"Idle",str_cont_list_status_not_at_home:"Not at home",str_cont_list_status_not_at_my_desk:"Not at my desk",str_cont_list_status_not_in_the_office:"Not in the office",str_cont_list_status_on_the_phone:"On the phone",str_cont_list_status_on_vacation:"On vacation",str_cont_list_status_out_to_lunch:"Out to lunch",str_cont_list_status_stepped_out:"Stepped out",str_conv_accepted_add_req:"<strong>{{conversation_user}}</strong> has been added to your Messenger list.",str_conv_add_requests:"Add Requests",str_conv_add_requests_desc:"These people would like to add you to their {{str_msgr_messenger}} list.",str_conv_btn_accept:"Accept",str_conv_btn_accept_attr:"Allow {{conversation_yid}} to add me and see when I'm online",str_conv_btn_add_to_contacts:"Add to Contacts",str_conv_btn_add_to_contacts_attr:"Add {{conversation_yid}} to your Contacts",str_conv_btn_block_user_attr:"Add to Blocked List",str_conv_btn_block_user:"Block User",str_conv_btn_decline_attr:"Don't allow {{conversation_yid}} to add me or see when I'm online",str_conv_btn_decline_block:"Decline and Block",str_conv_btn_decline:"Decline",str_conv_btn_hide_recent_conv:"Hide Recent Conversations",str_conv_btn_show_recent_conv:"Show Recent Conversations",str_conv_btn_unblock_user_attr:"Remove {{conversation_yid}} from your Blocked List",str_conv_btn_unblock_user:"Unblock User",str_conv_close_confirm:"You have unread messages. Are you sure you want to close the window?",str_conv_default_group:"Friends",str_conv_enter_phone_number_label:"Enter a mobile phone number for <b>{{conversation_user}}</b>:",str_conv_enter_phone_number_label_no_user:"a mobile phone number for <b>{{conversation_user}}</b>:",str_conv_error_empty_general:"All fields are required.",str_conv_imconv_new_hint:"Enter a Messenger ID for this user.",str_conv_new_hint:"Start a new instant message or SMS message.<br>Enter a Messenger ID, email, or mobile number.",str_conv_new_message_browser_title:"{{conversation_user}} sent you a new message.",str_conv_no_contact_add_request:"<b>{{conversation_yid}}</b> would like to add you to his or her Yahoo Messenger List.",str_conv_prompt_tab:"View Yahoo Messenger Conversations in a tab!",str_conv_report_abuse_attr:"Report Abuse",str_conv_report_abuse_description:"Report this user for threats, harassment, harm to minors, or indecent content.  The transcript of your conversation with this person will be included in your report.",str_conv_report_abuse_radio:"Report Threats or Harassment",str_conv_report_abuse:"Report Abuse",str_conv_report_abuse_title:"Yahoo Messenger Report Abuse",str_conv_report_spam_description:"Stop receiving messages with bad links, phishing attempts, or any unwanted communication.",str_conv_report_spam_radio:"Report Spam",str_conv_self_objective:"Me",str_conv_show_all_history:"Show Full History",str_conv_signed_out_hint:"You are not signed in to Yahoo Messenger. Please sign in to start a new conversation.",str_conv_sms_input_title:"Compose SMS",str_conv_spam_reported_description_bl:"To permanently block this contact from sending you messages, add {{user}} to your Block list in Messenger Settings.",str_conv_spam_reported_description_bottom:"<strong>{{userid}}</strong> has also been blocked, and you will no longer receive messages from this user.",str_conv_spam_reported_description_top:"Thank you. Every IM you report as spam helps SpamGuard work better.",str_conv_tab_close_confirm:"You have unread messages, are you sure you want to close this conversation?",str_conv_typing:"{{conversation_user}} is typing...",str_conv_user_notification_ssa_button:"Open Yahoo Messenger Settings",str_conv_user_notification_ssa_dismiss_button:"Dismiss",str_conv_user_offlineMessage_notice:"Messages sent to you while you were signed out:",str_conv_user_sms_edit_number_attr:"Edit number",str_conv_user_sms_edit_number:"Edit number",str_conv_user_sms_notice_error_failed_to_deliver:"SMS could not be sent to <b>{{number}}</b>. It may be an invalid mobile number, formatted incorrectly, or no longer in service.",str_conv_user_sms_notice_error_ration_breached:"<b>{{user}}</b> must reply to one of your messages before you can send any more.",str_conv_user_sms_notice_error_system_busy:"SMS could not be sent to {{number}}. The system is currently busy. Please try again later.",str_conv_user_statexfer_notice:"Your ongoing conversation with {{conversation_user}}...",str_conv_wrn_interop_add_request_pending:"To IM with {{user}}, they must first accept your request to add them to your Messenger List contacts. Your request is still pending.",str_conv_wrn_unblock_user:"<em>You have blocked <span><strong>{{userid}}</strong></span>.</em>  You cannot send and receive instant messages from blocked users.",str_conv_wrn_unknown_interop_user:"To send IM to {{user}}, they must first accept your request to add them to your Messenger List contacts.",str_conv_wrn_unknown_user:"<em><span><strong>{{userid}}</strong></span> is not in your contacts.</em>  Be careful when corresponding with people you don't know. Never share private information with them.",str_country_argentina:"Argentina",str_country_australia:"Australia",str_country_brazil:"Brazil",str_country_canada:"Canada",str_country_chile:"Chile",str_country_china:"China",str_country_denmark:"Denmark",str_country_finland:"Finland",str_country_france:"France",str_country_germany:"Germany",str_country_greece:"Greece",str_country_hong_kong:"Hong Kong",str_country_india:"India",str_country_indonesia:"Indonesia",str_country_ireland:"Ireland",str_country_italy:"Italy",str_country_kuwait:"Kuwait",str_country_malaysia:"Malaysia",str_country_mexico:"Mexico",str_country_netherlands:"Netherlands",str_country_new_zealand:"New Zealand",str_country_norway:"Norway",str_country_pakistan:"Pakistan",str_country_peru:"Peru",str_country_philippines:"Philippines",str_country_poland:"Poland",str_country_romania:"Romania",str_country_singapore:"Singapore",str_country_south_korea:"South Korea",str_country_spain:"Spain",str_country_sweden:"Sweden",str_country_taiwan:"Taiwan",str_country_thailand:"Thailand",str_country_turkey:"Turkey",str_country_united_kingdom:"United Kingdom",str_country_united_states:"United States",str_country_venezuela:"Venezuela",str_country_vietnam:"Vietnam",str_custom_status_title:"Custom Status",str_del_contact_msg_ab_only_desc:"Are you sure you want to delete {{contact_highlighted}} from your Online Contacts?{{line_spacing}}This is a contact shared by Messenger and Mail. Deleting {{contact}} will also delete this contact from Mail.{{line_spacing}}Instead of deleting, you can change Online Contacts to show only Messenger List contacts in {{open_msg_link}}{{str_messenger_options}}{{close_msg_link}}.",str_del_contact_msg_header:"Delete Contact",str_del_contact_msg_messenger_desc:"Are you sure you want to delete {{contact_highlighted}} from your Messenger contacts?",str_del_contact_msg_not_deleted_ab:"Because {{contact_highlighted}} is a contact shared by Messenger and Mail, {{contact_highlighted}} may continue to show in Online Contacts.{{line_spacing}}You can change Online Contacts to show only Messenger List contacts in {{open_msg_link}}{{str_messenger_options}}{{close_msg_link}}.",str_error_disconnected_error:"You have been disconnected from Yahoo Messenger.",str_error_recent_messages_empty:"You have no recent conversations with {{contact}}.",str_label_sign_in_messenger:"Sign In to Yahoo Messenger button",str_menu_appear_offline:"Appear Offline to {{contact_name}}",str_menu_appear_online:"Appear Online to {{contact_name}}",str_menu_available:"Available",str_menu_busy:"Busy",str_menu_idle:"Idle",str_menu_invisible:"Invisible",str_menu_messenger_options:"Messenger Settings",str_menu_offline:"Offline",str_menu_sign_in_messenger:"Sign In to Yahoo Messenger",str_menu_sign_out_messenger:"Sign Out of Yahoo Messenger",str_msgr_cl_sign_in:"Sign In to Messenger",str_msgr_cl_sign_in_who_is_online:"Sign in to Messenger to see who's online.",str_msgr_cl_sign_out:"Sign Out of Messenger",str_msgr_em_angel:"angel",str_msgr_em_angry:"angry",str_msgr_em_applause:"applause",str_msgr_em_batting_eyelashes:"batting eyelashes",str_msgr_em_big_grin:"big grin",str_msgr_em_big_hug:"big hug",str_msgr_em_blushing:"blushing",str_msgr_em_broken_heart:"broken heart",str_msgr_em_call_me:"call me",str_msgr_em_catch:"catch",str_msgr_em_cheer:"cheer",str_msgr_em_clown:"clown",str_msgr_em_cold:"cold",str_msgr_em_confused:"confused",str_msgr_em_cook:"cook",str_msgr_em_cool:"cool",str_msgr_em_cowboy:"cowboy",str_msgr_em_crying:"crying",str_msgr_em_daydreaming:"day dreaming",str_msgr_em_devilish:"devilish",str_msgr_em_dizzy:"dizzy",str_msgr_em_doh:"d'oh!",str_msgr_em_down_on_luck:"down on luck",str_msgr_em_drooling:"drooling",str_msgr_em_eat:"eat",str_msgr_em_exercise:"exercise",str_msgr_em_fight:"fight",str_msgr_em_gift:"gift",str_msgr_em_give_up:"give up",str_msgr_em_high_five:"high five",str_msgr_em_hot:"hot",str_msgr_em_hypnotized:"hypnotized",str_msgr_em_kiss:"kiss",str_msgr_em_label:"{{shortcut}} {{description}}",str_msgr_em_laughing:"laughing",str_msgr_em_liar:"liar",str_msgr_em_loser:"loser",str_msgr_em_lovestruck:"lovestruck",str_msgr_em_music:"music",str_msgr_em_nail_biting:"nail biting",str_msgr_em_nerd:"nerd",str_msgr_em_not_talking:"not talking",str_msgr_em_on_the_phone:"on the phone",str_msgr_em_party:"party",str_msgr_em_phbbbt:"phbbbt",str_msgr_em_play_game:"play game",str_msgr_em_puke:"puke",str_msgr_em_raised_eyebrow:"raised eyebrow",str_msgr_em_rofl:"rolling on the floor laughing",str_msgr_em_rolling_eyes:"rolling eyes",str_msgr_em_sad:"sad",str_msgr_em_searching:"searching",str_msgr_em_shh:"don't tell anyone shh!",str_msgr_em_sick:"sick",str_msgr_em_sigh:"sigh",str_msgr_em_silly:"silly",str_msgr_em_sing:"sing",str_msgr_em_sleepy:"sleepy",str_msgr_em_smile:"smile",str_msgr_em_smug:"smug",str_msgr_em_spooky:"spooky",str_msgr_em_straight_face:"straight face",str_msgr_em_studying:"studying",str_msgr_em_surprise:"surprise",str_msgr_em_talk_to_the_hand:"talk to the hand",str_msgr_em_thinking:"thinking",str_msgr_em_time_out:"time out",str_msgr_em_tongue:"tongue",str_msgr_em_tv:"tv",str_msgr_em_unlucky:"unlucky",str_msgr_em_waiting:"waiting",str_msgr_em_wave:"wave",str_msgr_em_whew:"whew!",str_msgr_em_wink:"wink",str_msgr_em_wits_end:"at wits' end",str_msgr_em_worried:"worried",str_msgr_em_yawn:"yawn",str_msgr_server_error_10:"The operation failed because you have reached the maximum number of ignored users.",str_msgr_server_error_12:"The operation failed because the user is in your Contact List.",str_msgr_server_error_1:"There was a problem handling your request, please retry the operation.",str_msgr_server_error_28:"Your session has expired, please login and try again.",str_msgr_server_error_2:"The operation failed because the user already exists.",str_msgr_server_error_32:"The operation failed because the Group ID is invalid.",str_msgr_server_error_33:"The operation failed because the user is in your Ignore List.",str_msgr_server_error_3:"The operation failed because the user does not exist.",str_msgr_server_error_42:"The operation failed because you have reached the maximum number of pending Add Requests.",str_msgr_server_error_4:"Authentication failed.",str_msgr_server_error_53:"The login failed because you have reached the maximum number of simultaneous sessions.",str_msgr_server_error_59:"The operation failed because the user appears to be offline.",str_msgr_server_error_6:"The operation failed because you have reached the maximum number of contacts.",str_msgr_server_error_7:"The operation failed because you have reached the maximum number of groups.",str_msgr_server_error_8:"The operation failed because the group already exists.",str_msgr_server_error_self:"The operation failed because this is the signed in user.",str_nav_opt_msg_title:"Messenger Settings",str_opt_conv_win_style:"This is how your Yahoo Messenger conversation window will be displayed.",str_opt_msg_blocked_ignorelist_offline:"You must be signed in to Yahoo Messenger to manage your block list.",str_opt_msg_general_heading_history:"Conversation History",str_opt_msg_general_heading_logout:"Sign Out",str_opt_msg_general_history_description:"Yahoo Messenger can keep a history of all your conversations. You can browse and search your history from any computer you sign in to.",str_opt_msg_list_show_buddyonly:"Show only Yahoo Messenger List Contacts",str_opt_msg_phonecountry_label:"{{country_name}} (+{{country_code}})",str_session_display_name_order:"{{firstName}} {{lastName}}",str_session_title_order:"{{displayName}} ({{user}})",str_signout_msg_general_description:"You are signed in to Yahoo Messenger in multiple places. Where do you want to sign out?",str_unread_messages_plural:"You have {{count}} new messages.",str_unread_messages_single:"You have a new message.",str_urls_report_abuse_no_trans:"http://help.yahoo.com/l/us/yahoo/messenger/forms/abusetranscript.html",str_window_btn_popin:"Pop in conversation back to Yahoo Messenger",str_window_title_addcontact:"Yahoo Messenger Add Contact Dialog",str_window_title_alert:"Yahoo Messenger Confirm Dialog",str_window_title_conversation:"Yahoo Messenger Conversation Window",str_window_title_main:"Yahoo Messenger Contact List",str_window_title_options:"Yahoo Messenger Settings Dialog",str_window_title_signout:"Yahoo Messenger Sign Out Confirmation Dialog",str_window_title_smsinput:"Yahoo Messenger SMS Number Input Dialog",last:null}},"1.0.0");YUI.add("base-bidi",function(A){A.mix(A.namespace("Tictac.base.bidi"),{_rtlChars:"[\uD83A\uD83B][\uDC00-\uDFFF]|[\u0590\u05BE\u05C0\u05C3\u05C6\u05C8-\u05FF\u0604\u0605\u0608\u060B\u060D\u061B-\u064A\u065F\u066D-\u066F\u0671-\u06D5\u06E5\u06E6\u06EE\u06EF\u06FA-\u070E\u0710\u0712-\u072F\u074B-\u07A5\u07B1-\u07EA\u07F4\u07F5\u07FA-\u0815\u081A\u0824\u0828\u082E-\u08FF\u200F\uFB1D\uFB1F-\uFB28\uFB2A-\uFD3D\uFD40-\uFDCF\uFDF0-\uFDFC\uFDFE\uFDFF\uFE70-\uFEFE]|\uD803[\uDC00-\uDE5F\uDE7F-\uDFFF]|\uD802[\uDC00-\uDD1E\uDD20-\uDE00\uDE04\uDE07-\uDE0B\uDE10-\uDE37\uDE3B-\uDE3E\uDE40-\uDF38\uDF40-\uDFFF]",_neutralChars:"[\uDB40-\uDB43][\uDC00-\uDFFF]|\uD802[\uDD1F\uDE01-\uDE03\uDE05\uDE06\uDE0C-\uDE0F\uDE38-\uDE3A\uDE3F\uDF39-\uDF3F]|\uD804[\uDC80\uDC81\uDCB3-\uDCB6\uDCB9\uDCBA]|\uD803[\uDE60-\uDE7E]|\uD800[\uDD01\uDD40-\uDD8A\uDD90-\uDD9B\uDDFD]|[\uD83F\uD87F\uD8BF\uD8FF\uD93F\uD97F\uD9BF\uD9FF\uDA3F\uDA7F\uDABF\uDAFF\uDB3F\uDB7F\uDBBF\uDBFF][\uDFFE\uDFFF]|\uD83C[\uDC00-\uDC2B\uDC30-\uDC93\uDD00-\uDD0A]|[\u0000-\u0040\u005B-\u0060\u007B-\u00A9\u00AB-\u00B4\u00B6-\u00B9\u00BB-\u00BF\u00D7\u00F7\u02B9\u02BA\u02C2-\u02CF\u02D2-\u02DF\u02E5-\u02ED\u02EF-\u036F\u0374\u0375\u037E\u0384\u0385\u0387\u03F6\u0483-\u0489\u058A\u0591-\u05BD\u05BF\u05C1\u05C2\u05C4\u05C5\u05C7\u0600-\u0603\u0606\u0607\u0609\u060A\u060C\u060E-\u061A\u064B-\u065E\u0660-\u066C\u0670\u06D6-\u06E4\u06E7-\u06ED\u06F0-\u06F9\u070F\u0711\u0730-\u074A\u07A6-\u07B0\u07EB-\u07F3\u07F6-\u07F9\u0816-\u0819\u081B-\u0823\u0825-\u0827\u0829-\u082D\u0900-\u0902\u093C\u0941-\u0948\u094D\u0951-\u0955\u0962\u0963\u0981\u09BC\u09C1-\u09C4\u09CD\u09E2\u09E3\u09F2\u09F3\u09FB\u0A01\u0A02\u0A3C\u0A41\u0A42\u0A47\u0A48\u0A4B-\u0A4D\u0A51\u0A70\u0A71\u0A75\u0A81\u0A82\u0ABC\u0AC1-\u0AC5\u0AC7\u0AC8\u0ACD\u0AE2\u0AE3\u0AF1\u0B01\u0B3C\u0B3F\u0B41-\u0B44\u0B4D\u0B56\u0B62\u0B63\u0B82\u0BC0\u0BCD\u0BF3-\u0BFA\u0C3E-\u0C40\u0C46-\u0C48\u0C4A-\u0C4D\u0C55\u0C56\u0C62\u0C63\u0C78-\u0C7E\u0CBC\u0CCC\u0CCD\u0CE2\u0CE3\u0CF1\u0CF2\u0D41-\u0D44\u0D4D\u0D62\u0D63\u0DCA\u0DD2-\u0DD4\u0DD6\u0E31\u0E34-\u0E3A\u0E3F\u0E47-\u0E4E\u0EB1\u0EB4-\u0EB9\u0EBB\u0EBC\u0EC8-\u0ECD\u0F18\u0F19\u0F35\u0F37\u0F39-\u0F3D\u0F71-\u0F7E\u0F80-\u0F84\u0F86\u0F87\u0F90-\u0F97\u0F99-\u0FBC\u0FC6\u102D-\u1030\u1032-\u1037\u1039\u103A\u103D\u103E\u1058\u1059\u105E-\u1060\u1071-\u1074\u1082\u1085\u1086\u108D\u109D\u135F\u1390-\u1399\u1400\u1680\u169B\u169C\u1712-\u1714\u1732-\u1734\u1752\u1753\u1772\u1773\u17B7-\u17BD\u17C6\u17C9-\u17D3\u17DB\u17DD\u17F0-\u17F9\u1800-\u180E\u18A9\u1920-\u1922\u1927\u1928\u1932\u1939-\u193B\u1940\u1944\u1945\u19DE-\u19FF\u1A17\u1A18\u1A56\u1A58-\u1A5E\u1A60\u1A62\u1A65-\u1A6C\u1A73-\u1A7C\u1A7F\u1B00-\u1B03\u1B34\u1B36-\u1B3A\u1B3C\u1B42\u1B6B-\u1B73\u1B80\u1B81\u1BA2-\u1BA5\u1BA8\u1BA9\u1C2C-\u1C33\u1C36\u1C37\u1CD0-\u1CD2\u1CD4-\u1CE0\u1CE2-\u1CE8\u1CED\u1DC0-\u1DE6\u1DFD-\u1DFF\u1FBD\u1FBF-\u1FC1\u1FCD-\u1FCF\u1FDD-\u1FDF\u1FED-\u1FEF\u1FFD\u1FFE\u2000-\u200D\u2010-\u2070\u2074-\u207E\u2080-\u208E\u20A0-\u20B8\u20D0-\u20F0\u2100\u2101\u2103-\u2106\u2108\u2109\u2114\u2116-\u2118\u211E-\u2123\u2125\u2127\u2129\u212E\u213A\u213B\u2140-\u2144\u214A-\u214D\u2150-\u215F\u2189\u2190-\u2335\u237B-\u2394\u2396-\u23E8\u2400-\u2426\u2440-\u244A\u2460-\u249B\u24EA-\u26AB\u26AD-\u26CD\u26CF-\u26E1\u26E3\u26E8-\u26FF\u2701-\u2704\u2706-\u2709\u270C-\u2727\u2729-\u274B\u274D\u274F-\u2752\u2756-\u275E\u2761-\u2794\u2798-\u27AF\u27B1-\u27BE\u27C0-\u27CA\u27CC\u27D0-\u27FF\u2900-\u2B4C\u2B50-\u2B59\u2CE5-\u2CEA\u2CEF-\u2CF1\u2CF9-\u2CFF\u2DE0-\u2E31\u2E80-\u2E99\u2E9B-\u2EF3\u2F00-\u2FD5\u2FF0-\u2FFB\u3000-\u3004\u3008-\u3020\u302A-\u3030\u3036\u3037\u303D-\u303F\u3099-\u309C\u30A0\u30FB\u31C0-\u31E3\u321D\u321E\u3250-\u325F\u327C-\u327E\u32B1-\u32BF\u32CC-\u32CF\u3377-\u337A\u33DE\u33DF\u33FF\u4DC0-\u4DFF\uA490-\uA4C6\uA60D-\uA60F\uA66F-\uA673\uA67C-\uA67F\uA6F0\uA6F1\uA700-\uA721\uA788\uA802\uA806\uA80B\uA825\uA826\uA828-\uA82B\uA838\uA839\uA874-\uA877\uA8C4\uA8E0-\uA8F1\uA926-\uA92D\uA947-\uA951\uA980-\uA982\uA9B3\uA9B6-\uA9B9\uA9BC\uAA29-\uAA2E\uAA31\uAA32\uAA35\uAA36\uAA43\uAA4C\uAAB0\uAAB2-\uAAB4\uAAB7\uAAB8\uAABE\uAABF\uAAC1\uABE5\uABE8\uABED\uFB1E\uFB29\uFD3E\uFD3F\uFDD0-\uFDEF\uFDFD\uFE00-\uFE19\uFE20-\uFE26\uFE30-\uFE52\uFE54-\uFE66\uFE68-\uFE6B\uFEFF\uFF01-\uFF20\uFF3B-\uFF40\uFF5B-\uFF65\uFFE0-\uFFE6\uFFE8-\uFFEE\uFFF0-\uFFFF]|\uD835[\uDEDB\uDF15\uDF4F\uDF89\uDFC3\uDFCE-\uDFFF]|\uD834[\uDD67-\uDD69\uDD73-\uDD82\uDD85-\uDD8B\uDDAA-\uDDAD\uDE00-\uDE45\uDF00-\uDF56]",_initializeBidiPatterns:function(){this._rtlPattern=new RegExp("^(?:"+this._neutralChars+")*(?:"+this._rtlChars+")");this._neturalPattern=new RegExp("^(?:"+this._neutralChars+")*$");},setBidiChars:function(B,C){if(B!==undefined){this._rtlChars=B;}if(C!==undefined){this._neutralChars=C;}this._initializeBidiPatterns();},detectDirection:function(C,B){if(this._rtlPattern.test(C)){return"rtl";}else{if(B==="ltr"){return"ltr";}else{if(this._neturalPattern.test(C)){if(B==="rtl"){return"rtl";}else{return"";}}else{return"ltr";}}}}});A.Tictac.base.bidi._initializeBidiPatterns();A.mix(A.namespace("Tictac.base.bidi"),{bidiDirection:A.Tictac.base.bidi.detectDirection});},"1.0.0");
"use strict";YUI.add("tictac-base-richselect",function(a){function b(){b.superclass.constructor.apply(this,arguments)}var c=a.Tictac.base.rollups,d=a.Tictac.base.ViewUtils;b.NAME="tt-richselect",b.ATTRS={showArrow:!0,classes:"",name:"",items:{value:[]},selectedIndex:{value:0,setter:function(b){var c,d,e;if(this._rendered){if(a.Array.test(b))for(d=0,e=b.length;e>d;d++)b[d]=void 0===b[d]?0:b[d],c=this.get("items")[d][b[d]],this._buttonNode.one(".btn-text").setContent(c.text),this._buttonNode.setAttribute("data-value",c.value);else c=this.get("items")[b],this._buttonNode.one(".btn-text").setContent(c.text),this._buttonNode.setAttribute("data-value",c.value);this._buttonNode.setAttribute("unselectable","on")}return b}},tooltip:{value:""}},a.extend(b,a.Base,{initializer:function(){this._listeners=[],this._deferOpenMenuListeners=null,this._closeListener=null,this._rendered=!1,this.publish("change",{emitFacade:!1})},destructor:function(){for(;this._listeners.length;)this._listeners.pop().detach();this._deferOpenMenuListeners&&this._deferOpenMenuListeners.cancel(),this._closeListener&&this._closeListener.detach(),this._buttonNode&&this._buttonNode.remove(!0),this._menuNode&&this._menuNode.remove(!0)},render:function(b,d){var e,f,g,h,i,j,k,l,m,n=this,o=n.get("items"),p=n.get("name"),q=n.get("selectedIndex"),r=n.get("classes");if(!o||!o.length)throw new Error("Cannot call render without first populating the menu with at least one item");for(b.one||(b=a.one(b)),n._multiple=0!==a.Array.test(o[0]),m=b.get("ownerDocument").getDOMNode(),n._buttonNode=a.Node.create(c.richselect_button({buttonText:o[q].text,tooltip:n.get("tooltip"),value:o[q].value,name:p,showArrow:n.get("showArrow")}),m),n._menuNode=a.Node.create(c.richselect_menu(),m),n._multiple?n.set("selectedIndex",new Array(o.length)):o=[o],f=0,g=o.length;g>f;f++)for(k=o[f],l=a.Node.create("<ul data-index='"+f+"'></ul>"),n._menuNode.append(l),e=0,h=k.length;h>e;e++)j=k[e],i=a.Node.create(c.richselect_option({text:j.text,value:j.value,css:j.css||"",index:e,tab:f}),m),l.append(i);"undefined"==typeof d?b.append(n._buttonNode):b.insert(n._buttonNode,d),r&&(n._buttonNode.getDOMNode().className+=" "+r),a.one(m.body).append(n._menuNode),n._listeners.push(n._buttonNode.on("mousedown",function(){n._menuNode.hasClass("hidden")?n._showMenu():n._hideMenu()},n)),n._listeners.push(n._buttonNode.on("keypress",a.bind(function(a){(13===a.keyCode||32===a.keyCode)&&(a.halt(),n._menuNode.hasClass("hidden")?n._showMenu():n._hideMenu())},n))),n._listeners.push(n._menuNode.delegate("click",a.bind(n._handleMenuClick,n),"li")),n._listeners.push(n._menuNode.delegate("keydown",a.bind(function(a){var b=!0;switch(a.keyCode){case 37:n._moveLeft();break;case 38:n._moveUp();break;case 39:n._moveRight();break;case 40:n._moveDown();break;case 13:case 32:n._handleMenuClick(a);break;default:b=!1}b&&a.halt()},n),"li")),n._listeners.push(n._menuNode.delegate("mousemove",a.bind(n._handleMousemove,n),"li")),n._rendered=!0,n._pendingValueSelection&&n.setSelected(n._pendingValueSelection)},setSelected:function(a){if(this._rendered){var b=this._menuNode.one('li[data-value="'+a+'"]');b&&this._selectNode(b)}else this._pendingValueSelection=a},getSelected:function(){var a=this.get("selectedIndex"),b=this.get("items");return b[a].value},_showMenu:function(){var b,c,e,f,g,h,i,j,k,l=this,m=l._buttonNode.get("region"),n=l.get("selectedIndex");c=l._menuNode.get("ownerDocument").getDOMNode(),b=c.defaultView?c.defaultView:c.parentWindow,this._menuNode.setStyle("left","-10000px"),this._menuNode.removeClass("hidden"),j=this._menuNode.get("offsetWidth"),k=this._menuNode.get("offsetHeight"),h=b.innerWidth?b.innerWidth:c.documentElement.clientWidth,i=b.innerHeight?b.innerHeight:c.documentElement.clientHeight,l._menuNode.setStyle("minWidth",l._buttonNode.get("offsetWidth")),i<m.bottom+k?l._menuNode.setStyle("top",m.top-k+"px"):l._menuNode.setStyle("top",m.bottom+"px"),h<m.left+j?l._menuNode.setStyle("left",m.right-j+"px"):l._menuNode.setStyle("left",m.left+"px"),e=a.UA.ie?a.one(c):a.one(b),l._deferOpenMenuListeners=a.later(1,l,function(){l._closeListener=e.on("mousedown",function(a){a.target.ancestor(".richselect-menu",!0)||(l._hideMenu(),a.halt())})}),d.bringToFront(l._menuNode),l._multiple?l._menuNode.all("ul").each(function(a){for(f=0;f<n.length;f++)parseInt(a.getAttribute("data-index"),10)===f&&(g=n[f]);a.all("li").each(function(a){parseInt(a.getAttribute("data-index"),10)===g&&l._focusElement(a)})}):l._menuNode.all("li").each(function(a,b){b===n&&l._focusElement(a)})},_hideMenu:function(){var a=this;a._menuNode&&a._menuNode.one&&(a._menuNode.addClass("hidden"),a._deferOpenMenuListeners&&a._deferOpenMenuListeners.cancel(),a._closeListener&&(a._closeListener.detach(),a._closeListener=null))},_clearFocusedElements:function(){this._menuNode.all("li").removeClass("focus")},_focusElement:function(a){a&&!a.hasClass("focus")&&(this._clearFocusedElements(),a.focus(),a.addClass("focus"))},_moveUp:function(){for(var a=this._menuNode.one(".focus");a&&a.previous()&&(a=a.previous(),"none"===a.getComputedStyle("display")););this._focusElement(a||this._menuNode.one("li"))},_moveDown:function(){for(var a=this._menuNode.one(".focus");a&&a.next()&&(a=a.next(),"none"===a.getComputedStyle("display")););this._focusElement(a||this._menuNode.one("li"))},_moveRight:function(){var a=this._menuNode.one(".focus"),b=a?a.ancestor("ul"):null,c=b?b.next():null,d=c?c.one("li"):null;d&&this._focusElement(d)},_moveLeft:function(){var a=this._menuNode.one(".focus"),b=a?a.ancestor("ul"):null,c=b?b.previous():null,d=c?c.one("li"):null;d&&this._focusElement(d)},_handleMenuClick:function(a){this._selectNode(a.target)},_handleMousemove:function(a){this._focusElement(a.target)},_selectNode:function(a){var b,c,d=this,e=parseInt(a.getAttribute("data-index"),10),f=parseInt(a.ancestor("ul").getAttribute("data-index"),10);d._multiple?(b=d.get("selectedIndex"),b[f]=e,d.set("selectedIndex",b),c=d.get("items")[f][e]):(d.set("selectedIndex",e),c=d.get("items")[e]),d.fire("change",c),d._hideMenu()}}),a.Tictac.base.RichSelect=b},"1.0.0",{requires:["base","node","tictac-base-rollups","tictac-base-viewutils","tictac-richselect-css"]});"use strict";YUI.add("tictac-base-richtexteditor",function(a){function b(){b.superclass.constructor.apply(this,arguments)}var c=a.Tictac.base.strings,d=a.Tictac.base.rollups,e=a.Tictac.base.utils,f=a.Tictac.base.ViewUtils,g=a.Tictac.base.mailutils,h=a.Escape.html;b.NAME="tt-richtexteditor",b.ATTRS={fontSizes:{value:[{name:c.str_rte_font_tiny,value:"1"},{name:c.str_rte_font_small,value:"2"},{name:c.str_rte_font_medium,value:"3"},{name:c.str_rte_font_large,value:"5"},{name:c.str_rte_font_xlarge,value:"6"},{name:c.str_rte_font_huge,value:"7"}]},fontFamilies:{value:g.getFontFamilies()},defaultFontSize:{value:"3"},defaultBgColor:{value:"transparent"},defaultFontColor:{value:"#000000"},defaultFontFamily:{value:"Arial"},defaultBold:{value:!1},defaultItalic:{value:!1},defaultUnderline:{value:!1},defaultBulletedList:{value:!1},defaultNumberedList:{value:!1},defaultJustifyLeft:{value:!1},defaultJustifyRight:{value:!1},defaultJustifyCenter:{value:!1},toolbarContainer:{value:null},rteHeight:{value:"200px"},rteWidth:{value:"100%"},defaultDirection:{value:NeoConfig.isRTL?"rtl":"ltr"},detectBidi:{value:!1},initialCSS:{value:""},showBackgroundColor:{value:!0},showLists:{value:!0},showLayout:{value:!0},showLink:{value:!0}},b.COLOR_PICKER_STORM_HTML='<div class="colorPickerMenu storm"><div class="rte-color-picker groupie" role="menu presentation"></div></div>',b.SUPPORTED_STORM_TEXT_COLORS=[["#000000","#808080","#d0d0d0"],["#9d1811","#cd232c","#d36a53"],["#a46016","#dd902f","#e4ac64"],["#ac9e19","#fdef2b","#fdf869"],["#5b8828","#8fca40","#add773"],["#4c76a2","#70aced","#7dbef1"],["#440062","#652191","#845aa7"],["#9c005c","#cb008e","#d264aa"]],b.SUPPORTED_STORM_BACKGROUND_COLORS=[["#000000","#808080","transparent"],["#9d1811","#cd232c","#d36a53"],["#a46016","#dd902f","#e4ac64"],["#ac9e19","#fdef2b","#fdf869"],["#5b8828","#8fca40","#add773"],["#4c76a2","#70aced","#7dbef1"],["#440062","#652191","#845aa7"],["#9c005c","#cb008e","#d264aa"]],b.BODY_CSS_TEMPLATE="body {font-size: {{fontSize}};font-family: {{fontFamily}}; color: {{fontColor}};",b.DOM_EVENTS=["click","mouseup","keyup","paste","keypress","keydown","focus","blur","cut","selectstart"],b.CMD_INSERT_HTML="inserthtml",b.CMD_INSERT_TEXT="inserttext",a.extend(b,a.Base,{initializer:function(){var b=this;b._rendered=!1,b._currentState={bold:b.get("defaultBold"),italic:b.get("defaultItalic"),underline:b.get("defaultUnderline"),bulletedList:b.get("defaultBulletedList"),numberedList:b.get("defaultNumberedList"),justifyLeft:b.get("defaultJustifyLeft"),justifyCenter:b.get("defaultJustifyCenter"),justifyRight:b.get("defaultJustifyRight"),fontSize:b._convertFontSizeUnit(b.get("defaultFontSize")),bgColor:b.get("defaultBgColor"),fontColor:b.get("defaultFontColor"),fontFamily:b.get("defaultFontFamily").toLowerCase()},b._initialState=a.clone(b._currentState),b._initialized=!1,b._initListeners=[],b._registeredListeners=[],b._styleOff=!!a.UA.ie,b._yListeners=[],b._dir=null,b._focusListeners=[],b._focused=!1,b._colorPickers={},a.Tictac.base&&a.Tictac.base.bidi&&a.Tictac.base.bidi.detectDirection&&b.set("detectBidi",!0)},destroy:function(){a.UA.ie&&this.blur(),b.superclass.destroy.apply(this,arguments)},destructor:function(){var a,b,c=this;if(c._rendered){c._toolbarContainer.remove(!0),c.frame.parentNode.removeChild(c.frame),delete c.frame.rteObj,delete c.frame;for(a in c._colorPickers)c._colorPickers.hasOwnProperty(a)&&(b=c._colorPickers[a],b.remove(!0),b.timer&&(b.timer.cancel(),delete b.timer));for(;c._yListeners.length;)c._yListeners.pop().detach();c._fontSizeSelect.destroy()}c._destroyed=!0},onInit:function(a){this._initialized?a():this._initListeners.push(a)},registerEventListener:function(a){this._registeredListeners.push(a)},render:function(b){var e,f,g,h,i,j=this,k=[];if(j._rendered)throw new Error("Error - render method invoked twice for RTE");for(j._rendered=!0,b=b||document.body,b.getDOMNode&&(b=b.getDOMNode()),i=j.get("toolbarContainer")||b,j.doc=b.ownerDocument,j._toolbarContainer=a.Node.create(d.rte_toolbar({showLists:j.get("showLists"),showLink:j.get("showLink"),showLayout:j.get("showLayout"),showBackgroundColor:j.get("showBackgroundColor")})),i.one||(i=a.one(i)),i.append(j._toolbarContainer),j._toolbarParent=i,j._toolbarParent.addClass("rte-wrapper"),e=j._toolbarContainer.one(".rte-fontsize-select"),g={items:[],tooltip:c.str_comp_font_size_attr},k=[],f=j.get("fontFamilies"),h=0;h<f.length;h++)k.push({value:f[h].value,text:f[h].name,css:"font-family:"+f[h].value+";"});for(g.items.push(k),k=[],f=j.get("fontSizes"),h=0;h<f.length;h++)k.push({value:f[h].value,text:f[h].name,css:"font-size:"+j._convertFontSizeUnit(f[h].value)+";"});g.items.push(k),j._fontSizeSelect=new a.Tictac.base.RichSelect(g),j._fontSizeSelect.setSelected(j._currentState.fontSize),j._fontSizeSelect.render(e),j.frame=j.doc.createElement("iframe"),j.frame.border=0,j.frame.frameBorder=0,j.frame.marginWidth=0,j.frame.marginHeight=0,j.frame.leftMargin=0,j.frame.topMargin=0,j.frame.allowTransparency="true",j.frame.style.height=j.get("rteHeight"),j.frame.style.width=j.get("rteWidth"),j.frame.id="rte-"+(new Date).getTime(),j.frame.rteObj=j,b.appendChild(j.frame),j._finishRender()},_finishRender:function(){var b=this;if(!b._destroyed){if("undefined"!=typeof b.frame.contentDocument)b.frameDocument=b.frame.contentDocument;else if(b.doc.frames){var c=b.doc.frames[b.frame.id];c&&(b.frameDocument=c.document)}if(!b.frameDocument)return void a.later(10,b,b._finishRender);if(a.UA.gecko){var d=b.frameDocument.open(),e="<!DOCTYPE html>\n<html><head><title></title></head><body></body></html>";d.write(e),d.close()}a.later(0,null,function(){b.frameDocument.designMode="on",b._initFrame()})}},focus:function(a){var b=this;if(!b._disabled){if(!this._rendered)throw new Error("Focus called before RTE was rendered");return this._initialized?void(this._focused?a&&a():(a&&this._focusListeners.push(a),this.frame.contentWindow.focus())):void this.onInit(function(){b.focus(a)})}},isFocused:function(){return this._focused},blur:function(){if(this.frame&&this._focused)try{a.UA.webkit?this.frameDocument.body.blur():a.UA.gecko?this.frame.blur():a.config.win.focus()}catch(b){a.log("Error attempting to blur the RTE","warn","yim-rte")}},exec:function(b,c){this._styleOff||this._disableStyleTags();try{this.frameDocument.execCommand(b,!1,c)}catch(d){a.log("Got an error trying to exec command "+b+" with val "+c+".  Error = "+d.message,"warn","rte")}},setFontSize:function(a){var b=this;b._formattingDisabled||b.focus(function(){b.exec("fontsize",a),b._currentState.fontSize=a,""===b.getTextContent()&&(b.set("defaultFontSize",a),b._updateBodyCSS(!0))})},setFontFamily:function(a){if(!this._formattingDisabled){var b=this;this.focus(function(){b.exec("fontname",a),b._currentState.fontFamily=a,""===b.getTextContent()&&(b.set("defaultFontFamily",a),b._updateBodyCSS(!0))})}},setFontColor:function(a){if(!this._formattingDisabled){var b=this;this.focus(function(){var c=""===b.getTextContent();b.exec("forecolor",a),b._currentState.fontColor=a,c&&(b.set("defaultFontColor",a),b._updateBodyCSS(!0)),b._fontColorUpdated(a)})}},setBgColor:function(a){if(!this._formattingDisabled){var b=this;this.focus(function(){var c=""===b.getTextContent();b.exec("backcolor",a),b._currentState.bgColor=a,c&&(b.set("defaultBgColor",a),b._updateBodyCSS(!0)),b._fontColorUpdated(a)})}},toggleBold:function(){if(!this._formattingDisabled){this.exec("bold"),this._currentState.bold=!this._currentState.bold;var a=this._toolbarContainer.one(".rte-bold").get("parentNode");this._currentState.bold?(a.addClass("selected"),a.removeClass("unselected")):(a.removeClass("selected"),a.addClass("unselected")),""===this.getTextContent()&&this.set("defaultBold",this._currentState.bold)}},toggleItalic:function(){if(!this._formattingDisabled){this.exec("italic"),this._currentState.italic=!this._currentState.italic;var a=this._toolbarContainer.one(".rte-italic").get("parentNode");this._currentState.italic?(a.addClass("selected"),a.removeClass("unselected")):(a.removeClass("selected"),a.addClass("unselected")),""===this.getTextContent()&&this.set("defaultItalic",this._currentState.italic)}},toggleUnderline:function(){if(!this._formattingDisabled){this.exec("underline"),this._currentState.underline=!this._currentState.underline;var a=this._toolbarContainer.one(".rte-underline").get("parentNode");this._currentState.underline?(a.addClass("selected"),a.removeClass("unselected")):(a.removeClass("selected"),a.addClass("unselected")),""===this.getTextContent()&&this.set("defaultUnderline",this._currentState.underline)}},insertText:function(a,b){this._insert(a,"text",b)},insertHTML:function(a,b){this._insert(a,"html",b)},_insert:function(c,d,e){var f=this,g="text"===d?b.CMD_INSERT_TEXT:b.CMD_INSERT_HTML;this.focus(function(){a.UA.ie?11===a.UA.ie?"text"===d?f.frameDocument.activeElement.innerText+=c:f.frameDocument.activeElement.innerHTML+=c:"text"===d?f.frameDocument.selection.createRange().text=c:f.frameDocument.selection.createRange().pasteHTML(c):f.exec(g,c),a.later(0,f,function(){f._updateCurrentState(),e&&e()})})},insertBR:function(){a.UA.ie?this.insertHTML("<br/><span></span>"):a.UA.webkit?this.insertHTML("<br/><br/>"):a.UA.gecko?this.insertHTML("<br/><br/>"):this.insertHTML("<br/>")},increaseIndent:function(){this._formattingDisabled||this.exec("indent")},decreaseIndent:function(){this._formattingDisabled||(this.exec("outdent"),this._updateCurrentState())},toggleBulletedList:function(){if(!this._formattingDisabled){this.exec("insertUnorderedList"),this._currentState.bulletedList=!this._currentState.bulletedList;var a=this._toolbarContainer.one(".rte-bulleted");a&&(a=a.get("parentNode"),this._currentState.bulletedList?(a.addClass("selected"),a.removeClass("unselected"),this._updateCurrentState()):(a.removeClass("selected"),a.addClass("unselected")))}},toggleNumberedList:function(){if(!this._formattingDisabled){this.exec("insertOrderedList"),this._currentState.numberedList=!this._currentState.numberedList;var a=this._toolbarContainer.one(".rte-numbered");a&&(a=a.get("parentNode"),this._currentState.numberedList?(a.addClass("selected"),a.removeClass("unselected"),this._updateCurrentState()):(a.removeClass("selected"),a.addClass("unselected")))}},justifyLeft:function(){if(!this._formattingDisabled){this.exec("justifyLeft"),this._currentState.justifyLeft=!this._currentState.justifyLeft;var a=this._toolbarContainer.one(".rte-align-left");a&&(a=a.get("parentNode"),a.addClass("selected"),a.removeClass("unselected")),a.addClass("selected"),a.removeClass("unselected"),this._updateCurrentState()}},justifyCenter:function(){if(!this._formattingDisabled){this.exec("justifyCenter"),this._currentState.justifyCenter=!this._currentState.justifyCenter;var a=this._toolbarContainer.one(".rte-align-center");a&&(a=a.get("parentNode"),a.addClass("selected"),a.removeClass("unselected")),a.addClass("selected"),a.removeClass("unselected"),this._updateCurrentState()}},justifyRight:function(){if(!this._formattingDisabled){this.exec("justifyRight"),this._currentState.justifyRight=!this._currentState.justifyRight;var a=this._toolbarContainer.one(".rte-align-right");a&&(a=a.get("parentNode"),a.addClass("selected"),a.removeClass("unselected")),this._updateCurrentState()}},insertLink:function(){if(!this._formattingDisabled){var a=window.prompt("Please enter the URL for the link to point to:","http://");a&&""!==a&&"http://"!==a&&this.exec("createlink",a)}},getContent:function(b){if(!this._initialized)return"";var c=this.frameDocument.body.innerHTML||"";for(c=a.Lang.trim(c),c=c.replace('<span id="cursor"></span>',""),c=c.replace("\n","");c.length>3&&c.lastIndexOf("<br>")===c.length-4;)c=c.substring(0,c.length-4);for(;c.length>4&&c.lastIndexOf("<br/>")===c.length-5;)c=c.substring(0,c.length-5);return b?c:this._generateDefaultWrapperTag(c)},getTextContent:function(b){var c,d=this;return d._initialized?(b?(c=d.frameDocument.body.innerHTML,c=c.replace(/<br>|<br\/>|<br \/>/gi,"____BR____"),c=d.extractPlainText(c),c=c.replace(/____BR____/g,"<br/>")):c=h(d.frameDocument.body.textContent||d.frameDocument.body.innerText||""),a.Lang.trim(c)):""},extractPlainText:function(b){var c=a.Node.create("<div></div>");return c.setHTML(b),h(c.get("text"))},getPlainText:function(){var b=this,c=b.frameDocument.body.innerHTML,d=a.Node.create("<div></div>");return a.UA.webkit?(c=c.replace(/<div>/g,"<br/>"),c=c.replace(/<\/div>/g,"")):a.UA.ie&&(c=c.replace(/<\/p>/g,"<br/>"),c=c.replace(/<p>/g,"")),c=c.replace(/<br>|<br\/>|<br \/>/gi,"____BR____"),c=c.replace("\n",""),d.setHTML(c),c=d.get("text"),c=c.replace(/____BR____/g,"\r\n")},setTextContent:function(b,c,d){var e,f=this,g=/\n|<br>|<br\/>|<br \/>/gi,h=/\r/gi;d&&g.test(b)?(e=b.replace(g,"____BR____"),e=e.replace(h,""),e=a.Escape.html(e),f._setContent(e,"html",function(){f._setContent(f.getTextContent(!0).replace(/____BR____/g,"<br/>"),"html",c)})):(e=b.replace(g,""),e=a.Escape.html(e),f._setContent(e,"html",c))},setHTMLContent:function(a,b){this._setContent(a,"html",b)},_setContent:function(b,c,d){var e=this;return e._initialized?(e.clear(!0),void a.later(0,this,function(){e.focus(function(){e._insert(b,c,d),e._detectTextDirection()})})):void e.onInit(function(){e._setContent(b,c,d)})},getScrollHeight:function(){var a=this.frameDocument.body.scrollHeight;return a},setBodyStyle:function(a,b){this.frameDocument&&this.frameDocument.body&&(this.frameDocument.body.style[a]=b)},getState:function(){return{currentState:a.clone(this._currentState),defaultState:this.getDefaultSettings(),content:this.getContent()}},setState:function(a){var b=this;return b._initialized?(b.set("defaultFontSize",a.defaultState.fontSize),b.set("defaultFontFamily",a.defaultState.fontFamily),b.set("defaultFontColor",a.defaultState.fontColor),b.set("defaultBold",a.defaultState.bold),b.set("defaultItalic",a.defaultState.italic),b.set("defaultUnderline",a.defaultState.underline),b.set("defaultDirection",a.defaultState.direction),b.set("defaultBulletedList",a.defaultState.bulletedList),b.set("defaultNumberedList",a.defaultState.numberedList),b.set("defaultJustifyLeft",a.defaultState.justifyLeft),b.set("defaultJustifyCenter",a.defaultState.justifyCenter),b.set("defaultJustifyRight",a.defaultState.justifyRight),b._updateBodyCSS(),void(""!==a.content?b.setHTMLContent(a.content,function(){b.setCurrentState(a.currentState)}):b.setCurrentState(a.currentState))):void b.onInit(function(){b.setState(a)})},setCurrentState:function(a){var b=this;this.focus(function(){a.bold!==b._currentState.bold&&b.toggleBold(),a.italic!==b._currentState.italic&&b.toggleItalic(),a.underline!==b._currentState.underline&&b.toggleUnderline(),a.bulletedList!==b._currentState.bulletedList&&b.toggleBulletedList(),a.numberedList!==b._currentState.numberedList&&b.toggleNumberedList(),a.justifyLeft!==b._currentState.justifyLeft&&b.justifyLeft(),a.justifyCenter!==b._currentState.justifyCenter&&b.justifyCenter(),a.justifyRight!==b._currentState.justifyRight&&b.justifyRight(),a.fontFamily!==b._currentState.fontFamily&&b.setFontFamily(a.fontFamily),a.fontSize!==b._currentState.fontSize&&b.setFontSize(a.fontSize),a.fontColor!==b._currentState.fontColor&&b.setFontColor(a.fontColor),b._syncToolbar()})},clear:function(b){var c=this;this.frameDocument.body.innerHTML="",this._dir=null,this._setTextDirection(this.get("defaultDirection")),b||a.later(0,this,function(){this.focus(function(){c._updateCurrentState(),c.get("defaultBold")&&c.toggleBold(),c.get("defaultItalic")&&c.toggleItalic(),c.get("defaultUnderline")&&c.toggleUnderline(),c.get("defaultBulletedList")&&c.toggleBulletedList(),c.get("defaultNumberedList")&&c.toggleNumberedList(),c.get("defaultJustifyLeft")&&c.justifyLeft(),c.get("defaultJustifyCenter")&&c.justifyCenter(),c.get("defaultJustifyRight")&&c.justifyRight()})})},getDefaultSettings:function(){var a=this;return{fontFamily:a.get("defaultFontFamily"),fontSize:a.get("defaultFontSize"),fontColor:a.get("defaultFontColor"),bold:a.get("defaultBold"),italic:a.get("defaultItalic"),underline:a.get("defaultUnderline"),direction:a.get("defaultDirection"),bulletedList:a.get("defaultBulletedList"),numberedList:a.get("defaultNumberedList"),justifyLeft:a.get("defaultJustifyLeft"),justifyRight:a.get("defaultJustifyRight"),justifyCenter:a.get("defaultJustifyCenter")}},disableFormatting:function(a){var b=this;b._initialized?(a||b._removeBodyCSS(),b.removeFormatting(),b._toolbarParent.addClass("hidden"),b._formattingDisabled=!0):b.onInit(function(){b.disableFormatting()})},enableFormatting:function(){var a=this;a._formattingDisabled=!1,a._updateBodyCSS(),a._toolbarParent.removeClass("hidden"),a._syncToolbar()},disable:function(a){var b=this;return b._initialized?(b._disabled=a,b.frameDocument.body.style.opacity=a?"0.4":"1",void(a?b.frame.setAttribute("tabindex","-1"):b.frame.removeAttribute("tabindex"))):void b.onInit(function(){b.disable(a)})},removeFormatting:function(){this.setHTMLContent(this.getTextContent(!0))},_initFrame:function(){var c,d=this,e=d.get("initialCSS");if(!d._destroyed){if(!d.frameDocument.body)return void a.later(0,d,d._initFrame);d._setTextDirection(d.get("defaultDirection")),a.UA.ie||d._disableStyleTags(),d.frameDocument.body.style.wordWrap="break-word",d._updateBodyCSS(),e&&(c=d.frameDocument.createElement("style"),c.type="text/css",c.styleSheet?c.styleSheet.cssText=e:c.appendChild(d.frameDocument.createTextNode(e)),d.frameDocument.getElementsByTagName("head")[0].appendChild(c)),d._yListeners.push(d._toolbarContainer.on("click",a.bind(d._toolbarButtonClicked,d))),d._yListeners.push(d._fontSizeSelect.on("change",a.bind(d._fontSizeSelected,d))),a.mix(a.Node.DOM_EVENTS,{paste:!0,cut:!0}),d.domEvtTarget=a.one(a.UA.ie?d.frameDocument.body:a.UA.webkit?d.frame.contentWindow:d.frameDocument),d._boundDomListener=a.bind(d._domEvent,d);for(var f=0;f<b.DOM_EVENTS.length;f++)d._yListeners.push(d.domEvtTarget.on(b.DOM_EVENTS[f],d._boundDomListener));d._syncToolbar(),d._initialized=!0,d._invokeInitListeners()}},_toolbarButtonClicked:function(a){var b=a.target.getDOMNode(),c=this;"button"!==b.type&&"button"===b.parentNode.type&&(b=b.parentNode),"button"===b.type&&c.focus(function(){switch(b.getAttribute("data-action")){case"bold":c.toggleBold();break;case"underline":c.toggleUnderline();break;case"italic":c.toggleItalic();break;case"color":c._showColorPicker("fore",a);break;case"color-back":c._showColorPicker("back",a);break;case"indent":c.increaseIndent();break;case"outdent":c.decreaseIndent();break;case"bulleted":c.toggleBulletedList();break;case"numbered":c.toggleNumberedList();break;case"align-left":c.justifyLeft();break;case"align-center":c.justifyCenter();break;case"link":c.insertLink()}})},_domEvent:function(b){var c,d,e,f,g,h=this,i=!1;if(h._disabled)return document.activeElement.blur(),b.halt(),!1;if(b&&!b.fakeEvent){for(e=a.UA.ie&&"keypress"===b.type?b.charCode:b.keyCode,0===b.type.indexOf("on")&&(b.type=b.type.substring(2)),c=0;c<h._registeredListeners.length;c++)i=i||h._registeredListeners[c](b);switch(i&&b.halt(),b.type){case"paste":a.later(0,null,function(){h._formattingDisabled?h.removeFormatting():h._updateCurrentState(),-1!==h.getContent().indexOf('data-emoticon="true"')&&(f=new RegExp('<img.*?title="([^"]*)".*?data-emoticon.*?;">',"g"),g=h.getContent().replace(f,"$1"),f=new RegExp('<img.*?data-emoticon.*?title="([^"]*)".*?;">',"g"),h._setContent(g.replace(f,"$1"))),h.get("detectBidi")&&(h._dir=null,h._detectTextDirection())});break;case"cut":a.later(0,h,function(){h._dir&&h.get("detectBidi")&&""===h.getTextContent()&&(h._dir=null,h._setTextDirection(h.get("defaultDirection"))),h._updateCurrentState()});break;case"keydown":b.ctrlKey&&(66===e?(h.toggleBold(),b.halt()):73===e?(h.toggleItalic(),b.halt()):85===e&&(h.toggleUnderline(),b.halt()));break;case"keypress":this._disabled&&b.halt();break;case"keyup":8===e||e>32&&47>e?(h._updateCurrentState(),h.get("detectBidi")&&h._dir&&(d=h.getTextContent(),""===d&&(h._dir=null,h._setTextDirection(h.get("defaultDirection"))))):h.get("detectBidi")&&(h._dir=null,h._detectTextDirection());break;case"click":h._updateCurrentState();break;case"focus":for(h._focused=!0;h._focusListeners.length;)h._focusListeners.pop().call();break;case"blur":h._focused=!1}}},_colorClicked:function(a,b){var c,d=a.target.getDOMNode(),e=b.type;"LI"!==d.nodeName&&"LI"===d.parentNode.nodeName&&(d=d.parentNode),"LI"===d.nodeName&&("fore"===e?(c=d.getAttribute("data-value"),this.setFontColor(c)):"back"===e&&(c=d.getAttribute("data-value"),this.setBgColor(c)),this._hideColorPicker(b)),a.halt()},_showColorPicker:function(b,c){var d,e=this;e._colorPickers[b]||(e._colorPickers[b]=e._createColorPicker(b),a.one(a.config.doc.body).append(e._colorPickers[b])),d=e._colorPickers[b],e._positionColorPicker(d,c.clientY,c.clientX),e._updateColorPickerSelection(d),d.removeClass("hidden"),f.bringToFront(d)},_createColorPicker:function(c){var e,f,g,h,i,j,k,l,m=this;for(e=a.Node.create(b.COLOR_PICKER_STORM_HTML),e.type=c,f=e.one(".rte-color-picker"),g="fore"===c?b.SUPPORTED_STORM_TEXT_COLORS:b.SUPPORTED_STORM_BACKGROUND_COLORS,h=0;h<g.length;h++){for(j=g[h],k=a.Node.create('<ul data-action="forecolor" role="group">'),i=0;i<j.length;i++)l="transparent"===j[i],k.append(a.Node.create(d.rte_storm_color({color:j[i],transparent:l})));f.append(k)}return m._yListeners.push(e.on("click",function(a){m._colorClicked(a,e)})),m._yListeners.push(e.on("mouseout",function(){e.timer||(e.timer=a.later(2e3,m,a.bind(m._hideColorPicker,m,e)))},m)),m._yListeners.push(e.on("mouseover",function(){e.timer&&(e.timer.cancel(),delete e.timer)},m)),e.timer=a.later(2e3,m,a.bind(m._hideColorPicker,m,e)),e.closeListener=e.get("ownerDocument").on("mousedown",function(a){a.target.ancestor(".rte-color-picker",!0)||m._hideColorPicker(e)},m),m._yListeners.push(e.closeListener),e},_positionColorPicker:function(b,c,d){var e,f;e=b.get("offsetHeight"),c+e>a.config.doc.body.offsetHeight&&(c-=e),f=b.get("offsetWidth"),d+f>a.config.doc.body.offsetWidth&&(d=a.config.doc.body.offsetWidth-f),b.setStyle("top",c+"px"),b.setStyle("left",d+"px")},_updateColorPickerSelection:function(a){var b="fore"===a.type?this._currentState.fontColor:this._currentState.bgColor;a.all("li").each(function(a){var c=a.one("a:not(.icon-none)"),d=a.getAttribute("data-value");d===b?(c.addClass("icon"),c.addClass("icon-checkmark")):(c.removeClass("icon"),c.removeClass("icon-checkmark"))})},_hideColorPicker:function(a){a.addClass("hidden"),this._ieRange&&delete this._ieRange,a.timer&&(a.timer.cancel(),delete a.timer)},_fontColorUpdated:function(){},_disableStyleTags:function(){try{this.frameDocument.execCommand("styleWithCSS",!1,!1),this.frameDocument.execCommand("useCSS",!1,a.UA.gecko?!0:!1),this._styleOff=!0}catch(b){a.log("Failed to disable style tags: "+b.message,"warn","yim-rte")}},_detectTextDirection:function(){var b,c=this.getTextContent();""!==c&&(b=a.Tictac.base.bidi.detectDirection(c),b&&(this._dir=b,this._setTextDirection(this._dir)))},_fontSelected:function(a){this.setFontFamily(a.value)},_fontSizeSelected:function(a){-1!==a.css.indexOf("font-family")?this.setFontFamily(a.value):this.setFontSize(a.value)},_setTextDirection:function(a){this.frameDocument.body.style.direction=a},_generateDefaultWrapperTag:function(a){var b,c=this.getDefaultSettings();return b="#000000"!==c.fontColor?"<font face='"+c.fontFamily+"' size='"+c.fontSize+"' color='"+c.fontColor+"'>"+a+"</font>":"<font face='"+c.fontFamily+"' size='"+c.fontSize+"'>"+a+"</font>"},_updateCurrentState:function(){var b,c,d,e=this,f=e.frameDocument,g=!1;try{e._currentState.bold!==f.queryCommandState("bold")&&(e._currentState.bold=!e._currentState.bold,g=!0),e._currentState.underline!==f.queryCommandState("underline")&&(e._currentState.underline=!e._currentState.underline,g=!0),e._currentState.italic!==f.queryCommandState("italic")&&(e._currentState.italic=!e._currentState.italic,g=!0),e._currentState.justifyLeft!==f.queryCommandState("justifyLeft")&&(e._currentState.justifyLeft=!e._currentState.justifyLeft,g=!0),e._currentState.justifyRight!==f.queryCommandState("justifyRight")&&(e._currentState.justifyRight=!e._currentState.justifyRight,g=!0),e._currentState.justifyCenter!==f.queryCommandState("justifyCenter")&&(e._currentState.justifyCenter=!e._currentState.justifyCenter,g=!0),e._currentState.bulletedList!==f.queryCommandState("insertUnorderedList")&&(e._currentState.bulletedList=!e._currentState.bulletedList,g=!0),e._currentState.numberedList!==f.queryCommandState("insertOrderedList")&&(e._currentState.numberedList=!e._currentState.numberedList,g=!0)}catch(h){a.log("Error querying command state: "+h.message,"warn","RTE")}try{b=(f.queryCommandValue("fontname")||e.get("defaultFontFamily")).toLowerCase()}catch(h){a.log("Error retrieving font family: "+h.message,"warn","yim-rte"),b=e.get("defaultFontFamily").toLowerCase()}try{c=f.queryCommandValue("fontsize")||e.get("defaultFontSize")}catch(h){a.log("Error retrieving font size: "+h.message,"warn","yim-rte"),c=e.get("defaultFontSize")}try{d=e._convertToHex(f.queryCommandValue("forecolor"))||e.get("defaultFontColor")}catch(h){a.log("Error retrieving font color: "+h.message,"warn","yim-rte"),d=e.get("defaultFontColor")}d!==e._currentState.fontColor&&(e._currentState.fontColor=d,g=!0),-1===b.indexOf(e._currentState.fontFamily)&&(e._currentState.fontFamily=b,g=!0),e._currentState.fontSize!==c&&(e._currentState.fontSize=c,g=!0),g&&e._syncToolbar()},_syncToolbar:function(){function a(a,c){var d,e=b._toolbarContainer.one(c);e&&(d=e.get("parentNode"),a?(d.addClass("selected"),d.removeClass("unselected")):(d.removeClass("selected"),d.addClass("unselected")))}var b=this;a(b._currentState.bold,".rte-bold"),a(b._currentState.italic,".rte-italic"),a(b._currentState.bulletedList,".rte-bulleted"),a(b._currentState.numberedList,".rte-numbered"),a(b._currentState.justifyLeft,".rte-align-left"),a(b._currentState.justifyCenter,".rte-align-center"),a(b._currentState.justifyRight,".rte-align-right");var c,d,e=b._fontSizeSelect.get("items")[1];for(c=0;c<e.length;c++)if(d=e[c].value.toLowerCase(),-1!==b._currentState.fontFamily.indexOf(d)){b._currentState.fontFamily=d,b._fontSelect.set("selectedIndex",c);break}for(e=b._fontSizeSelect.get("items")[0],c=0;c<e.length;c++)if(e[c].value===b._currentState.fontSize){b._fontSizeSelect.set("selectedIndex",c);break}b._fontColorUpdated(b._currentState.fontColor)},_updateBodyCSS:function(a){var c=this,d=e.subs(b.BODY_CSS_TEMPLATE,{fontSize:c._convertFontSizeUnit(c.get("defaultFontSize")),fontFamily:c.get("defaultFontFamily"),fontColor:c.get("defaultFontColor")}),f=c.frameDocument.createElement("style");c._removeBodyCSS(),f.type="text/css",f.id="defaultStyle",f.styleSheet?f.styleSheet.cssText=d:f.appendChild(c.frameDocument.createTextNode(d)),c.frameDocument.getElementsByTagName("head")[0].appendChild(f),a||(c._updateCurrentState(),c.get("defaultBold")&&c.toggleBold(),c.get("defaultItalic")&&c.toggleItalic(),c.get("defaultUnderline")&&c.toggleUnderline(),c.get("defaultBulletedList")&&c.toggleBulletedList(),c.get("defaultNumberedList")&&c.toggleNumberedList(),c.get("defaultJustifyLeft")&&c.justifyLeft(),c.get("defaultJustifyCenter")&&c.justifyCenter(),c.get("defaultJustifyRight")&&c.justifyRight())},_removeBodyCSS:function(){var a=this.frameDocument.getElementById("defaultStyle");a&&a.parentNode.removeChild(a)},_getSelection:function(){return this.frame.contentWindow&&this.frame.contentWindow.getSelection?this.frame.contentWindow.getSelection():this.frameDocument.getSelection?this.frameDocument.getSelection():this.frameDocument.selection?this.frameDocument.selection.createRange():void 0},_convertFontSizeUnit:function(a){var b;if(a>7)switch(a){case"10":b="1";break;case"13":b="2";break;case"16":b="3";break;case"24":b="5";break;case"32":b="6";break;case"48":b="7";break;default:b="3"}else switch(a){case"1":b="10px";break;case"2":b="13px";break;case"3":b="16px";break;case"5":b="24px";break;case"6":b="32px";break;case"7":b="48px";break;default:b="16px"}return b},_convertToHex:function(a){function b(a){return a=parseInt(a,10).toString(16),a.length<2?a+"0":a}if(a=""+a,null===a.match(/^rgb/)){var c=(255&a)<<16|65280&a|(16711680&a)>>>16;return c=c.toString(16),"#000000".slice(0,7-c.length)+c}var d=a.match(/\d+/g);return"#"+b(d[0])+b(d[1])+b(d[2])},_invokeInitListeners:function(){for(;this._initListeners.length;){var a=this._initListeners.shift();a()}}}),a.Tictac.base.RichTextEditor=b},"1.0.0",{requires:["base","node","tictac-base-utils","tictac-base-rollups","tictac-base-richselect","escape","base-bidi","tictac-base-strings","tictac-base-viewutils","tictac-richtexteditor-css","tictac-base-mailutils"]});YUI.add("messenger-viewutils",function(a){"use strict";var b,c=a.Messenger.Common.Constants,d=a.Messenger.Common.Utils,e=a.Messenger.Model.SystemSettings,f=a.Messenger.Model.UserSettings,g=a.Messenger.Common.Stats,h=a.Tictac.mim.rollups,i=a.Tictac.mim.strings;b={replaceBuddyIcon:function(b,c){a.Array.each(["ymsg-offline","ymsg-away","ymsg-available","ymsg-busy"],function(a){b.removeClass(a)}),b.addClass(this.getBuddyIconClass(c))},getBuddyIconClass:function(a){var b,d=c.STATE;return b=a===d.OFFLINE||a===d.INVISIBLE?"ymsg-offline":a===d.AWAY||a===d.IDLE?"ymsg-away":a===d.AVAILABLE?"ymsg-available":"ymsg-busy"},getDefaultPresenceMessage:function(a){var b={"-1":"str_menu_invisible",0:"str_menu_available",1:"str_cont_list_status_be_right_back",2:"str_cont_list_status_busy",3:"str_cont_list_status_not_at_home",4:"str_cont_list_status_not_at_my_desk",5:"str_cont_list_status_not_in_the_office",6:"str_cont_list_status_on_the_phone",7:"str_cont_list_status_on_vacation",8:"str_cont_list_status_out_to_lunch",9:"str_cont_list_status_stepped_out",10:"str_cont_list_status_away",999:"str_cont_list_status_idle",9999:"str_menu_offline"},c="";return b[a]&&(c=i[b[a]]||""),c},getPresenceName:function(a){var b={0:"str_menu_available",2:"str_menu_busy","-1":"str_menu_invisible",999:"str_menu_idle",9999:"str_menu_offline"},c="";return b[a]&&(c=i[b[a]]||""),c},getStateName:function(a){var b,d=c.STATE;switch(a){case d.OFFLINE:b="offline";break;case d.PENDING:b="pending";break;case d.AVAILABLE:b="available";break;case d.INVISIBLE:b="invisible";break;case d.IDLE:case d.AWAY:b="away";break;default:b="busy"}return b},convertErrorCodeToMessage:function(a){var b="str_msgr_server_error_"+a;return i[b]?i[b]:i.str_msgr_server_error_1},triggerAds:function(a){var b={type:"a",name:"VISIBLE",evt:{sp:a,npv:!1,trace:"messenger",pageView:!1}};window.yui&&window.yui.fire&&(window.yui.fire("darlaEvent",{action:b}),g.stat("ad_rotation"))},flashWindow:function(){var b,c,d=!1;return function(e){b&&(b.cancel(),c&&(window.document.title=c),d=!1),e&&(c=window.document.title,b=a.later(1e3,window,function(){window.document.title=d?c:e,d=!d},null,!0))}}(),showNewMsgNotification:function(b,c){var d,e=b.get("unreadCount");e?(d=c.one(".mim-msg-badge"),d||(d=a.Node.create(h.badge()),c.one(".nav-lnk").append(d)),d.setHTML(e),c.addClass("mim-has-msg")):c.removeClass("mim-has-msg")},handleConvMinMax:function(a,b){a.get("minimized")?b.addClass("mim-minimized"):b.removeClass("mim-minimized")},getWindowHeight:function(){return this.getWindowSize().height},focusOnPresenceStateMenu:function(b){var c=a.one(".mim-presence-state-full button.mim-presence-state");c&&c.focus&&(c.focus(),b&&b.halt&&b.halt())},validateContactForm:function(b){var c=/[^a-z0-9\-\._@]/gi;return b.user||b.mobileno?b.user&&b.user.length<4||b.user.length>32||c.test(b.user)?d.substitute(i.str_cont_add_contact_error_invalid_id,{user:a.Escape.html(b.user),network:i.str_branding_messenger}):b.email&&!this.validateEmailAddress(b.email)?i.str_cont_add_contact_error_invalid_email:b.mobileno&&!this.validatePhoneNumber(b.mobileno)?i.str_add_error_phone:void 0:i.str_add_error_noval},validateEmailAddress:function(a){var b=/^[A-Z0-9\._%\+\-]+@[A-Z0-9\.\-]+\.[A-Z]{2,4}$/i;return b.test(a)},validatePhoneNumber:function(a,b){var c=/^[0-9\(\) \.\-\+]+$/i;return b=b||5,a.length<b?!1:c.test(a)},showSpamConfirm:function(b){var c="<div><p>"+i.str_conv_spam_reported_description_top+"</p><p>"+a.Messenger.Common.Utils.substitute(i.str_conv_spam_reported_description_bottom,{userid:b})+"</p></div>";this.alert({message:c,callback:function(){}})},openReportAbuseWindow:function(b,c){var e,f,g=[],h="\r\n{{userid}} ({{time}}): {{message}}",i=c&&c.length>0?c[0].sender:"",j=a.Messenger.Neo.core;a.Array.each(c,function(a){f=j.dateFormatter(new Date(a.timeStamp),j.getDateFormat(a.timeStamp)),g.push(d.substitute(h,{userid:a.sender,time:f,message:a.yml()}))}),e=["abuserYID="+i,"select_48176=0","textarea_21702="+g.join(encodeURIComponent("\n"))],window.open(b+"?"+e.join("&"))},getHtml5AudioSupport:function(){var a,b={audioObjectSupported:!1,audioPlaySupported:!1,oggSupported:!1,wavSupported:!1,mp3Supported:!1,aacSupported:!1};try{a=new Audio(""),a.canPlayType&&(b.audioObjectSupported=!0,a.play&&(b.audioPlaySupported=!0),""!==a.canPlayType('audio/ogg; codecs="vorbis"').replace(/no/,"")&&(b.oggSupported=!0),""!==a.canPlayType("audio/wav").replace(/no/,"")&&(b.wavSupported=!0),""!==a.canPlayType("audio/mp3").replace(/no/,"")&&(b.mp3Supported=!0),""!==a.canPlayType('audio/mp4; codecs="mp4a.40.2"').replace(/no/,"")&&(b.mp3Supported=!0))}catch(c){}return b},playAudioNotification:function(){var b,c,d=null,e=this,f=a.one("body"),g=e.getHtml5AudioSupport(),i=a.Tictac.base.getBase()+a.Tictac.base.getAssetURL("audio/","tictac-mim");if(g.audioObjectSupported&&g.audioPlaySupported&&(g.wavSupported||g.mp3Supported))d=a.one("#mim-messageReceivedAudioTag"),d||(d=a.Node.create(h.audiotag({mp3Source:i+"receiveim.mp3",wavSource:i+"receiveim.wav"})),f.append(d)),d.getDOMNode().play();else if(e._flashPlayer)e._playFlashAudioNotification();else if(b=f.one("#flashplayerContainer"),!b){b=a.Node.create("<div id='flashplayerContainer' style='height:0px;width:0px'></div>"),f.append(b),c=i+"audionotifier.swf",b.append(h.flashaudio({src:c,domain:window.location.host}));try{e._flashPlayer=f.one("#flashplayerContainer #mimflashaudio")}catch(j){a.log("Failed to create the flash player.","warn","mim-application")}}},_playFlashAudioNotification:function(b){if(b=b||0,!(b>10))try{this._flashPlayer.getDOMNode().playNotificationMessageSound()}catch(c){a.later(250,this,this._playFlashAudioNotification,[++b])}},isInputNode:function(a){var b={input:1,textarea:1,select:1},c=a.get("tagName").toLowerCase();return c in b},getPhoneCountries:function(){var b=a.Messenger.Common.SMSUtils,c=b.getCountries(),g=f.getPreference("mimHomeCountryPref")||b.getIntlCode(e.get("intl"))||"";return _.map(c,function(a){return{val:a.key,selected:g===a.key,label:d.substitute(i.str_opt_msg_phonecountry_label,{country_name:i["str_country_"+a.name],country_code:a.code})}})}},a.mix(b,a.Tictac.base.ViewUtils),a.namespace("Messenger.View").ViewUtils=b},"1.0.0",{requires:["messenger-constants","tictac-mim-strings","tictac-mim-rollups","tictac-base","messenger-stats","messenger-utils","messenger-smsutils","messenger-usersettings","messenger-systemsettings","tictac-base-viewutils","escape"]});"use strict";YUI.add("messenger-conversationview",function(a){function b(a){var b,c="sms"===a?"yahoo":a||"yahoo",d=[],e=i.emoticonPickerEntries[c];if(o[c])return o[c];for(b in e)e.hasOwnProperty(b)&&d.push({emotekey:b,emoteSmiley:e[b],emoteLabel:h["str_msgr_em_"+i.emoticonLabels[b]]});return o[c]=d,d}var c,d,e=a.Tictac.mim.rollups,f=a.Messenger.Common.Utils,g=a.Messenger.View.ViewUtils,h=a.Tictac.mim.strings,i=a.Messenger.YMLUtil,j=a.Messenger.Common.Constants,k=a.Messenger.Model.UserSettings,l=a.Messenger.Common.SMSUtils,m=a.Messenger.Common.Stats,n=j.EVENTS,o={},p=40,q=90,r=4e3;c=a.Tictac.base.View.extend({initialize:function(){var b=this;d=a.Messenger.Model.SystemSettings.get("isRTL"),b.set("unreadCount",0),b.model.on(n.ACK_RECEIVED,function(){b.set("unreadCount",0),g.flashWindow(!1)}),b.model.on(n.SEND_ERROR,function(a){b._showSendErrorILN(a&&a.errorCode)}),b.on("show",b._onShow,b),b._rteListeners=[]},onDestroy:function(){var a=this;if(a._setTypingState(!1),a.RTE){for(;a._rteListeners.length;)a._rteListeners.pop().detach();try{a.RTE.destroy()}catch(b){}}a.messageListNode.destroy(),a.messageAreaNode.destroy(),a.contact.off("change:presenceState change:presenceMessage",a._handlePresenceChange,this),a.contact.off("change:displayName",a._handleDisplayNameChange,this),a.model.off(n.ACK_RECEIVED),g.flashWindow(!1)},createDOMNode:function(){var c=this.model.get("user"),i=this.model.get("network"),j=a.Messenger.Model.ContactList.getInstance(),k=j.getContact(c,i),l=k.get("displayName");return this.contact=k,a.Node.create(e.conversation({displayName:l,image:k.get("image"),mobileno:k.get("mobileno")||"",presenceMessage:k.get("presenceMessage")||g.getDefaultPresenceMessage(k.get("presenceState")),presenceClassName:g.getBuddyIconClass(k.get("presenceState")),emoticons:b(i),typingMessage:f.substitute(h.str_conv_typing,{conversation_user:l}),isRTL:d}))},_updateBuddyIcon:function(){var a,b,c=this;(a=c.node.one(".mim-user-photo"))&&(b=c.contact.get("image"))&&a.set("src",b)},postRender:function(){var b,c,d=this.model.get("messages"),e=this;for(e.contact.on("change:image",a.bind(e._updateBuddyIcon,this)),e.messageListNode=e.node.one("ul.mim-message-list"),e.messageAreaNode=e.node.one(".mim-message-area"),e._formatPane=e.node.one(".mim-format-pane"),e._emoticonsPane=e.node.one(".mim-emoticons-pane"),e.on("change:mode",e._handleModeChange,this),this.set("mode",this.options.mode||"im"),b=0,c=d.length;c>b;b++)e.renderMessage(d[b]);e._handleModelDestroyEvents(),e.contact.get("ignored")?this._showUnblockUserILN():"sms"!==e.contact.get("network")&&"unknown"===e.contact.get("type")&&e._showUnknownUserILN(),e.contact.on("change:presenceState change:presenceMessage",e._handlePresenceChange,this),e.contact.on("change:displayName",e._handleDisplayNameChange,this),k.getPreference("mimEnableSSA",function(a){a&&(e.renderNotification({message:h.str_conv_btn_show_recent_conv,type:j.NOTIFICATION_SECTION_TOP,className:"mim-show-recent"}),k.getPreference("mimSSANotificationSeen")||e._showSSANotification())})},_onShow:function(){this.RTE||this._renderRTE();var a=this.get("unreadCount");a>0&&(g.flashWindow(!1),this.model.ack(),this.set("unreadCount",0)),this.model.get("ignored")&&this._showUnblockUserILN(),this._forceScrollPane(),this._updateLayout(),this.focus()},_updateLayout:function(){if(this.visible){var b=this.node.one(".mim-message-area"),c=this.node.one(".mim-notification-area");c.get("children").size()?0===c.get("offsetHeight")?a.later(0,this,function(){b.setStyle("top",c.get("offsetHeight"))}):b.setStyle("top",c.get("offsetHeight")):b.setStyle("top",0)}},_handleModeChange:function(){var a=this,b=a.get("mode");a.previous("mode")!==b&&"im"===b&&(a.RTE&&(a.RTE.enableFormatting(),a.RTE.focus()),a.renderModeILN(b))},_handlePresenceChange:function(a){var b=this.node.one(".mim-user-opi > b"),c=this.node.one(".mim-user-opi .mim-user-statusmsg"),d=a.get("presenceMessage")||g.getDefaultPresenceMessage(a.get("presenceState"));a.get("presenceState")!==a.previous("presenceState")&&b.removeClass(g.getBuddyIconClass(a.previous("presenceState"))).addClass(g.getBuddyIconClass(a.get("presenceState"))),c.setHTML(d)},_handleDisplayNameChange:function(a){var b=a.get("displayName");this.node.one(".mim-user-opi b").setHTML(b),this.node.one(".mim-user-photo").setAttribute("title",b),this.messageListNode.all(".mim-message-other .mim-message-sender").setHTML(b),this.node.one(".mim-typing-notification").setHTML(f.substitute(h.str_conv_typing,{conversation_user:b})),this.trigger(n.DISPLAYNAME_UPDATED,this.model.get("id"),b)},_renderRTE:function(){var b,c,e=this,f=k.getPreference("mimDefaultFontSize"),g=k.getPreference("mimDefaultFontColor"),h=k.getPreference("mimDefaultFontFamily");c=a.UA.ie?"body {padding: 5px;overflow-y: hidden;box-sizing: border-box;}":"body {padding: 5px;overflow-y: hidden;}",b={toolbarContainer:this.node.one(".mim-format-pane").getDOMNode(),rteHeight:"100%",rteWidth:"100%",defaultDirection:d?"rtl":"ltr",defaultFontSize:f,defaultFontColor:g,defaultFontFamily:h,initialCSS:c,showBackgroundColor:!1,showLists:!1,showLayout:!1,showLink:!1},e.RTE=new a.Tictac.base.RichTextEditor(b),e.RTE.render(e.node.one(".mim-conversation-rte").getDOMNode()),e.RTE.registerEventListener(a.bind(e._handleEditorEvents,e)),e._rteListeners.push(e.RTE.on("defaultFontSizeChange",function(a){k.setPreference("mimDefaultFontSize",a.newVal),k.save()})),e._rteListeners.push(e.RTE.on("defaultFontFamilyChange",function(a){k.setPreference("mimDefaultFontFamily",a.newVal),k.save()})),e._rteListeners.push(e.RTE.on("defaultFontColorChange",function(a){k.setPreference("mimDefaultFontColor",a.newVal),k.save()}))},_handleModelDestroyEvents:function(){var b=this,c=b.model;c.on("destroy",function(){a.log("ConversationView:_handleDestroyEvents "),b.destroy()})},focus:function(){this.RTE.focus()},handleLogin:function(){this.node.all(".mim-notify-disconnect").remove(!0),this.node.all("button").removeAttribute("disabled"),this._disabled=!1},handleLogout:function(){this.renderNotification({message:f.substitute(h.str_error_disconnected_error,{str_branding_messenger:h.str_branding_messenger}),type:j.NOTIFICATION_INLINE,error:!0,className:"mim-notify-disconnect"}),this.node.all("button").setAttribute("disabled","disabled"),this._disabled=!0},_handleEditorEvents:function(a){var b=this;if(!b._disabled)return"keydown"===a.type?b._handleKeyDown(a):"keypress"===a.type?b._handleKeyPress(a):("paste"===a.type?b._checkSize():"cut"===a.type?b._checkSize():"focus"===a.type&&(g.flashWindow(!1),b._unreadMessage===!0&&(b._unreadMessage=!1,b.model.ack())),!1)},_handleKeyDown:function(b){var c=!1,d=this.options.keyEvents,e=this;return 27===b.keyCode?e.close():13===b.keyCode?b.ctrlKey||b.shiftKey||b.altKey||b.metaKey?(c=!0,a.later(0,this,function(){this.RTE.insertBR()})):((this.contact.get("ignored")||k.getPreference("mimBlockNonContacts")&&0===this.contact.collection.where({id:this.contact.id}).length)&&"im"===this.get("mode")||this._send(),c=!0):d&&(b.metaKey||b.ctrlKey||b.shiftKey||b.keyCode<48)&&_.each(d,function(a){var d=a.ctrlKey||!1,f=a.metaKey||!1,g=a.metaCtrlKey||!1,h=a.shiftKey||!1,i=g?b.metaKey||b.ctrlKey:f===b.metaKey&&d===b.ctrlKey;a.keyCode===b.keyCode&&i&&h===b.shiftKey&&(a.callback(e.RTE),c=a.halt)}),this._stoppedTypingTimerFast&&clearTimeout(this._stoppedTypingTimerFast),this._stoppedTypingTimerFast=a.later(100,this,function(){this.RTE&&this.node&&this._checkSize()}),c},_handleKeyPress:function(a){13!==a.keyCode&&this._setTypingState(!0)},_startTypingTimer:function(){this._clearTypingTimer(),this._stoppedTypingTimer=a.later(r,this,function(){this._setTypingState(!1)})},_setTypingState:function(b){"im"===this.get("mode")&&(this._isTyping!==b&&(a.log("Setting typing state to "+b+" for conversation "+this.model.get("id")),this._isTyping=b,this.model.sendTypingNotification(b)),b?this._startTypingTimer():this._clearTypingTimer())},_clearTypingTimer:function(){this._stoppedTypingTimer&&(this._stoppedTypingTimer.cancel(),this._stoppedTypingTimer=null)},_checkSize:function(){var a,b,c=this.node.one(".mim-conversation-rte"),d=p+"px",e=this.node.one(".mim-conversation-area"),f=e.one(".mim-message-area"),g=this.node.one(".mim-conversation-input-toolbar"),h=g.getY(),i=this.node.getY(),j=parseInt(this.node.getComputedStyle("height"),10),k=parseInt(e.getStyle("bottom"),10),l=i+j-h,m=f.get("scrollTop"),n=m+(l-k);c.getStyle("height")!==d&&c.setStyle("height",d),b=this.RTE.getScrollHeight(),a=b,a>p&&(a>q?(this.RTE.setBodyStyle("overflowY","auto"),a=q):this.RTE.setBodyStyle("overflowY","hidden"),c.setStyle("height",a+"px")),m!==n&&e.setStyle("bottom",l+"px"),m!==n&&f.set("scrollTop",n)},_send:function(){var b=this.RTE.getTextContent(),c=this;""!==b&&(c._doSend(),c._clearTypingTimer(),c._isTyping=!1,a.later(0,null,function(){m.stat("message_send",{ltxt:c.get("mode")}),g.triggerAds("978500261")}))},_doSend:function(){var b=this.RTE.getContent();a.log('_send html="'+b+'"',"debug","ConversationView"),this.model.sendMessage(a.Messenger.YMLUtil.domToYml(a.Node.create(b).getDOMNode())),this.RTE.clear()},renderMessage:function(b){var c,i,l,n=this,o=new Date(b.timeStamp),p=a.Messenger.Neo.core,q="",r="",s=!1,t="rtl"===a.Tictac.base.bidi.bidiDirection(b.text()),u="ltr",v=p.getDateFormat(o),w=new Date;b.fromSelf?i=h.str_conv_self_objective:(i=n.contact.get("displayName"),("sms"===b.type||"im"===b.type)&&m.stat("message_receive",{ltxt:b.type})),d?(t||(q="ltr",r="ltr"),u="rtl"):t&&(q="rtl",r="rtl"),"offline"!==b.type||n._offlineNotification?"transfer"!==b.type||n._transferNotification?"recent"!==b.type&&b.type!==n.get("mode")&&n.set("mode",b.type):(n._transferNotification=!0,n.renderNotification({message:f.substitute(h.str_conv_user_statexfer_notice,{conversation_user:i}),type:j.NOTIFICATION_INLINE})):(n._offlineNotification=!0,n.renderNotification({message:h.str_conv_user_offlineMessage_notice,type:j.NOTIFICATION_INLINE})),n._lastConversation=n.model.get("messages").slice(-1),(w.getDate()!==o.getDate()||w.getMonth()!==o.getMonth()||w.getYear()!==o.getYear())&&w.getYear()===o.getYear()&&w.getDate()-o.getDate()<7&&(v=p.getDateFormat(o,!1,!0).trim()),c=a.Node.create(e.message({message:b.html(),isRTL:d,isTextRTL:t,fromSelf:b.fromSelf,displayName:i,rtlClass:q,messageDir:u,rtlTimestampClass:r,timestamp:p.dateFormatter(o,v)})),"recent"===b.type?(n.node.one(".mim-recent-message-list").append(c),n._stopRecentMessageSpinner()):(l=n.messageAreaNode.get("scrollHeight")-n.messageAreaNode.get("clientHeight")-n.messageAreaNode.get("scrollTop")<10,n.messageListNode.append(c),l&&n._forceScrollPane()),b.fromSelf||"recent"===b.type?b.fromSelf&&(n.set("unreadCount",0),g.flashWindow(!1)):(n.isVisible()?n.RTE&&!n.RTE.isFocused()&&(s=!0,n._unreadMessage=!0):(n.set("unreadCount",n.get("unreadCount")+1),s=!0),s&&(k.getPreference("mimEnableSounds")&&g.playAudioNotification(),g.flashWindow(f.substitute(h.str_conv_new_message_browser_title,{conversation_user:i}))))},_forceScrollPane:function(){this.messageAreaNode&&this.messageAreaNode.set("scrollTop",this.messageAreaNode.get("scrollHeight"))},setTypingNotification:function(a){a?this.node.one(".mim-typing-notification").setStyle("visibility","visible"):this.node.one(".mim-typing-notification").setStyle("visibility","hidden")},close:function(){m.stat("conversation",{option:"close"}),this.model.destroy({local:!0})},getId:function(){return this.model.get("id")},events:{"click .mim-emoticon-list > .mim-emoticon":"_insertEmoticon","click [data-action]":"_handleActions",'click [data-autodestroy="true"]':"_destroyNotification","click .mim-notification-close":"_destroyNotification","click .mim-notification.mim-show-recent":"_toggleRecentMessages","click .mim-notification.mim-history-all":"_showConvHistory"},_toggleRecentMessages:function(b){var c=this,d=b.currentTarget,e=d.one(".mim-notification-text"),g=c.node.one(".mim-recent-message-list");d.hasClass("mim-hide-recent")?(g.addClass("hidden"),d.removeClass("mim-hide-recent"),e.setHTML(h.str_conv_btn_show_recent_conv)):(g.removeClass("hidden"),c._hasLoadedRecent||(c.model.loadRecentMessages(c.get("mode")),c._hasLoadedRecent=!0,c._hasNotLoadedRecent=!0,a.later(5e3,c,function(){c._hasNotLoadedRecent&&(c._stopRecentMessageSpinner(),d.addClass("hidden"),c.renderNotification({message:f.substitute(h.str_error_recent_messages_empty,{contact:c._getContactDisplayName()}),type:j.NOTIFICATION_SECTION_TOP}))})),e.setHTML(h.str_conv_btn_hide_recent_conv),d.addClass("mim-hide-recent"))},_showConvHistory:function(){var a=this.model.get("user");yui.use("mail-ui-execute-search-utils").then(function(b){b.mail.ui.ExecuteSearchUtils.doMailSearch({searchType:"keyword",query:{keyword:'in:"chats" from:'+a},source:"Search_from_mim_history",shouldParseKeyword:!0,customTitle:{noLabel:!0,value:h.str_opt_msg_general_heading_history}})})},_getContactDisplayName:function(){var b=this.model.get("user"),c=this.model.get("network"),d=a.Messenger.Model.ContactList.getInstance(),e=d.getContact(b,c);return e?e.get("displayName"):""},_stopRecentMessageSpinner:function(){var a;this._hasNotLoadedRecent&&(a=this.node.one(".mim-recent-message-list .mim-recent-message-spinner"),a&&a.remove(),this._hasNotLoadedRecent=!1,this.renderNotification({message:h.str_conv_show_all_history,type:j.NOTIFICATION_SECTION_TOP,className:"mim-history-all",selector:".mim-recent-message-list"}))},_insertEmoticon:function(a){var b,c=a.currentTarget,d=c.getAttribute("data-emotekey"),e=this.model.get("network");"sms"===e&&(e="yahoo"),b=i.emoticonPickerEntries[e][d],this.RTE&&(this.RTE.insertText(b),this._emoticonsPane.addClass("hidden"),this._updateToolbarState())},_updateToolbarState:function(){var a=this.node.all(".mim-conversation-input-toolbar ul.cf li");a.removeClass("mim-toolbar-item-selected"),this._emoticonsPane.hasClass("hidden")?this._formatPane.hasClass("hidden")||this.node.one(".mim-format-link").addClass("mim-toolbar-item-selected"):this.node.one(".mim-emoticons-link").addClass("mim-toolbar-item-selected")},_handleActions:function(b){var c=b.currentTarget.getAttribute("data-action");switch(a.log("ConversationView:_handleActions ",c),c){case"closeconversation":this.close();break;case"format":m.stat("rte_format"),this._formatPane.toggleClass("hidden"),this._emoticonsPane.hasClass("hidden")||this._emoticonsPane.toggleClass("hidden"),this._updateToolbarState(),this.RTE.focus();break;case"emoticons":m.stat("rte_emoticon"),this._emoticonsPane.toggleClass("hidden"),this._formatPane.hasClass("hidden")||this._formatPane.toggleClass("hidden"),this._updateToolbarState(),this.RTE.focus();break;case"conv-mode":this.set("mode",b.currentTarget.getAttribute("data-mode"));break;default:a.log("ConversationView:_handleTopBarEvents bad action ",c)}},showAuthorizationILN:function(b){var c,d,e=a.Messenger.Model.ContactList.getInstance(),i=this,k=i.model.get("alias"),l=i.model.get("user"),n=i.model.get("displayName")||l,o=f.substitute(h.str_conv_no_contact_add_request,{conversation_yid:n}),p=i.model.get("network"),q=e.getContact(l,p);i.node.one(".mim-add-req")||(i.node.one(".mim-unknownuser-iln")&&i._destroyNotification(i.node.one(".mim-unknownuser-iln")),i.isVisible()||i.set("unreadCount",i.get("unreadCount")+1),b&&(o+='<p class="mim-addreq-message">'+a.Escape.html(b)+"</p>"),c=[{label:h.str_conv_btn_accept,title:f.substitute(h.str_conv_btn_accept_attr,{conversation_yid:l}),className:"mim-button-accept",callback:function(){m.stat("add_accept"),q.sendAddResponse({accept:!0,alias:k,err:function(a){i.renderNotification({type:j.NOTIFICATION_INLINE,error:!0,message:g.convertErrorCodeToMessage(a.error.code)})}})}},{label:h.str_conv_btn_decline,className:"mim-button-decline",title:f.substitute(h.str_conv_btn_decline_attr,{conversation_yid:l}),callback:function(){m.stat("add_decline"),q.sendAddResponse({alias:k,accept:!1,err:function(a){i.renderNotification({type:j.NOTIFICATION_INLINE,error:!0,message:g.convertErrorCodeToMessage(a.error.code)})}})}},{label:h.str_conv_btn_decline_block,title:h.str_conv_btn_decline_block,className:"mim-button-decline-block",callback:function(){m.stat("add_block"),q.sendAddResponse({alias:k,accept:!1}),d={success:function(){i._showUnblockUserILN()},err:function(){}},q.ignoreUser(d)}}],i.renderNotification({message:o,type:j.NOTIFICATION_INLINE,buttons:c,className:"mim-add-req"}))},_sendAddRequest:function(b){var c,d,e=this.model.get("alias"),f=a.Messenger.Model.ContactList.getInstance(),i=this.model.get("user"),k=this.model.get("network"),n=this;return(c=g.validateContactForm(b))?c:(m.stat("conversation",{option:"add_to_contacts"}),d=f.getContact(i,k),_.each(b,function(a,b){d.set(b,a),"mobileno"===b&&d.set("normalizedNumber",l.normalizeNumber(a))}),void d.sendAddRequest({addAs:e,group:h.str_conv_default_group,errorCallback:function(a){n.renderNotification({type:j.NOTIFICATION_INLINE,error:!0,message:g.convertErrorCodeToMessage(a.error.code)})}}))},_showSSANotification:function(){this.node.one(".mim-ssa-notify")||this.renderNotification({message:h.str_opt_msg_general_history_description,type:j.NOTIFICATION_STATICTOP,className:"mim-ssa-notify",buttons:[{label:h.str_conv_user_notification_ssa_button,callback:function(){a.Messenger.GlobalEvents.trigger(j.EVENTS.SHOW_OPTIONS)}},{label:h.str_conv_user_notification_ssa_dismiss_button,callback:function(){k.setPreference("mimSSANotificationSeen",!0),k.save()}}]})},_showUnknownUserILN:function(){var b,c=this,d=a.Messenger.Model.ContactList.getInstance(),i=c.model.get("user"),k=c.model.get("network"),l=c.contact.get("firstName")||"",n=c.contact.get("lastName")||"",o=0===h.str_session_display_name_order.indexOf("{{lastName}}"),p=f.substitute(h.str_conv_wrn_unknown_user,{userid:a.Escape.html(i)}),q=[{label:h.str_conv_btn_add_to_contacts,title:f.substitute(h.str_conv_btn_add_to_contacts_attr,{conversation_yid:i}),className:"mim-button-add",callback:function(){g.confirm({title:h.str_cont_add_to_cont,message:e.addcontact({user:i,lastNameFirst:o,isIE:!!a.UA.ie,firstName:l,lastName:n}),hasFormId:{formId:"mim-edit-contact"},callback:function(a){var d=g.validateContactForm(a);return b&&!d&&c._destroyNotification({currentTarget:b}),c._sendAddRequest(a)}})}}],r={label:h.str_conv_btn_block_user,title:f.substitute(h.str_conv_btn_block_user_attr,{conversation_yid:i}),className:"mim-button-block",callback:function(){m.stat("conversation",{option:"block"}),d.getContact(i,k).ignoreUser({success:function(){b&&c._destroyNotification({currentTarget:b}),c._showUnblockUserILN()},err:function(a){c.renderNotification({type:j.NOTIFICATION_INLINE,error:!0,message:g.convertErrorCodeToMessage(a.error.code)})}})}},s={label:h.str_conv_report_abuse,title:h.str_conv_btn_report_abuse_attr,className:"mim-button-abuse",callback:function(){m.stat("conversation",{option:"abuse"}),g.confirm({title:h.str_conv_report_abuse_title,cssClass:"mim-report-abuse-dialog",message:e.report_abuse_spam({reportSpamText:h.str_conv_report_spam_radio,reportSpamDesc:h.str_conv_report_spam_description,reportAbuseText:h.str_conv_report_abuse_radio,reportAbuseDesc:h.str_conv_report_abuse_description}),callback:function(a){switch(b&&c._destroyNotification({currentTarget:b}),a.abuseType){case"spam":m.stat("conversation",{option:"abuse_spam"}),c._spam(),c.close();break;case"abuse":m.stat("conversation",{option:"abuse_threat"}),g.openReportAbuseWindow(h.str_urls_report_abuse_no_trans,c.model.get("messages")),c.contact.ignoreUser(),c.close()}}})}};this.options.initiatedByMe||(q.push(r),q.push(s)),c.node.one(".mim-add-req")||(b=this.renderNotification({className:"mim-unknownuser-iln",message:p,type:j.NOTIFICATION_STATICTOP,buttons:q,showClose:!0,autoDestroy:!1}))},_showUnblockUserILN:function(){var b=this,c=a.Messenger.Model.ContactList.getInstance(),d=this.model.get("user"),e=this.model.get("network"),i=f.substitute(h.str_conv_wrn_unblock_user,{userid:d}),k=[{label:h.str_conv_btn_unblock_user,title:f.substitute(h.str_conv_btn_unblock_user_attr,{conversation_yid:d}),className:"mim-button-unblock",callback:function(){m.stat("conversation",{option:"unblock"}),b.focus(),c.getContact(d,e).unignoreUser({err:function(a){b.renderNotification({type:j.NOTIFICATION_INLINE,error:!0,message:g.convertErrorCodeToMessage(a.error.code)})}})}}];this.renderNotification({message:i,type:j.NOTIFICATION_STATICTOP,buttons:k,showClose:!0})},_showSendErrorILN:function(a){var b=a&&g.convertErrorCodeToMessage(a)||"";this.renderNotification({message:1!==a&&b?b:h.str_comp_send_error,type:j.NOTIFICATION_INLINE,error:!0,showClose:!0})},_spam:function(){var b,c,d,e,f,h,i=this,k=i.model.get("alias"),l=i.contact.get("displayName"),m=[],n=i.model.get("messages");for(d=0,e=n.length;e>d&&50>d;d++)c={message:n[d].yml(),initiatedBy:n[d].fromSelf?1:2},n[d].hash&&(c.hash=n[d].hash),m.push(c);b=0===m.length?1:m[0].initiatedBy,f={alias:k,initiatedBy:b,spims:m,err:function(a){i.renderNotification({type:j.NOTIFICATION_INLINE,error:!0,message:g.convertErrorCodeToMessage(a.error.code)})}},m.length>0&&i.contact.reportSpam(f),h=a.merge(f,{success:function(){i._showUnblockUserILN()}}),i.contact.ignoreUser(h),g.showSpamConfirm(l)},renderModeILN:function(b,c){var d,f,g=this,h=new Date,i=a.Messenger.Neo.core,k=g.model.get("messages");k.length&&"recent"!==k[k.length-1].type&&((g._hasLoadedRecent||!g._lastConversation)&&(f=g.messageAreaNode.one(".mim-section-notification:last-of-type"),!f&&a.UA.ie>0&&(d=g.messageAreaNode.all(".mim-section-notification"),d&&d.slice&&(f=d.slice(-1))),f&&f.remove()),(c||g.previous("mode")!==g.get("mode"))&&(g.renderNotification({message:e.conv_section_modechange({IM:"im"===b,dateTime:i.dateFormatter(h,i.getDateFormat(h))}),type:j.NOTIFICATION_SECTION}),delete g._lastConversation))},renderNotification:function(b){if(!this._destroyed){var c,d,f,g,h,i,k=b.buttons||[],l=b.type||j.NOTIFICATION_INLINE,m=b.message||"",n=this,o=b.autoDestroy,p=b.id,q=b.className||"";return l===j.NOTIFICATION_SECTION||l===j.NOTIFICATION_SECTION_TOP?(c=l===j.NOTIFICATION_SECTION?"append":"prepend",this.node.one(b.selector||".mim-message-list")[c](a.Node.create(e.conv_section_notification({message:m,notifyClass:q}))),void this._forceScrollPane()):(q+=l===j.NOTIFICATION_STATICTOP?" mim-notification-static":l===j.NOTIFICATION_INLINE||l===j.NOTIFICATION_INLINE_TOP?" mim-notification-inline":" mim-notification-plain",b.error&&(q+=" mim-notification-error"),"undefined"==typeof o&&(o=!0),i={notifyClass:q,notifyId:p,showClose:!!b.showClose,notifyType:b.type,messageText:m},l===j.NOTIFICATION_INLINE_PLAINTEXT?i.showClose=!1:b.showClose!==!1&&l===j.NOTIFICATION_STATICTOP&&(i.showClose=!0),d=a.Node.create(e.conv_notification(i)),k.length&&(f=d.one(".mim-notification-buttons"),a.Array.each(k,function(b){return b.label&&b.callback?(g=a.Node.create(e.conv_notification_btn({buttonClass:"mim-notification-button",buttonLabel:b.label,autoDestroy:o})),b.className&&g.addClass(b.className),g.on("click",b.callback),b.attrs&&a.each(b.attrs,function(a,b){g.setAttribute(b,a)}),void f.appendChild(g)):void a.log("Invalid button parameter passed for this notification.  Buttons must have at least a label and a callback.","warn","conversationview")}),f.removeClass("hidden")),l===j.NOTIFICATION_STATICTOP?(h=this.node.one(".mim-notification-area"),h.append(d),h.removeClass("hidden"),n._updateLayout()):l===j.NOTIFICATION_INLINE_TOP?this.node.one(".mim-message-list").prepend(d):(this.node.one(".mim-message-list").append(d),this._forceScrollPane()),d)}},_destroyNotification:function(a){var b,c,d=a.currentTarget||a;d.hasClass("mim-notification")||(d=d.ancestor(".mim-notification")),b=d.hasClass("mim-notification-static"),d.ancestor(".mim-notification",!0).remove(!0),b&&(c=this.node.one(".mim-notification-area"),0===c.get("children").size()&&c.addClass("hidden"),this._updateLayout())}}),a.namespace("Messenger.View").ConversationView=c},"@VERSION@",{requires:["tictac-mim-rollups","tictac-base-view","messenger-contactlist","messenger-ymlutils","tictac-mim-strings","tictac-base-utils","base-bidi","tictac-base-richtexteditor","messenger-constants","messenger-utils","messenger-viewutils","messenger-conversation-css","messenger-usersettings","messenger-stats","messenger-smsutils","messenger-systemsettings","json-parse"]});"use strict";YUI.add("messenger-newconversationview",function(a){function b(a){return a&&a.length>=4&&a.search(/[\\\|\!\#\$\%\^\*\(\)\+\[\]\{\}\?<>]/)<0}function c(a,b){return j.validatePhoneNumber(a,b)}function d(a){var b=/<[^>]*?>/gi;return a.replace(b,"")}function e(a){return a.replace(/\+/,"\\+")}var f,g,h=a.Tictac.mim.rollups,i=a.Messenger.Common.Utils,j=a.Messenger.View.ViewUtils,k=a.Messenger.Common.Stats,l=a.Messenger.Common.Constants,m=a.Messenger.Model.SystemSettings,n=0;f=a.Tictac.base.View.extend({initialize:function(){var a=this;g=m.get("isRTL"),a.set("mode",a.options.mode||"im"),a.on("show",a._onShow,a)},createDOMNode:function(){var b,c=this.options.session,d=this._getContactsArray(),e=c.get("presenceState"),f=c.get("presenceMessage")||j.getDefaultPresenceMessage(e);return b=a.Node.create(h.newconversation({presenceName:j.getPresenceName(e),presenceClassName:j.getBuddyIconClass(c.get("presenceState")),presenceMessage:i.normalizePresenceMessage(f),stateName:j.getStateName(e),contacts:d})),this._renderedContacts=d,b},_contactOverlayClicked:function(b,c,d){var e,f=this,g=a.Messenger.Model,h=a.Messenger.View.ConversationListView.convListView,i=c.split("~"),j=this.collection.get(c)||this.collection.getContact(i[0],i[1]),l=j&&j.get("user"),m=j&&j.get("network"),n=g.Session.get("loggedInId");if(j)switch(k.stat(b,{type:"search_action"}),k.stat("frnd"),b){case"moremenu":f.showContextMenu(j,d,c);break;case"im":h.showConversation(l,m,n);break;case"sms":h.showConversation(l,m,n,"sms");break;case"email":e={cbfn:function(a){var b=a.get("header");b.to=[{name:j.get("displayName"),email:j.get("email")||j.get("user")}],a.set("header",b)}},yui.fire("newMessage",e)}},postRender:function(){this.options.session.on("change:presenceState",this._handlePresenceStateChange,this),this.options.session.on("change:presenceMessage",this._handlePresenceMessageChange,this),this.collection.on("change:presenceState",this._handleUpdateContactState,this),this.collection.on("change:displayName",this._handleContactDisplayNameChange,this),this.collection.on("remove",this._handleContactRemoval,this),this.collection.on("add",this._handleContactAdded,this);var a=this.node.all("#mim-newconversation-contact-list > li");a.size()>0?(this._selectedContactNode=a.item(0),this._selectedContactNode.addClass("mim-contact-selected")):this._selectedContactNode=null,this._filterNode=this.node.one(".mim-contact-input"),this._clearNode=this.node.one(".mim-contact-input-clear")},_onShow:function(){this._filterValue||this._clearFilter(),this.focus()},focus:function(){this._filterNode.focus()},onDestroy:function(){this.options.session.off("change:presenceState",this._handlePresenceStateChange,this),this.options.session.off("change:presenceMessage",this._handlePresenceMessageChange,this),this.collection.off("change:presenceState add",this._handleUpdateContactState,this),this.collection.off("change:displayName",this._handleContactDisplayNameChange,this),this.collection.off("remove",this._handleContactRemoval,this)},_sortScore:function(b,c){var d,e,f="sms"===this.get("mode"),g=l.STATE.AVAILABLE;return"object"==typeof b?(g=b.presenceState,e=b.network,b=b.displayName.toLowerCase()):"string"==typeof b?b=b.toLowerCase():a.log("sortScore unexpected data type "+typeof b+" "+b),d=c&&0===b.indexOf(c)?"0-":f&&"sms"===e?"1-":f||g!==l.STATE.OFFLINE?"5-":"9-",b=d+b},_getMode:function(a,b){var d,e,f=this.get("mode");return a?(d=a.get("mobileno"),e=a.get("network"),"sms"===f?d||"sms"===e||(f="im"):("sms"===e||b&&d&&d.indexOf(b)>=0)&&(f="sms")):f=c(b)?"sms":"im",f},_getContactObj:function(b,c,d){function f(a,b){return a.get?a.get(b):a[b]}var h,i,k,l,n,o;return i=f(b,"displayName"),k=c&&("string"==typeof c?new RegExp(e(c),"i"):c),l=d||("sms"===this.get("mode")?f(b,"mobileno"):f(b,"user")),l=a.Escape.html(l),n=k?i.replace(k,'<span class="mim-contact-matched">$&</span>'):i,o=k?l.replace(k,'<span class="mim-contact-matched">$&</span>'):l,h=l&&i!==l?n+(g?" &rlm;":" ")+'<span class="mim-contact-alternate">('+o+")</span>":n,a.merge(b.attributes,{className:j.getBuddyIconClass(f(b,"presenceState")),mergedDisplayName:h,contact:b,has_email:!!f(b,"email"),has_im:"sms"!==f(b,"network"),has_sms:m.get("smsEnabled")&&!!f(b,"mobileno")})},_byFieldsIncluding:function(a,b){var c,d,f,g,h,i,j={firstName:!1,lastName:!1,nickname:!1,mobileno:!0,email:!1,user:!0,displayName:!0,mergedDisplayName:!1,id:!1};for(d in j)j.hasOwnProperty(d)&&(f=j[d],f&&(g=a[d],h="string"==typeof b?new RegExp(e(b),"i"):b,i=g&&h&&g.match(h),(i||!h)&&(a.mergedDisplayName=this._getContactObj(a.contact,h,g).mergedDisplayName,c=!0)));return c},openConversation:function(d,e){var f,g,h,i=this._getMode(d,e),j=a.Messenger.View.ConversationListView.convListView;d&&d.get("user")?(f=d.get("user"),g=d.get("network")):(f=(b(e)||c(e))&&e,g="sms"===i?"sms":"yahoo","yahoo"===g&&f.indexOf("@")>-1&&(f=a.Messenger.Common.ABUtils.extractYidFromEmail(f),f&&(f=f.id))),j&&f&&j.showConversation(f,g,h,i,!0)},_handlePresenceStateChange:function(a){var b=this.node.one(".mim-user-opi > .mim-presence-state");b&&(b.removeClass(j.getBuddyIconClass(a.previous("presenceState"))).addClass(j.getBuddyIconClass(a.get("presenceState"))),b.setHTML(j.getPresenceName(a.get("presenceState")))),this.presencePlugin&&this.presencePlugin.updateContactListState(a)},_handlePresenceMessageChange:function(a){var b=this.node.one(".mim-user-opi .mim-presence-message");b&&b.setHTML(i.normalizePresenceMessage(a.get("presenceMessage"))),this.presencePlugin&&this.presencePlugin.updateContactListState(a)},_handleUpdateContactState:function(a){this._handleContactRemoval(a),this._handleContactAdded(a)},_handleContactDisplayNameChange:function(a){this._handleContactRemoval(a),this._handleContactAdded(a)},_handleContactRemoval:function(a){var b,c=this,d=c.node.one('li[data-id="'+a.get("id")+'"]');for(d&&d.remove(!0),b=0;b<c._renderedContacts.length;b++)if(c._renderedContacts[b].id===a.get("id")){c._renderedContacts.splice(b,1);break}},_handleContactAdded:function(b){var c,d,e=this,f=e._getContactObj(b),g=e.node.one("#mim-newconversation-contact-list");c=_.sortedIndex(e._renderedContacts,f,function(a){return e._sortScore(a,e._filterValue)}),e._renderedContacts.splice(c,0,f),d=a.Node.create(h.newconv_contact_entry(f)),g.insert(d,g.all("li").item(c))},_getContactsArray:function(){var a,b=this;return a=_.map(this.collection.filter(function(a){var c=b.options.session.isMyself(a.get("user"));return!c&&(!a.get("ignored")||a.get("mobileno"))&&("sms"!==b.get("mode")||a.get("mobileno"))&&(m.get("smsEnabled")||"sms"!==a.get("network"))}),function(a){return b._getContactObj(a)}),a=_.sortBy(a,function(a){return b._sortScore(a)})},_setFilter:function(d,e){var f,g,i,j,k=this,l=k._getContactsArray();l&&(f=_.map(_.filter(l,function(a){return d(a,e)}),function(a){return a}),f=_.sortBy(f,function(a){return k._sortScore(a,e)}),(b(e)||c(e,1))&&(j={className:"ymsg-new-contact",displayName:e,mergedDisplayName:e},f.push(j)),g=a.Node.create(h.newconvcontlist({contacts:f})),k._renderedContacts=f,k.node.one(".mim-newconversation-area").replace(g),i=k.node.all("#mim-newconversation-contact-list > li"),i.size()>0?(k._selectedContactNode=i.item(0),k._selectedContactNode.addClass("mim-contact-selected")):k._selectedContactNode=null)},_clearFilter:function(){var b,c,d=this,e=d._getContactsArray();e=_.sortBy(e,function(a){return d._sortScore(a)}),b=a.Node.create(h.newconvcontlist({contacts:e})),d._renderedContacts=e,d.node.one(".mim-newconversation-area").replace(b),c=d.node.all("#mim-newconversation-contact-list > li"),c.size()>0?(d._selectedContactNode=c.item(0),d._selectedContactNode.addClass("mim-contact-selected")):d._selectedContactNode=null,d._filterNode.set("value",""),d._filterValue="",d._filterFunc=null,d._clearNode.setAttribute("disabled","disabled"),d._clearNode.setAttribute("data-search",!0)},_navUpDownNodes:function(a){var b,c,d,e,f,g,h,i,j,k,l=this.node.all("#mim-newconversation-contact-list > li");l.size()>0&&(b=a>0?l.item(0):l.item(l.size()-1),this._selectedContactNode?(c=l.item(l.indexOf(this._selectedContactNode)+a),c||(c=b)):c=b,l.removeClass("mim-contact-selected"),c&&(this._selectedContactNode=c,this._selectedContactNode.addClass("mim-contact-selected"),d=this._selectedContactNode.get("parentNode"),e=d.getY(),f=parseInt(d.getComputedStyle("height"),10),g=e+f,h=this._selectedContactNode.getY(),i=parseInt(this._selectedContactNode.getComputedStyle("height"),10),j=h+i,k=h>e&&g>j,k||this._selectedContactNode.scrollIntoView(0>a))),n=new Date},_mouseenter:function(a){var b,c=a.currentTarget,d=new Date-n;c&&d>1e3&&(b=this.node.all("#mim-newconversation-contact-list > li"),b.removeClass("mim-contact-selected"),c.addClass("mim-contact-selected"),this._selectedContactNode=c)},_handleKey:function(b){var c,e=this,f=a.Escape.html(d(a.Lang.trim(e._filterNode.get("value"))));e.changeFilterTimeout&&(clearTimeout(e.changeFilterTimeout),e.changeFilterTimeout=null),b&&27!==b.keyCode?40===b.keyCode?(e._navUpDownNodes(1),b.halt()):38===b.keyCode?(e._navUpDownNodes(-1),b.halt()):13===b.keyCode?(e._selectedContactNode&&(c=e._getContactFromLI(e._selectedContactNode),e.openConversation(c,f)),e._clearFilter(),b.halt()):e.changeFilterTimeout=setTimeout(function(){e._filterValue=a.Escape.html(d(a.Lang.trim(e._filterNode.get("value"))));var b=0===e._filterValue.length;b?(e._clearNode.setAttribute("disabled","disabled"),e._clearFilter()):(e._clearNode.removeAttribute("disabled"),e._setFilter(a.bind(e._byFieldsIncluding,e),e._filterValue)),e._clearNode.setAttribute("data-search",b)},100):(e.trigger("escKeyDown"),b&&b.halt())},_getContactFromLI:function(a){var b,c,d=this,e=a.getAttribute("data-id");return e&&(b=e.split("~"),c=d.collection.get(e),!c&&b[0]&&(c=d.collection.getContact(b[0],b[1]))),c},getId:function(){return"new"},close:function(){},clickNewConversationList:function(b){var c,d,e,f,g;c=b.target,d=b.currentTarget,f=this._getContactFromLI(d),e=d.getAttribute("data-id"),g=a.Escape.html(a.Lang.trim(this._filterNode.get("value"))),c.hasClass&&c.hasClass("mim-newconversation-overlay-btn")?(this._contactOverlayClicked(c.getAttribute("data-action"),e,d),b.halt()):(k.stat("im",{type:"search"}),k.stat("frnd"),this.openConversation(f,g),this._clearFilter())},handleContextMenu:function(a){var b,c,d,e,f=this;f.contactPlugin&&(b=a.target,d=a.currentTarget,c=this._getContactFromLI(d),e=d.getAttribute("data-id"),f.showContextMenu(c,d,e),a.halt())},showContextMenu:function(a,b,c){var d,e,f=this;e=f.node.one("#mim-newconversation-contact-list"),d=e.getX()+e.get("offsetWidth")/2,f.contactPlugin.showContactMenu({contact:a,item:b,id:c,leftPos:d,hover:!1,favorites:!1})},handleLogin:function(){},handleLogout:function(){},events:{"mouseenter #mim-newconversation-contact-list > li":"_mouseenter","keydown .mim-newconversation .mim-contact-input":"_handleKey","click #mim-newconversation-contact-list > li":"clickNewConversationList","contextmenu #mim-newconversation-contact-list > li":"handleContextMenu","click .mim-contact-input-clear":"_clearFilter"}}),a.namespace("Messenger.View").NewConversationView=f},"@VERSION@",{requires:["tictac-mim-rollups","tictac-base-view","messenger-contactlist","messenger-ymlutils","tictac-mim-strings","tictac-base-utils","base-bidi","messenger-systemsettings","messenger-constants","messenger-utils","messenger-viewutils","messenger-conversation-css","escape","messenger-abutils","io"]});YUI.add("messenger-message",function(a){"use strict";function b(b){this._yml=b.yml||b.node&&a.Messenger.YMLUtil.domToYml(b.node)||"",this.sender=b.sender,this.receiver=b.receiver,this.fromSelf=b.fromSelf,this.timeStamp=b.timeStamp,this.type=b.type,this.hash=b.hash,this.msgContext=b.msgContext,this.sequence=b.sequence,this.status=b.status,this.mobileno=b.mobileno,this.network=b.network}b.prototype={},b.prototype.constructor=b,b.prototype.html=function(){return this._html||(this._html=a.Messenger.YMLUtil.ymlToHtml(this._yml)),this._html},b.prototype.yml=function(){return this._yml},b.prototype.text=function(){var b=this;if(!b._text)try{b._text=a.Node.create(this.html()).get("text")}catch(c){b._text=""}return b._text},a.namespace("Messenger.Model").Message=b},"@VERSION@",{requires:["messenger-ymlutils"]});YUI.add("messenger-conversation",function(a){"use strict";var b=a.Messenger.Common.Constants,c=b.EVENTS,d={SET_TYPING_STATE:{method:"POST",path:"/v1/message/{{network}}/{{user}}",args:["action=start-typing"]},CLEAR_TYPING_STATE:{method:"POST",path:"/v1/message/{{network}}/{{user}}",args:["action=stop-typing"]},SEND_SMS:{method:"POST",path:"/v1/message/sms/{{number}}"},SEND_MSG:{method:"POST",path:"/v1/message/{{network}}/{{user}}",args:["action=send-message"]},RECENT_MESSAGES_IM:{method:"POST",path:"/v1/message/{{network}}/{{user}}",args:["action=fetch-recent","count=50"]},RECENT_MESSAGES_SMS:{method:"POST",path:"/v1/message/sms/{{number}}",args:["action=fetch-recent","count=50"]}},e=a.Messenger.Common.Utils;a.namespace("Messenger.Model").Conversation=a.Tictac.base.Model.extend({defaults:{user:null,alias:null,network:"yahoo",userTyping:!1,incomingAuth:!1,incomingAuthMessage:"",created:new Date},initialize:function(){var b=this;this.set({messages:[]}),this.on("destroy",function(c,d,e){a.log("Conversation:destroy "),b.set("messages",[]),b._hideTypingTimer&&(b._hideTypingTimer.cancel(),b._hideTypingTimer=null),e.local&&b.close(e)})},request:function(b,c){var d="POST",e="/v1/messages",f=["action="+b,"blocking=0"],g=this.get("user"),h=this.get("alias"),i=this.get("network");a.Messenger.Common.RequestManager.issueRequest({method:d,path:e,args:f,postBody:{convs:[{sender:h,receiver:g,network:i}]},successCallback:a.bind(function(a){c&&c.success&&c.success(a)},this),errorCallback:a.bind(function(a){c&&c.error&&c.error(a)},this)})},ack:function(a){this.request("ack-conv",a)},ackReceived:function(){this.trigger(c.ACK_RECEIVED)},close:function(a){this.request("close-conv",a)},handleError:function(a){this.trigger(b.EVENTS.SMS_ERROR,a.errorCode)},receiveMessage:function(c){var d,e,f,g=this.get("messages");if(c.hash&&("transfer"===c.type||"recent"===c.type))for(d=0,e=g.length;e>d;d++)if(g[d].hash===c.hash)return void a.log("Skipping duplicate state transfer message");var h=new a.Messenger.Model.Message({yml:c.msg,sender:c.sender,receiver:c.receiver,fromSelf:c.echo?!0:!1,timeStamp:1e3*c.timeStamp,network:c.network,type:c.type,hash:c.hash,msgContext:c.msgContext,sequence:c.sequence,status:c.status});g.push(h),f="You have a new MiM message from "+h.sender+'! They say "'+h.yml()+'"',a.log(f),this.set("userTyping",!1),this.trigger(b.EVENTS.MESSAGE,h)},sendMessage:function(b){var c=this,d=new a.Messenger.Model.Message({yml:b,sender:c.get("alias"),receiver:c.get("user"),network:c.get("network"),fromSelf:!0,timeStamp:new Date,type:"im"});c._queueSendRequest(d)},sendSMS:function(b){var c,d,e=this,f=e.get("user"),g=e.get("network")||"sms",h=a.Messenger.Model.ContactList.getInstance(),i=f;c=h.getContact(f,g),i=c.get("normalizedNumber"),d=new a.Messenger.Model.Message({yml:b,sender:e.get("alias"),network:g,receiver:f,fromSelf:!0,timeStamp:new Date,type:"sms",mobileno:i}),e._queueSendRequest(d)},_queueSendRequest:function(a){var c,d,f,g,h=this;d=h.get("messages"),h.messageQueue||(h.messageQueue=[]),d.push(a),g=h.get("alias"),c={convId:e.getConversationId(g,h.get("user"),h.get("network")),txnId:[g,(new Date).getTime(),Math.floor(9*Math.random()+1)].join("~"),message:a.yml(),sendAs:g},f={network:h.get("network"),user:h.get("user"),body:c,type:a.type,mobileno:a.mobileno},h.messageQueue.push(f),1===h.messageQueue.length&&h.sendNextMessage(),h.trigger(b.EVENTS.MESSAGE,a)},handleTypingNotification:function(b){if(this.set({userTyping:!!b.activity}),this._hideTypingTimer&&(this._hideTypingTimer.cancel(),this._hideTypingTimer=null),b.activity){var c=12e3;this._hideTypingTimer=a.later(c,this,function(){this.handleTypingNotification({activity:!1})})}},sendTypingNotification:function(b){var c=b?d.SET_TYPING_STATE:d.CLEAR_TYPING_STATE,e=b?{action:"start-typing"}:{action:"stop-typing"},f=a.Messenger.Common.Utils;e.sendAs=this.get("alias"),a.Messenger.Common.RequestManager.issueRequest({method:c.method,args:c.args,path:f.substitute(c.path,{user:encodeURIComponent(this.get("user")),network:this.get("network")||"yahoo"}),postBody:e})},sendNextMessage:function(){if(0!==this.messageQueue.length){var b,c,f,g,h=this,i=this.messageQueue[0];"sms"===i.type?(b=d.SEND_SMS,f=e.substitute(b.path,{number:encodeURIComponent(i.mobileno)})):(b=d.SEND_MSG,g=b.args,f=e.substitute(b.path,{network:i.network,user:encodeURIComponent(i.user)})),c=b.method,g=b.args,a.Messenger.Common.RequestManager.issueRequest({method:c,path:f,args:g,postBody:i.body,successCallback:function(){h.messageQueue.shift(),h.sendNextMessage()},errorCallback:function(a){h.messageQueue.shift(),h.sendNextMessage(),h.handleSendMessageError(a&&a.error)}})}},handleSendMessageError:function(a){this.trigger(c.SEND_ERROR,{errorCode:a})},loadRecentMessages:function(b){var c,f,g,h=this,i=h.get("user"),j=h.get("network")||"yahoo",k=a.Messenger.Model.ContactList.getInstance();"sms"===b?(c=k.getContact(i,j),f=d.RECENT_MESSAGES_SMS,g=e.substitute(f.path,{number:encodeURIComponent(c.get("mobileno"))})):(f=d.RECENT_MESSAGES_IM,g=e.substitute(f.path,{user:encodeURIComponent(i),network:encodeURIComponent(j)})),a.Messenger.Common.RequestManager.issueRequest({path:g,args:f.args,method:f.method})}})},"@VERSION@",{requires:["messenger-requestmanager","messenger-message","tictac-base-model","messenger-utils","messenger-contactlist","messenger-constants"]});YUI.add("messenger-conversationlist",function(a){"use strict";var b,c=a.Messenger.Common.RequestManager,d=a.Messenger.Model.Session,e=a.Messenger.Common.Utils;b=Backbone.Collection.extend({model:a.Messenger.Model.Conversation,initialize:function(){var b=this;c.addListeners([{id:"message",callback:a.bind(b.parseMessage,b)},{id:"rttIm",callback:a.bind(b.rttIm,b)},{id:"typing",callback:a.bind(b._typingNotificationReceived,b)},{id:"offlineMessage",callback:a.bind(this._processOfflineMessages,this)},{id:"sms",callback:a.bind(this._processIncomingSMS,this)},{id:"recentMessages",callback:a.bind(this._processRecentMessages,this)},{id:"imSession",callback:a.bind(function(a){a.sessioninfo=[{network:a.network||"yahoo",sender:a.sender,receiver:a.receiver,messageCount:a.messageCount}],this._processIMSessions(a)},this)},{id:"imSessions",callback:a.bind(this._processIMSessions,this)},{id:"stateTransfer",callback:a.bind(this._processStateXfer,this)}]),d.on("change:conversations",this.parseConversationsData,this)},newConversation:function(a){return this.add(a),this.get(a.id)},getConversation:function(a){return this.get(a.id)||this.newConversation(a)},_processIncomingSMS:function(a){a.type="sms",this.parseMessage(a)},_processRecentMessages:function(a){var b,c,e,f=a.messageList;if(!a.errorCode)for(b=0,c=f.length;c>b;b++)e=f[b].message,e.echo=d.isMyself(e.sender)?!0:!1,e.type="recent",this.parseMessage(e)},rttIm:function(b){return b.cliData&&(b.cliData=a.JSON.parse(b.cliData)),b.hasOwnProperty("msg")?this.parseMessage(b):b.hasOwnProperty("message")?(b.msg=b.message,b.timeStamp=b.timeStamp/1e3,delete b.message,this.parseMessage(b)):void 0},parseMessage:function(b){b.echo|=b.fbecho;var c,d,f,g,h,i,j=a.Messenger.Model.ContactList.getInstance(),k=a.Messenger.Model.UserSettings,l=b.echo?b.sender:b.receiver,m=b.echo?b.receiver:b.sender,n=b.network||"yahoo";if("yahoo"===n){if("sms"===b.type){if(c=j.where({normalizedNumber:m}),c.length)if(1===c.length)d=c[0];else{for(f=0,g=c.length;g>f;f++)if(this.get(e.getConversationId(l,c[f].get("user"),c[f].get("network")))){d=c[f];break}d=d||c[0]}else n="sms";d&&(m=d.get("user"),n=d.get("network"),b.echo?b.receiver=m:b.sender=m,b.network=n)}return h=e.getConversationId(l,m,n),b.user=m,b.network=n,b.alias=l,b.type=b.type||"im",b.timeStamp||(b.timeStamp=(new Date).getTime()/1e3),k.getPreference("mimBlockNonContacts")&&(d=j.getContact(m,n),"unknown"===d.get("type"))?void a.log("Ignoring message from "+m+" because we are blocking non-contacts","debug"):(i=this.getConversation({id:h,alias:l,user:m,network:n,timeStamp:b.timeStamp}),"sms"===b.type&&b.errorCode&&i.handleError?i.handleError(b):i.receiveMessage(b),i)}},_typingNotificationReceived:function(b){var c=e.getConversationId(b.receiver,b.sender,b.network),d=this.get(c);return d?void d.handleTypingNotification(b):void a.log("No ongoing conversation with the user: "+b.sender)},_processOfflineMessages:function(a){var b,c,d,e=a.messages;for(b=0,c=e.length;c>b;b++)d=e[b].message,d.type="offline",this.parseMessage(d)},_processStateXfer:function(a){var b,c,d,e=a.messageList;for(b=0,c=e.length;c>b;b++)e[b].message&&(d=e[b].message,d.type="transfer",this.parseMessage(d))},_processIMSessions:function(a){var b,c,d,f,g,h,i,j=a.sessionInfo,k=j.length;for(b=0;k>b;b++)g=j[b],d=g.sender,c=g.receiver,f=g.network||"yahoo",h=e.getConversationId(d,c,f),i=this.get(h),i&&(3===a.state?i.ackReceived():2===a.state&&i.destroy())}}),a.namespace("Messenger.Model").ConversationList=new b},"@VERSION@",{requires:["messenger-conversation","messenger-session","messenger-usersettings","messenger-contactlist"]});"use strict";YUI.add("messenger-addrequestview",function(a){var b,c=a.Tictac.mim.rollups,d=a.Messenger.Common.Utils,e=a.Messenger.Model.ContactList.getInstance(),f=a.Messenger.Common.Stats,g={length:0},h=a.Messenger.View.ViewUtils;b=a.Tictac.base.View.extend({initialize:function(){var a=this;a.set("unreadCount",0),a.on("show",a._onShow,a)},createDOMNode:function(){var b,e=this,f=this.options.session,i=this.options.addRequests;return _.each(i,function(a){var b=d.getUserId(a.user,a.network);a.id=b,g[b]=a,g.length++,e.set("unreadCount",e.get("unreadCount")+1)}),b=a.Node.create(c.addrequests({presenceName:h.getPresenceName(f.get("presenceState")),presenceClassName:h.getBuddyIconClass(f.get("presenceState")),presenceMessage:d.normalizePresenceMessage(f.get("presenceMessage")),contacts:i}))},postRender:function(){f.stat("group_add"),this._ulNode=this.node.one(".mim-addreq-container"),this.isVisible()&&this.set("unreadCount",0),this.options.ContactList&&(e=this.options.ContactList)},_onShow:function(){this.isVisible()&&this.set("unreadCount",0)},onDestroy:function(){},getId:function(){return"addrequests"},close:function(){this.destroy()},events:{"click .mim-addreq-container button":"_handleIndividualAction","click .mim-block-all-btn":"_handleBlockAll"},_handleBlockAll:function(){var a,b,c;f.stat("group_add_block_all");for(c in g)g.hasOwnProperty(c)&&-1!==c.indexOf("~")&&(a=g[c],b=e.getContact(a.user,a.network),b.sendAddResponse({accept:!1,alias:a.alias}),b.ignoreUser(),this.node.one('li[data-id="'+c+'"]').remove(),delete g[c]);this.close()},_handleIndividualAction:function(a){var b=a.currentTarget.ancestor("li.mim-addreq-contact"),c=g[b.getData("id")],d=e.getContact(c.user,c.network);a.currentTarget.hasClass("mim-im-btn")?(f.stat("group_add_im"),this.trigger("openConversation",{contact:d})):a.currentTarget.hasClass("mim-decline-btn")?(f.stat("group_add_decline"),d.sendAddResponse({accept:!1,alias:c.alias}),b.remove(),g.length--):a.currentTarget.hasClass("mim-block-btn")?(f.stat("group_add_block"),d.sendAddResponse({accept:!1,alias:c.alias}),d.ignoreUser(),b.remove(),g.length--):(f.stat("group_add_accept"),d.sendAddResponse({accept:!0,alias:c.alias}),b.remove(),g.length--),g.length<=0&&this.close()}}),a.namespace("Messenger.View").AddRequestView=b},"@VERSION@",{requires:["tictac-mim-rollups","tictac-base-view","messenger-contactlist","messenger-ymlutils","tictac-mim-strings","tictac-base-utils","base-bidi","messenger-utils","messenger-viewutils","messenger-conversation-css","messenger-stats"]});"use strict";YUI.add("messenger-conversationlistview",function(a){var b,c=a.Tictac.mim.rollups,d=a.Messenger.Common.Utils,e=a.Messenger.View.ViewUtils,f=a.Tictac.mim.strings,g=a.Messenger.Common.Constants,h=a.Messenger.Model.UserSettings,i=a.Messenger.Common.Stats,j=g.EVENTS,k=a.Messenger.Model.SystemSettings,l="new",m="addrequests",n={top:e.getWindowHeight()-150+"px",left:k.get("isRTL")?+e.getWindowSize().width-150+"px":"150px",opacity:0,width:"50px",height:"50px"},o=a.Messenger.Model.ContactList.getInstance(),p=a.Tictac.base.utils.transitionEndEventName();b=a.Tictac.base.DialogView.extend({hideButtons:!0,hideClose:!0,modal:!1,initialize:function(){function b(c){function d(a){var b=a.currentTarget;h.showNewConversation(b.getAttribute("data-mode")||"im")}if(c=c||0,!(c>30)){if(l=a.one("#menu-new"),!l)return void a.later(100,null,b,++c);f=l.all('[data-action="new-conv"]'),2===f.size()&&(f.item(0).setAttribute("data-mode","im"),f.item(1).setAttribute("data-mode","sms")),h._listeners.push(l.delegate("click",d,'[data-action="new-conv"]'))}}function c(a){var b=a.currentTarget;b.hasClass("sms")?h.showNewConversation("sms"):b.hasClass("im")&&h.showNewConversation("im")}function d(b,c){var d,e;if(c=c||"im",b&&b.id)if("sms"===c)d=o.where({mobileno:b.id}),d.length?h.showConversation(d[0].get("user"),d[0].get("network"),null,c):h.showConversation(b.id,"sms",null,c);else{if(-1!==b.id.indexOf("@")){if(e=a.Messenger.Common.ABUtils.extractYidFromEmail(b.id),!e||!e.id)return;b.id=e.id,b.network=e.network}h.showConversation(b.id,b.network||"yahoo",null,c)}}var f,h=this,k=a.Messenger.Model.Session,l=a.one("#toolbar #btn-new a"),m=a.one("#msg-preview");h.conversationViews={},h.visibleConvID=null,h.collection.on(g.EVENTS.MESSAGE,h._processMessage,h),h.collection.on("change:userTyping",h._processTypingNotification,h),h.collection.on("add",h._processAddRequest,h),o.on(j.ADD_REQUEST_RECEIVED,h.handleAddRequest,h),k.on("change:presenceState",h._handlePresenceChange,h),a.on("keydown",function(b){var c=b.shiftKey&&(b.metaKey||b.ctrlKey);if(c&&!e.isInputNode(b.target)){if(77===b.keyCode)return i.stat("im",{type:"shortcut_ctrl_shift_m"}),i.stat("frnd"),k.login(null,a.bind(h.showNewConversation,h),a.bind(h.showNewConversation,h)),b.halt(),!1;if(89===b.keyCode)return i.stat("sms",{type:"shortcut_ctrl_shift_y"}),h.showNewConversation("sms"),b.halt(),!1}},a.UA.ie?document:window),l&&l.once("click",b),m&&h._listeners.push(m.delegate("click",c,"#msg-preview-media-modes span a")),window.yui&&(h._listeners.push(yui.on("contacts:sendIM",d)),h._listeners.push(yui.on("chats:sendIM",d)),h._listeners.push(yui.on("contacts:sendSms",function(a){d(a,"sms")})),h._listeners.push(yui.on("chats:sendSms",function(a){d(a,"sms")}))),h._addReqs=[]},onDestroy:function(){var b=this,c=a.Messenger.Model.Session;b.off("stopResize",b._onStopResize,b),b.off("stopMove",b._onStopMove,b),b.collection.off(g.EVENTS.MESSAGE,b._processMessage,b),b.collection.off("change:userTyping",b._processTypingNotification,b),b.collection.off("add",b._processAddRequest,b),o.off(j.ADD_REQUEST_RECEIVED,b.handleAddRequest,b),c.off("change:presenceState",b._handlePresenceChange,b)},renderContent:function(b){b.ancestor(".modal").addClass("mim-conversations"),b.append(a.Node.create(c.conversationlist()))},postRender:function(){var b=this,c=e.getWindowSize(),d=a.Messenger.Neo.yui,f=h.getPreference("mimConvWinSizePref"),g=h.getPreference("mimConvWinSizePrefOld"),i=h.getPreference("mimConvWinPosPref");if(this.listNode=this.node.one("ul.mim-conversations-list"),this.tabNode=this.node.one("ul.mim-conversations-tabs"),this.tabNode&&(this._overflowButton=this.tabNode.one(".mim-overflow-tab"),this._addButton=this.tabNode.one(".mim-new-tab")),this.on("resize",function(){b._makeConversationTabVisible(),b._checkTabOverflow()}),"string"==typeof f)try{f=JSON.parse(f)}catch(j){}if("string"==typeof i)try{i=JSON.parse(i)}catch(j){}f.width===g.width&&(f.width=300),f?("string"==typeof f.width&&(f.width=parseInt(f.width,10),isNaN(f.width)&&(f.width=0)),"string"==typeof f.height&&(f.height=parseInt(f.height,10),isNaN(f.height)&&(f.height=0)),f.width=Math.max(250,f.width),f.height=Math.max(250,f.height)):f={width:300,height:350},this.node.setStyles({width:f.width+"px",height:f.height+"px"}),i||(i={right:200,bottom:20}),this.node.setStyles({bottom:i.bottom+"px",right:i.right+"px"}),this.on("change:unreadCount",this._handleNewMsgNotification,this),this.on("change:minimized",this._handleConvMinMax,this),this._handleNewMsgNotification(this),this.options.minimized!==!1?(this.minimize(),this._viewStyles={top:c.height-(~~f.height+~~i.bottom)+"px",left:c.width-(~~f.width+~~i.right)+"px",opacity:1,width:f.width+"px",height:f.height+"px"}):this.set("minimized",!1),this.on("stopResize",this._onStopResize,this),this.on("stopMove",this._onStopMove,this),this.on("hide",this._onHide,this),d.on("nav:messenger",this._onActivate,b)},_toggleHideCurrentView:function(a){var b=this.conversationViews[this.visibleConvID];b&&(a?b.hide():(b.show(),this._switchConversationTab(this.visibleConvID)))},_onActivate:function(){this.get("minimized")&&(i.stat("window_maximize"),this.maximize())},_onStopResize:function(){var a=this,b=a.node.get("region");h.setPreference("mimConvWinSizePref",{width:b.width,height:b.height}),a._onStopMove()},_onStopMove:function(){var a,b=this,c=b.node.get("region"),d=e.getWindowSize();k.get("isRTL")&&b.node.setStyles({right:e.getWindowSize().width-c.right+"px",left:"auto"}),h.setPreference("mimConvWinPosPref",{right:d.width-c.right,bottom:d.height-c.bottom}),h.save(),null!==(a=b.visibleConvID)&&b.conversationViews[a]&&b.conversationViews[a].focus()},_onHide:function(){this.set("minimized",!0)},close:function(a,b){if(!a||!a.type||"keydown"!==a.type||13===a.keyCode){var c=this;return i.stat("window_close"),!b&&this.get("unreadCount")?void e.confirm({message:f.str_conv_close_confirm,callback:function(){c.close(a,!0)}}):void c.minimize()}},minimize:function(a){if(!a||"undefined"==typeof a.type||"click"===a.type||13===a.keyCode){var b=this;if(b.get("minimized"))return;b.tabNode&&b.tabNode.addClass("mim-overflow-hidden"),b._toggleHideWindow(!0,function(){b._toggleHideCurrentView(!0),a&&"function"==typeof a?a():a&&a.halt&&i.stat("window_minimize")}),b.set("minimized",!0)}},maximize:function(){var a=this;a.get("minimized")&&(a._toggleHideWindow(!1,function(){var b=a.node.get("region");a._checkTabOverflow(),a._toggleHideCurrentView(!1),k.get("isRTL")&&a.node.setStyles({right:e.getWindowSize().width-b.right+"px",left:"auto"}),a.visibleConvID||a.showNewConversation(),a.tabNode&&a.tabNode.removeClass("mim-overflow-hidden"),a.visible=!0,e.bringToFront(a.node),e.limitToViewport(a.node)}),a.set("minimized",!1))},_toggleHideWindow:function(b,c){function d(){p&&h.removeEventListener(p,d),b&&g.addClass("hidden"),c&&c()}var f=this,g=f.node,h=g.getDOMNode(),i=".nav-item-messenger",j={},l=["top","left","opacity","width","height"];b?(f._viewStyles={},g.setStyle("top",g.get("offsetTop")+"px"),g.setStyle("left",g.get("offsetLeft")+"px"),n.top=a.one(i).get("region").top+"px",k.get("isRTL")&&(n.left=+e.getWindowSize().width-150+"px",g.setStyles({bottom:"auto",right:"auto"})),_.each(l,function(a){f._viewStyles[a]=g.getStyle(a)}),_.extend(j,n)):(g.removeClass("hidden"),g.setStyle("top",a.one(i).get("region").top+"px"),k.get("isRTL")&&(n.left=+e.getWindowSize().width-150+"px"),_.extend(j,n,f._viewStyles)),p&&"undefined"!=typeof f.get("minimized")&&h.addEventListener(p,d),g.setStyles(j),p||window.setTimeout(d,0)},_updateUnreadCount:function(){var a,b=0;for(a in this.conversationViews)this.conversationViews.hasOwnProperty(a)&&this.conversationViews[a].get("unreadCount")&&(b+=this.conversationViews[a].get("unreadCount"));this.set("unreadCount",b)},_addConversation:function(b,c,e,f,g){var h,i,k,l,m,n=this,p=n.collection,q=a.Messenger.Model.Session,r=a.Messenger.View.ConversationView;return c=c||"yahoo",h=o.get(d.getUserId(b,c)),i=h?h.get("displayName"):b,e=e||q.get("loggedInId"),k=d.getConversationId(e,b,c),m=n.conversationViews[k],m?m.set("mode",f):((l=p.get(k))||(p.add({id:k,user:b,network:c,alias:e},{silent:!0}),p.trigger(j.CONVERSATION_INIT,{id:k,user:b,network:c}),l=p.get(k)),f=f||"im",m=new r({parent:n.listNode,container:'<li class="mim-conversations-conversation hidden"></li>',model:l,mode:f,limitToViewport:!1,keyEvents:[{keyCode:219,metaCtrlKey:!0,callback:a.bind(n.togglePrevConv,n),halt:!0},{keyCode:221,metaCtrlKey:!0,callback:a.bind(n.toggleNextConv,n),halt:!0},{keyCode:9,shiftKey:!0,halt:!0,callback:function(a){var b=n.node.one('a[data-action="emoticons"]');a&&a.blur&&a.blur(),b&&b.focus&&b.focus()}},{keyCode:9,shiftKey:!1,callback:function(){(a.UA.ie?document:window).focus()}}],initiatedByMe:g}),n.conversationViews[k]=m,m.render(),n._addConversationTab(k,i,b),m.on("destroy",function(){n._conversationViewDestroyed(k)},n),m.on("change:unreadCount",function(a){n._updateTabBadge(a.getId()),n._updateUnreadCount()}),m.on(j.DISPLAYNAME_UPDATED,this._updateTabLabel,this)),m},_delegateAddRequest:function(){var a,b,c=this;c._addReqs&&c._addReqs.length&&(c._addReqs.length>1?c._addRequestView():(b=c._addReqs[0],a=this.addConversation(b.user,b.network,b.alias),a&&a.showAuthorizationILN(b.msg)),c._addReqs=[])},_addRequestView:function(){var b=this,c=m,d=a.Messenger.View.AddRequestView,e=a.Messenger.Model.Session,g=b.conversationViews[c];g||(g=new d({parent:b.listNode,container:'<li class="mim-conversations-conversation hidden"></li>',addRequests:b._addReqs,limitToViewport:!1,session:e}),b.conversationViews[c]=g,g.render(),b._addConversationTab(m,f.str_conv_add_requests),b._updateTabBadge(c),b.visibleConvID||b._showExistingConversationView(g),b._updateUnreadCount(),g.on("change:unreadCount",function(a){b._updateTabBadge(a.getId()),b._updateUnreadCount()}),g.on("openConversation",function(a){a.contact&&b.showConversation(a.contact.get("user"),a.contact.get("network"),a.contact.get("alias"))}),g.on("destroy",function(){b._conversationViewDestroyed(c)},b))},_newConversation:function(b){var c,d,e=this,f=a.Messenger.Model.Session,g=a.Messenger.View.NewConversationView;return b=b||"im",c=l,d=e.conversationViews[c],d?d.set("mode",b):(d=new g({parent:e.listNode,container:'<li class="mim-conversations-conversation hidden"></li>',collection:o,limitToViewport:!1,conversationWindow:e,session:f,mode:b}),e.conversationViews[c]=d,d.on("escKeyDown",function(){var b=a.Object.size(e.conversationViews);1===b?e.close():e.togglePrevConv()}),d.render(),d.on("destroy",function(){e._conversationViewDestroyed(c)},e)),d},togglePrevConv:function(){this._toggleConv("prev")},toggleNextConv:function(){this._toggleConv("next")},_toggleConv:function(a){var b,c,d=_.keys(this.conversationViews),e=this.visibleConvID,f=_.indexOf(d,e);b="prev"===a?f>0?f-1:f=d.length-1:f>d.length-2?f=0:f+1,c=this.conversationViews[d[b]],this._showExistingConversationView(c)},_addConversationTab:function(b,e,g){var h=this._addButton?2:1,i=a.Node.create(c.conversationtab({convId:b,displayTitle:e===g||b===m?e:d.substitute(f.str_session_title_order,{displayName:e,user:g}),displayName:e}));h=1,this.tabNode.insert(i,h),this._checkTabOverflow()},_removeConversationTab:function(a){var b=this.tabNode.one('[data-id="'+a+'"]');b&&b.remove(),this._checkTabOverflow()},_makeConversationTabVisible:function(a){a||(a=this.tabNode.one('[data-id="'+this.visibleConvID+'"]')),a&&a.hasClass("mim-overflowing")&&(a.removeClass("mim-overflowing"),this.tabNode.removeChild(a),this.tabNode.prepend(a))},_switchConversationTab:function(a,b){var c=this.tabNode.one(".active"),d=this.tabNode.one('[data-id="'+a+'"]');c&&(c.removeClass("active"),c.removeClass("tt-active-tab-bg"),c.removeClass("mim-has-msg"),c.addClass("tt-inactive-tab-bg")),d&&(d.addClass("active"),d.addClass("tt-active-tab-bg"),d.removeClass("tt-inactive-tab-bg"),d.removeClass("mim-has-unread"),this._makeConversationTabVisible(d)),b||this._checkTabOverflow(),this._updateOverflowTabBadge()},_updateTabBadge:function(a){var b=this.conversationViews[a],c=this.tabNode.one('[data-id="'+a+'"]'),d=b.get("unreadCount");d?(c.one(".mim-msg-badge").setHTML(d),c.addClass("mim-has-msg")):c.removeClass("mim-has-msg"),this._updateOverflowTabBadge()},_updateTabLabel:function(a,b){var c,d=this.tabNode.one('[data-id="'+a+'"]');d&&(c=d.one(".mim-contact-name"),c.setAttribute("title",b),c.setHTML(b),this._checkTabOverflow())},_updateOverflowTabBadge:function(){var a,b=this.tabNode.all(".mim-overflowing.mim-has-msg .mim-msg-badge"),c=0;b.each(function(b){a=~~b.getHTML(),"number"==typeof a&&(c+=a)}),c>0?(this._overflowButton.one(".mim-msg-badge").setHTML(c),this._overflowButton.addClass("mim-has-msg")):this._overflowButton.removeClass("mim-has-msg")},_checkTabOverflow:function(){var b,c,d,e,f=this.tabNode.all(".mim-conv-tab"),g=f.size(),h=80,i=0,j=this.node.get("offsetWidth");this._addButton&&(j-=this._addButton.get("offsetWidth")),f.setStyle("width","auto"),this.tabNode.removeClass("mim-has-overflow"),this.tabNode.all(".mim-overflowing").removeClass("mim-overflowing"),0!==j&&(d=f.get("offsetWidth"),d&&0!==d.length&&(i=_.reduce(d,function(a,b){return a+b}),j>=i?a.log("No overflow nor any tab size adjustment!"):j>=g*h?(i=h*g,e=~~((j-i)/d.length),f.setStyle("width",h+e+"px")):(this.tabNode.addClass("mim-has-overflow"),j-=this._overflowButton.get("offsetWidth"),c=~~(j/h),b=f.slice(0,c),b.removeClass("mim-overflowing"),f.slice(c,g).addClass("mim-overflowing"),i=h*c,e=~~((j-i)/c),b.setStyle("width",h+e+"px"))))},addConversation:function(a,b,c){var d=this._addConversation(a,b,c);return this.visibleConvID||this._showExistingConversationView(d),d},showConversation:function(b,c,d,e,f){var g=this,h=a.Messenger.Model.Session;h.login(null,function(){var a=g._addConversation(b,c,d,e,f);g._showExistingConversationView(a),g.maximize()})},showNewConversation:function(a){var b=this,c=b._newConversation(a);b._showExistingConversationView(c),b.maximize()},_showExistingConversationView:function(a){var b=a.getId(),c=this.visibleConvID&&this.conversationViews[this.visibleConvID];c&&c.hide(),this.get("minimized")||(a.show(),a._timeShown=new Date),this._switchConversationTab(b),this.visibleConvID=b,this.isVisible()||this.get("minimized")||this.show()},_conversationViewDestroyed:function(a){this._removeConversationTab(a),delete this.conversationViews[a],a===this.visibleConvID&&(this.visibleConvID=null),this._updateUnreadCount(),this._showPriorConversation()},_showPriorConversation:function(){var a,b="new"!==this.visibleConvID;_.each(this.conversationViews,function(c){"new"!==c.getId()&&(b=!1),(!a||c._timeShown>a._timeShown)&&(a=c)}),a&&!b?this._showExistingConversationView(a):this._handleNewTab()},_processMessage:function(a){var b=a.fromSelf?a.receiver:a.sender,c=a.network,e=a.fromSelf?a.sender:a.receiver,f=d.getConversationId(e,b,c),g=this.conversationViews[f];g?g.renderMessage(a):this.addConversation(b,c,e),this._updateTabBadge(f)},_processTypingNotification:function(a){var b=a.get("id"),c=this.conversationViews[b];c.setTypingNotification(a.get("userTyping"))},_processAddRequest:function(a){this.addConversation(a.get("user"),a.get("network"),a.get("alias"))},handleAddRequest:function(b){i.stat("add"),this._addReqs.push(b),window.setTimeout(a.bind(this._delegateAddRequest,this),1e3)},_closeConversationEventHandler:function(a,b){var c=a.currentTarget.ancestor("[data-id]"),d=c.getAttribute("data-id"),g=this.conversationViews[d],h=this;return a.halt(),g.get("unreadCount")&&!b?void e.confirm({message:f.str_conv_tab_close_confirm,callback:function(){h._closeConversationEventHandler(a,!0)}}):void g.close()},_handleTabSwitch:function(b){if(!b.target.hasClass("btn-close-conversation")){var c=b.currentTarget,d=c.getAttribute("data-id"),f=this.conversationViews[d];this._showExistingConversationView(f),this._handleTabOverflow(),a.later(0,null,function(){e.triggerAds("978500262")})}},_handleTabOverflow:function(b){var c,d=this,e=a.UA.ie?document:window,f=this._overflowContainer,g=this._overflowButton;f||(this._overflowContainer=this.node.one(".mim-overflow-tabs"),f=this._overflowContainer),void 0!==b&&f.hasClass("hidden")?(c=d.tabNode.all("li.mim-overflowing"),f.empty().removeClass("hidden"),g&&g.addClass("mim-selected"),c.each(function(a){f.append(a.cloneNode(!0).removeClass("tt-inactive-tab-bg"))}),f.removeClass("hidden"),a.later(0,null,function(){d._overflowMenuListener=a.on("click",function(a){a.target.ancestor(".mim-menu.mim-overflow-tabs",!0)||d._handleTabOverflow()},e)})):(f.addClass("hidden"),g&&g.removeClass("mim-selected"),d._overflowMenuListener&&d._overflowMenuListener.detach())},_handlePresenceChange:function(a){a.get("presenceState")===g.STATE.OFFLINE?_.each(this.conversationViews,function(a){a.handleLogout&&a.handleLogout()}):(a.previous("presenceState")===g.STATE.OFFLINE||a.previous("presenceState")===g.STATE.PENDING)&&_.each(this.conversationViews,function(a){a.handleLogin&&a.handleLogin()})},_handleNewTab:function(){i.stat("window_plus"),this.showNewConversation()},_handleNewMsgNotification:function(b){var c=a.one(".nav-item-messenger");c&&e.showNewMsgNotification(b,c)},_handleConvMinMax:function(b){var c=a.one(".nav-item-messenger");c&&e.handleConvMinMax(b,c)},events:{'click [data-action="closeconversations"]':"close",'keydown [data-action="closeconversations"]':"close",'click [data-action="hideconversations"]':"minimize",'keydown [data-action="hideconversations"]':"minimize",'click [data-action="closeconversation"]':"_closeConversationEventHandler","click li.mim-conv-tab":"_handleTabSwitch","click li.mim-overflow-tab":"_handleTabOverflow","click li.mim-new-tab":"_handleNewTab"}}),a.namespace("Messenger.View").ConversationListView=b},"@VERSION@",{requires:["tictac-mim-rollups","tictac-base-dialogview","tictac-base-utils","messenger-utils","messenger-viewutils","messenger-conversationview","messenger-newconversationview","messenger-conversationlist","messenger-conversationlist-css","messenger-addrequestview","tictac-mim-strings","messenger-session","messenger-usersettings","messenger-stats","messenger-contactlist","messenger-abutils","messenger-systemsettings","messenger-constants"]});"use strict";YUI.add("messenger-ssp",function(a){var b={SSP_SET:{method:"PUT",path:"/v1/preferences"},SSP_GET:{method:"GET",path:"/v1/preferences"}},c={mimEnableSSA:"server.archive.enable"},d={},e=a.Tictac.mim.strings;a.Messenger.Common.SSPUserPreferences=function(){return{_dirtyPrefs:{},async:!0,get:function(e,f){var g=b.SSP_GET,h=["pref="+c[e]||e];d[e]||(d[e]=!0,a.Messenger.Common.RequestManager.issueRequest({type:"SSP_GET",server:"ssp",args:h,retries:5,method:g.method,path:g.path,successCallback:function(a){var b=a&&a.preferences?a.preferences[0].preference.value[0]:null;"1"===b?b=!0:"0"===b&&(b=!1),f(b),delete d[e]},errorCallback:function(){delete d[e],a.log("Error reading the SSP preference for key "+e)}}))},set:function(a,b){this._dirtyPrefs[a]=b},save:function(d){var f={preferences:[]},g={preference:{}},h=b.SSP_SET;_.isEmpty(this._dirtyPrefs)?d():(a.each(this._dirtyPrefs,function(a,b){a===!0?a="1":a===!1&&(a="0"),g.preference.key=c[b]||b,g.preference.value=[],g.preference.value.push(a)}),f.preferences.push(g),this._dirtyPrefs={},a.Messenger.Common.RequestManager.issueRequest({type:"SSP_SET",server:"ssp",postBody:f,retries:5,method:h.method,path:h.path,successCallback:function(){d()},failureCallback:function(){d(e.str_msgr_server_error_1)}}))}}}()},"@VERSION@",{requires:["messenger-requestmanager","tictac-mim-strings"]});"use strict";YUI.add("messenger-optionsview",function(a){var b=a.Messenger.Model.UserSettings,c=a.Messenger.Model.SystemSettings,d=a.Messenger.Common.Constants,e=a.Messenger.Common.Stats,f=a.Tictac.mim.strings,g=a.Tictac.mim.rollups,h=a.Messenger.Common.Utils,i=a.Messenger.Model.Session;a.namespace("Messenger.View").OptionsView=a.Tictac.base.View.extend({title:f.str_branding_messenger_generic,initialize:function(){this.on("show",this._onShow,this),this.on("hide",this._onHide,this),this._nodeListeners=[]},onDestroy:function(){for(;this._nodeListeners.length;)this._nodeListeners.pop().detach();i.off("change:presenceState",this._handlePresenceChange,this)},createDOMNode:function(){var d=b.getPreference("mimLogoutPref"),e=c.get("smsEnabled"),h=a.Node.create(g.options({title:f.str_menu_messenger_options,showButtons:!0,localSelected:"local"===d?!0:!1,globalSelected:"global"===d?!0:!1,promptSelected:"prompt"===d?!0:!1,enableSounds:b.getPreference("mimEnableSounds"),showOnlyBuddies:b.getPreference("mimShowOnlyBuddies"),smsEnabled:e,countries:e?a.Messenger.View.ViewUtils.getPhoneCountries():[]}));return h.addClass("mim-options-view hidden"),h},postRender:function(){var a=this;a.node.one("#mim-addBlockedUserButton").on("click",a.showAddIgnoreDialog,a),a.node.one("#mim-removeBlockedUserButton").on("click",a.removeIgnoredUsers,a),a._nodeListeners.push(this.node.one("#mim-blockNonBuddies").on("change",function(b){a._setIgnoreListDisabledState(b.target.get("checked"))})),a._nodeListeners.push(this.node.one("#mim-blockSelected").on("change",function(b){a._setIgnoreListDisabledState(!b.target.get("checked"))}))},removeIgnoredUsers:function(){var b,c,d,e,f=this.node.one("#mim-blocklist").all("option"),g=a.Messenger.Model.ContactList.getInstance();f.each(function(a){a.get("selected")&&(b=a.getAttribute("value").split("~"),c=b[0],d=b[1],e=g.getContact(c,d),e.unignoreUser(),a.remove(!0))})},showAddIgnoreDialog:function(){var b=a.Messenger.View.ViewUtils,c=a.Messenger.Model.ContactList.getInstance(),d=this;b.confirm({callback:function(e){var g,i=a.Escape.html(e["mim-ignore-user"]),j="yahoo";return i?i.length<4||i.length>32?h.substitute(f.str_cont_add_contact_error_invalid_id,{user:h.unescapeHTML(i),network:j}):(g=c.getContact(i,j),void g.ignoreUser({success:function(){d._populateIgnoreList()},err:function(a){"unknown"===g.get("type")&&c.remove(g.id),b.alert({message:b.convertErrorCodeToMessage(a.error.code)})}})):f.str_conv_error_empty_general},title:f.str_conv_btn_block_user,message:g.addignore()})},_onShow:function(){var c=this;e.stat("options"),c._populateIgnoreList(),b.getPreference("mimBlockNonContacts")?(c.node.one("#mim-blockNonBuddies").getDOMNode().checked=!0,c._setIgnoreListDisabledState(!0)):(c.node.one("#mim-blockSelected").getDOMNode().checked=!0,c._setIgnoreListDisabledState(!1)),b.getPreference("mimEnableSSA",function(a){var b=c.node.one("#mim-enableSSACheckbox");b.removeAttribute("disabled"),a?b.setAttribute("checked","checked"):b.removeAttribute("checked")}),i.on("change:presenceState",c._handlePresenceChange,c),a.later(0,null,function(){c._focusOnLogoutSelect()})},_focusOnLogoutSelect:function(){var a=this.node.one("#mim-logoutSelect");a&&a.focus()},_populateIgnoreList:function(){var b,c,d,e,f,g=a.Messenger.Model.ContactList.getInstance(),i=g.where({ignored:!0}),j=this.node.one("#mim-blocklist"),k='<option value="{{id}}">{{user}}</option>';for(j.setHTML(""),b=0,c=i.length;c>b;b++)e=i[b].get("user"),f=i[b].get("network"),d=a.Node.create(h.substitute(k,{id:h.getUserId(e,f),user:e})),j.append(d)},_onHide:function(){var b=a.Messenger.Model.Session;b.off("change:presenceState",this._handlePresenceChange,this)},_handlePresenceChange:function(a){this._setIgnoreListDisabledState(a.get("presenceState")===d.STATE.OFFLINE)},_setIgnoreListDisabledState:function(b){var c=this.node.one("#mim-blocklist"),e=this.node.all(".mim-options-ignore button"),f=this.node.one("#mim-offlineError"),g=a.Messenger.Model.Session,h=g.get("presenceState")===d.STATE.OFFLINE;b=b||h,b?(c.setAttribute("disabled","disabled"),e.setAttribute("disabled","disabled"),h&&f.removeClass("hidden")):(c.removeAttribute("disabled"),e.removeAttribute("disabled"),f.addClass("hidden"))},save:function(d){var f={},g=a.Messenger.Model.ContactList.getInstance(),h=this.node,i=h.one("#mim-showOnlyBuddiesCheckbox").get("checked");e.stat("options_save"),f={mimLogoutPref:h.one("#mim-logoutSelect").get("value"),mimEnableSounds:h.one("#mim-enableSoundsCheckbox").get("checked"),mimShowOnlyBuddies:i,mimBlockNonContacts:h.one("#mim-blockNonBuddies").get("checked"),mimEnableSSA:h.one("#mim-enableSSACheckbox").get("checked")},c.get("smsEnabled")&&(f.mimHomeCountryPref=h.one("#mim-homeCountrySelect").get("value")),b.getPreference("mimShowOnlyBuddies")!==i&&(i?g.handleABPresence("unsubscribe"):g.handleABPresence("subscribe")),b.setPreference(f),b.save(),d()},focusOnPresenceMenu:function(b){13===b.keyCode&&a.later(0,null,function(){a.Messenger.View.ViewUtils.focusOnPresenceStateMenu(b)})},_handleKeyBlockNonBuddies:function(a){var b,c,d=this;40===a.keyCode?(b=d.node.one("#mim-blockSelected"),b&&void 0!==b.get("checked")&&(b.set("checked","true"),b.focus()),a.halt()):38===a.keyCode&&(c=d.node.one("#mim-showOnlyBuddiesCheckbox"),c&&c.focus&&c.focus(),a.halt())},_handleKeyBlockSelected:function(a){var b,c,d=this;38===a.keyCode?(b=d.node.one("#mim-blockNonBuddies"),b&&void 0!==b.get("checked")&&(b.set("checked","true"),b.focus()),a.halt()):40===a.keyCode&&(c=d.node.one("#mim-blocklist"),c&&c.focus&&c.focus(),a.halt())},_focusOnFirstEntryInBlockList:function(a){var b=a.currentTarget.one("option");b&&void 0!==b.get("selected")&&(b.set("selected","true"),b.focus())},_stopEventPropagation:function(a){a.stopPropagation()},_handleKeyCancel:function(b){9===b.keyCode?(this._focusOnLogoutSelect(),b.halt()):13===b.keyCode&&a.later(0,null,function(){a.Messenger.View.ViewUtils.focusOnPresenceStateMenu(b)})},events:{"keydown .mim-button-ok":"focusOnPresenceMenu","keydown #mim-blockNonBuddies":"_handleKeyBlockNonBuddies","keydown #mim-blockSelected":"_handleKeyBlockSelected","focus #mim-blocklist":"_focusOnFirstEntryInBlockList","keydown .mim-options-list":"_stopEventPropagation","keydown .mim-button-cancel>a":"_handleKeyCancel"}})},"@VERSION@",{requires:["tictac-mim-rollups","tictac-base-view","tictac-mim-strings","messenger-options-css","messenger-utils","messenger-contactlist","messenger-constants","messenger-session","messenger-viewutils","messenger-usersettings","messenger-systemsettings"]});"use strict";YUI.add("messenger-convviewsmsplugin",function(a){var b,c=a.Messenger.View.ConversationView,d=a.Tictac.mim.rollups,e=a.Tictac.mim.strings,f=a.Messenger.Common.Utils,g=a.Messenger.Common.Constants,h=g.EVENTS,i=a.Messenger.Common.SMSUtils;b={initialize:function(a){var b=this,c=a._handleEditorEvents,d=a._doSend;a.on("change:mode",b._handleModeChange,b),a.on("show",b._handleShow,b),a._doSend=function(){"sms"===a.get("mode")?b._sendSMS(a,arguments):d.apply(a,arguments)},a._handleEditorEvents=function(d){return"sms"===a.get("mode")&&"keyup"===d.type&&b._updateCharCounter(a),c.apply(a,arguments)},a.model.on(h.SMS_ERROR,function(c){b._handleSMSError(a,c)},b)},_sendSMS:function(b){var c,d,e;c=b.RTE.getTextContent(),d=this._getRemainingCount(b,c),0>d?(e=a.Messenger.Common.SMSUtils.splitStrBytes(c,this._getMaxSMSBytes(b)),b.RTE.setTextContent(e[1]),c=e[0]):b.RTE.clear(),a.log('_send sms="'+c+'"',"debug","ConversationView"),b.model.sendSMS(c)},_handleSMSError:function(a,b){var c,d,h,i=this;b===g.SMS.RATIO_BREACHED?d=f.substitute(e.str_conv_user_sms_notice_error_ration_breached,{user:a.contact.get("displayName")}):b===g.SMS.INVALID_NUMBER?(d=f.substitute(e.str_conv_user_sms_notice_error_failed_to_deliver,{number:a.contact.get("mobileno")}),h=[{label:e.str_conv_user_sms_edit_number,title:e.str_conv_user_sms_edit_number,callback:function(){i.promptPhoneNumber(a,c)}}]):d=f.substitute(e.str_conv_user_sms_notice_error_system_busy,{number:a.contact.get("mobileno")}),c=a.renderNotification({message:d,type:g.NOTIFICATION_INLINE,error:!0,buttons:h})},_handleShow:function(a){a.node.all(".mim-mode-toggle").removeClass("hidden"),"sms"===a.get("mode")&&this._updateUI(a)},_updateUI:function(b){var c=b.node.one("div.mim-conversation");c.addClass("mim-sms"),b.node.one(".mim-user-mobileno").setHTML(a.Escape.html(b.contact.get("mobileno"))),b._formatPane.addClass("hidden"),b._emoticonsPane.addClass("hidden"),b._updateToolbarState(),b.RTE&&(b.RTE.disableFormatting(!0),b.RTE.focus()),this._updateCharCounter(b),"sms"===b.contact.get("network")&&b.node.one("li.mim-mode-im").addClass("hidden")},_handleModeChange:function(a){var b=this,c=a.get("mode"),d=a.node.one("div.mim-conversation");a.previous("mode")!==c&&"sms"===c?a.contact.get("mobileno")?(a.renderModeILN(c),this._updateUI(a)):b.promptPhoneNumber(a):"sms"===a.previous("mode")&&d.removeClass("mim-sms")},promptPhoneNumber:function(b){var c=a.Messenger.View.ViewUtils,g=this,h=f.substitute(e.str_conv_enter_phone_number_label,{conversation_user:b.contact.get("displayName")});c.confirm({title:e.str_conv_sms_input_title,message:d.sms_input({sms_label:h,countries:c.getPhoneCountries(),mobileno:b.contact.get("mobileno")||""}),callback:function(a){return c.validatePhoneNumber(a.mobileno)?(b.contact.set("mobileno",a.mobileno),b.contact.set("normalizedNumber",i.normalizeNumber(a.mobileno,a.country)),b.contact.editContact(),void g._handleModeChange(b)):e.str_add_error_phone},cancelCallback:function(){b.set("mode","im")}})},_updateCharCounter:function(a){var b,c,d,e=a.RTE;e&&(b=e&&e.getTextContent(),c=a.node.one("li.mim-character-counter"),d=this._getRemainingCount(a,b),d>=0?c.removeClass("mim-sms-overflow"):c.addClass("mim-sms-overflow"),c.setHTML(d))},_getRemainingCount:function(b,c){return this._getMaxSMSBytes(b)-a.Messenger.Common.SMSUtils.countUtf8Bytes(c)},_getMaxSMSBytes:function(a){return 158-Math.min(a.model.get("user").length,32)}},a.Messenger.View.ConvViewSMSPlugin=b,c.plugins=c.plugins||[],c.plugins.push(b)},"@VERSION@",{requires:["messenger-conversationview","messenger-smsutils","messenger-viewutils","tictac-mim-strings","tictac-mim-rollups","messenger-utils","messenger-constants"]});YUI.add("messenger-presenceplugin",function(a){"use strict";var b,c=a.Messenger.Common.Constants,d=a.Messenger.Common.Utils,e=a.Messenger.View.NewConversationView,f=a.Messenger.Model.SystemSettings,g=a.Messenger.Model.UserSettings,h=a.Messenger.View.ViewUtils,i=a.Messenger.Common.Stats,j=a.Tictac.mim.rollups,k=a.Tictac.mim.strings;b={initialize:function(b){this.host=b,b.presencePlugin=this,b.togglePresenceMenu=a.bind(this.togglePresenceMenu,this),b.events["click button.mim-presence-state"]="togglePresenceMenu"},setPresenceState:function(b){var d,e,f,l=this,m=l.host,n=b.currentTarget.ancestor("li",!0),o=n.getAttribute("data-action"),p=m.options.session,q=p.get("presenceState"),r=1===p.get("mpopInfo").totalEndpoints?"local":g.getPreference("mimLogoutPref");switch(o){case"setState":if(f=+n.getAttribute("data-state"),q!==f||p.get("presenceMessage"))if(f===c.STATE.OFFLINE)"prompt"===r?l._handleLogoutPrompt():(i.stat("status_signout"),i.stat("toggle",{ltxt:"signout"}),p.logout(r),h.flashWindow(!1),g.setPreference("cg.pref.im.loginpref",f),g.save());else{switch(f){case c.STATE.AVAILABLE:i.stat("status_available");break;case c.STATE.INVISIBLE:i.stat("status_invisible");break;default:i.stat("status_busy")}p.setPresence(f,""),g.setPreference("cg.pref.im.loginpref",f),g.save(),l.flashWindowUnreadMessages()}break;case"setStateCustom":i.stat("status_custom_old"),d=+n.getAttribute("data-state"),e=n.getAttribute("data-message"),p.setPresence(d,e),g.setPreference("cg.pref.im.loginpref",d),g.save(),l.flashWindowUnreadMessages();break;case"newCustomStatus":h.confirm({message:j.custom_status_dialog(),title:k.str_custom_status_title,callback:function(a){var b=a["mim-custom-busy"]?c.STATE.BUSY:c.STATE.AVAILABLE,d=a["mim-custom-status-input"]?a["mim-custom-status-input"].trim():"",e=g.getPreference("mimCustomPresenceArr")||[],f=!1;return d?(_.each(e,function(a){a.state===b&&a.message===d&&(f=!0)}),(d.toLowerCase()===h.getDefaultPresenceMessage(c.STATE.BUSY).toLowerCase()||d.toLowerCase()===h.getDefaultPresenceMessage(c.STATE.AVAILABLE).toLowerCase())&&(d="",f=!0),f||(e.push({state:b,message:d}),e.length>4&&e.shift(),g.setPreference("mimCustomPresenceArr",e)),i.stat("status_custom_new"),p.setPresence(b,d),g.setPreference("cg.pref.im.loginpref",b),g.save(),void l.flashWindowUnreadMessages()):k.str_conv_error_empty_general}}),a.one("#mim-custom-status-input").focus();break;case"history":yui.use("mail-ui-execute-search-utils").then(function(a){a.mail.ui.ExecuteSearchUtils.doMailSearch({searchType:"keyword",query:{keyword:"in:chats"},source:"Search_from_mim_history",shouldParseKeyword:!0,customTitle:{noLabel:!0,value:k.str_opt_msg_general_heading_history}})});break;case"messengeroptions":window.yui.fire("openOptions",{view:"messenger"})}l.togglePresenceMenu(),!b||b.clientX||b.clientY||h.focusOnPresenceStateMenu(b)},_handleLogoutPrompt:function(){var a=this.host,b=a.options.session;h.confirm({title:k.str_opt_msg_general_heading_logout,cssClass:"mim-logout-options-dialog",message:j.logout_options(),callback:function(a){var d=a["mim-logoutType"];i.stat("status_signout"),i.stat("toggle",{ltxt:"signout"}),"on"===a["mim-rememberLogoutPref"]&&g.setPreference("mimLogoutPref",d),b.logout(d),h.flashWindow(!1),g.setPreference("cg.pref.im.loginpref",c.STATE.OFFLINE),g.save()}})},updateContactListState:function(a){var b,c,e=this,f=e.host,g=a.get("presenceState"),i=d.normalizePresenceMessage(a.get("presenceMessage"))||h.getDefaultPresenceMessage(g);b=h.getStateName(g),f.node.one("#mim-cl-view").setAttribute("data-state",b),i&&(c=f.node.one("button.mim-presence-state .mim-presence-message"),c.setHTML(i))},flashWindowUnreadMessages:function(){var a=this.host.options.conversationWindow.get("unreadCount");if(1===a)return h.flashWindow(k.str_unread_messages_single),k.str_unread_messages_single;if(a>1){var b=d.substitute(k.str_unread_messages_plural,{count:a});return h.flashWindow(b),b}return 0},_handleKeyPresenceMenuItems:function(a){var b=a.currentTarget.ancestor("li.mim-menu-item",!0),c=b.previous("li.mim-menu-item"),d=b.next("li.mim-menu-item");38===a.keyCode?(null!==c?c.one("a").focus():b.ancestor("ul#mim-presence-menu").one("> li.mim-menu-item:last-of-type a").focus(),a.halt()):40===a.keyCode?(null!==d?d.one("a").focus():b.ancestor("ul#mim-presence-menu").one("> li.mim-menu-item a").focus(),a.halt()):27===a.keyCode&&(this.togglePresenceMenu(),h.focusOnPresenceStateMenu(a))},togglePresenceMenu:function(b){var c,d,e,i,k,l,m,n,o=a.one("#mim-presence-menu"),p=this,q=p.host,r=q.options.session;return o?(q._menuListener&&(q._menuListener.detach(),q._menuListener=null),q._scrollHandler&&(q._scrollHandler.detach(),q._scrollHandler=null),o.remove(!0),q._menuHideListener&&(q._menuHideListener.detach(),q._menuHideListener=null)):(k=r.get("presenceState"),l=r.get("presenceMessage"),o=a.Node.create(j.presence_menu({customPresenceArr:g.getPreference("mimCustomPresenceArr")||[],isOnline:r.isOnline()})),a.one(document.body).append(o),c=b?b.target.ancestor("button.mim-presence-state",!0):q.node.one("button.mim-presence-state"),d=c.get("region"),e=d.bottom-document.body.scrollTop,i=d.left,o.setStyle("left","-1000px"),e+o.get("offsetHeight")>document.body.offsetHeight&&(e=document.body.offsetHeight-o.get("offsetHeight"),i=d.right),o.setStyle("top",e),f.get("isRTL")?(o.setStyle("left","auto"),o.setStyle("right",h.getWindowSize().width-d.right)):o.setStyle("left",i),a.later(0,null,function(){a.one("#mim-presence-menu")&&(q._menuHideListener=a.on("mousedown",function(a){a.target.ancestor("#mim-presence-menu",!0)||p.togglePresenceMenu()},a.UA.ie?document:window))}),n=a.one("body").hasClass("fullpage")?a.UA.ie?document:window:a.one("#shellnavigation"),q._scrollHandler=a.once("scroll",function(){p.togglePresenceMenu()},n),l?o.all('li[data-state="'+k+'"]').each(function(a){a.getAttribute("data-message")===l&&a.addClass("checked")}):(m=o.one('li[data-state="'+k+'"]'),m&&m.addClass("checked")),h.limitToViewport(o),q._menuListener=o.delegate("click",a.bind(this.setPresenceState,this),"li.mim-menu-item"),o.delegate("keydown",a.bind(this._handleKeyPresenceMenuItems,this),"li.mim-menu-item")),!1}},a.Messenger.View.PresencePlugin=b,b.embedded=!0,e.plugins=e.plugins||[],e.plugins.push(b)},"1.0.0",{requires:["messenger-newconversationview","messenger-contactlist-css","tictac-mim-rollups","tictac-base-view","messenger-constants","messenger-conversation","tictac-mim-strings","messenger-usersettings","messenger-viewutils","messenger-utils","messenger-stats","messenger-systemsettings","event-hover","messenger-base-css","escape"]});"use strict";YUI.add("messenger-contactplugin",function(a){var b,c=a.Messenger.Common.Constants,d=a.Messenger.Common.Utils,e=a.Messenger.View.NewConversationView,f=a.Messenger.Model.SystemSettings,g=c.EVENTS,h=a.Messenger.View.ViewUtils,i=a.Messenger.Common.SMSUtils,j=a.Messenger.Common.Stats,k=a.Tictac.mim.rollups,l=a.Tictac.mim.strings;b={initialize:function(a){this.host=a,a.contactPlugin=this},showContactMenu:function(b){var c,e,g,i,m,n,o=this,p=o.host,q=b.contact,r=q.get("email"),s=!!r,t=window.strings&&window.strings.str_cfg_tog_hasSMS&&q.get("mobileno"),u=q.get("presenceMessage"),v=!!u,w=b.item.get("region");j.stat("right_click",{option:"menu"}),i=a.one("#mim-contact-menu"),i&&i.remove(),c=k.contact_menu({id:b.id,presenceMessage:u,user:q.get("user"),email:r,hasEmail:s,hasSMS:t,hasMessage:v,hasFavorites:b.favorites,isFavorite:q.get("topContact"),isBuddy:"buddy"===q.get("type"),appearOfflineMsg:d.substitute(l.str_menu_appear_offline,{contact_name:q.get("displayName")}),appearOnlineMsg:d.substitute(l.str_menu_appear_online,{contact_name:q.get("displayName")}),onInvisibleList:q.get("isInvisible"),onVisibleList:q.get("isVisible"),isInvisible:p.options.session.isInvisible()}),e=a.Node.create(c),a.one(document.body).append(e),e.removeClass("hidden"),m=w.top+w.height/2-e.get("offsetHeight")/2-document.body.scrollTop,f.get("isRTL")?(n=a.one("body").get("winWidth"),e.setStyle("right",n-b.leftPos+"px")):e.setStyle("left",b.leftPos+"px"),e.setStyle("top",m+"px"),p._menuHideListener=a.on("mousedown",function(a){a.target.ancestor("#mim-contact-menu")||o._hideContactMenu()},a.UA.ie?document:window),b.hover&&(p._menuLeaveListener=e.on("mouseleave",a.bind(o._hideContactMenu,o))),p._menuEnterListener=e.on("mouseenter",a.bind(o._hoverContactMenuEnter,o)),g=a.one("body").hasClass("fullpage")?a.UA.ie?document:window:a.one("#shellnavigation"),p._showContactScrollHandler=a.once("scroll",function(){o._hideContactMenu()},g),e.delegate("click",o._contactMenuClicked,"li[data-action]",o),h.limitToViewport(e)},_contactMenuClicked:function(b){var c,e=this,f=e.host,m=b.currentTarget,n=m.getAttribute("data-action"),o=m.ancestor("#mim-contact-menu"),p=o.getAttribute("data-id"),q=a.Messenger.View.ConversationListView.convListView,r=f.collection.get(p),s=r.get("user"),t=r.get("network"),u=f.options.session.get("loggedInId"),v=0===l.str_session_display_name_order.indexOf("{{lastName}}");switch(n){case"im":j.stat("im",{type:"right_click"}),j.stat("frnd"),q.showConversation(s,t,u);break;case"sms":j.stat("sms",{type:"right_click"}),q.showConversation(s,t,u,"sms");break;case"email":j.stat("email",{type:"right_click"}),c={cbfn:function(b,c){var d=a.mail.Core.feature("composev3").isOn(),e=d?{}:b.get("header");return e.to=[{name:r.get("displayName"),email:r.get("email")}],e.subject=c.subject||"",d?b.setHeader(e):b.set("header",e),!0}},yui.fire("newMessage",c);break;case"edit":j.stat("right_click",{option:"edit"}),h.confirm({title:l.str_cont_edit_cont,message:k.addcontact({user:s,lastNameFirst:v,isIE:!!a.UA.ie,firstName:r.get("firstName"),lastName:r.get("lastName"),email:r.get("email"),mobileno:r.get("mobileno")}),callback:function(b){var c,d={};return d.id=r.get("addressbookId"),(c=h.validateContactForm(b))?c:(_.each(b,function(a,b){d[b.toLowerCase()]=a}),r.editContact({user:s,network:t,addressbook:d,success:function(){var c=a.Messenger.Neo.yui;c.fire(g.CONTACTS_UPDATED,[{addressbookId:d.id,addressbook:d}]),r.set(b),r.set("normalizedNumber",i.normalizeNumber(b.mobileno))}}))}});break;case"delete":j.stat("right_click",{option:"delete"}),h.confirm({message:d.substitute(l.str_del_contact_msg_messenger_desc,{contact_highlighted:r.get("displayName")}),title:l.str_del_contact_msg_header,callback:function(){f.collection.deleteContact(p)}});break;case"favorite":j.stat("right_click",{option:"favorite"});break;case"unfavorite":j.stat("right_click",{option:"unfavorite"});break;case"visibility":f.options.session.isInvisible()?r.get("isVisible")?(j.stat("right_click",{option:"remove_from_visible"}),r.removeFromVisibleList()):(j.stat("right_click",{option:"add_to_visible"}),r.addToVisibleList()):r.get("isInvisible")?(j.stat("right_click",{option:"remove_from_invisible"}),r.removeFromInvisibleList()):(j.stat("right_click",{option:"add_to_invisible"}),r.addToInvisibleList())}e._hideContactMenu()},_hideContactMenu:function(){var b=a.one("#mim-contact-menu"),c=this,d=c.host;b&&(b.remove(!0),this._contactMenuFocused=!1,d._menuHideListener&&(d._menuHideListener.detach(),delete d._menuHideListener),d._menuLeaveListener&&(d._menuLeaveListener.detach(),delete d._menuLeaveListener),d._menuEnterListener&&(d._menuEnterListener.detach(),delete d._menuEnterListener),d._showContactScrollHandler&&(d._showContactScrollHandler.detach(),delete d._showContactScrollHandler))},_hoverContactMenuEnter:function(){this._contactMenuFocused=!0}},a.Messenger.View.ContactPlugin=b,e.plugins=e.plugins||[],e.plugins.push(b)},"1.0.0",{requires:["messenger-newconversationview","messenger-contactlist-css","tictac-mim-rollups","tictac-base-view","messenger-constants","messenger-conversation","tictac-mim-strings","messenger-usersettings","messenger-viewutils","messenger-utils","messenger-stats","messenger-systemsettings","event-hover","messenger-base-css","escape","mail-core-feature"]});