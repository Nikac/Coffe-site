YUI.add("mail-ui-imap-in",function(e){var t,n=e.mail,r=e.common.Utils,i=n.Controller.ImapIn,s=r.escapeHtml,o=n.FoldersView,u=r.ezSub,a="invisible",f="#accountListnav",l="single-account",c="multiple-account",h=e.one(f),p=e.one("#imapNavWrapper"),d=e.one("body"),v=NeoConfig.accounts.imapInAccounts&&NeoConfig.accounts.imapInAccounts.length+1||1,m=e.one("#storm-listnav"),g=n.ui.FolderUtils,y=[];t=function(){function t(t,r){var i=t.id,s=e.one('[data-fid="'+i+'"]');f(t,s,"start",r),r&&n(t,s,"start")}function n(e,t,n){var r=e.id,i="unsynced",s=g.getInboxFid(r),o;switch(n){case"start":s||(y.push(r),t.addClass(i),t.one(".status-icon").set("title",u(NeoConfig.strings.str_nav_left_pending_title,{account_name:e.email})));break;case"done":o=y.indexOf(r),o>-1&&y.splice(o,1),t.removeClass(i),t.one(".status-icon").set("title",strings.str_nav_left_syncing_title);break;default:}}function f(t,n,r,i){var s=NeoConfig.imapSyncTime*6e4,o=i?"syncing":"pending";switch(r){case"start":n.addClass(o),i?setTimeout(e.bind(f,null,n,"done"),s):n.one(".account-status").set("title",u(NeoConfig.strings.str_nav_left_pending_title,{account_name:t.email}));break;case"done":n.removeClass(o);break;default:}}function b(n){var r=n.status==="ENABLED",i,o;v++,v===2&&d.replaceClass(l,c),n=n||{},i=n.description||n.email,o=n.email,e.use("minty_module_shell_navigation_pane_account_item",function(){var a=e.ui.Templates.minty_module_shell_navigation_pane_account_item;h.append(e.Node.create(u(a.base,{account_icon:"icon-mail-inbox",account_title:o,account_text:s(i),account_id:n.id,isSelected:n.isPrimary?!0:!1,isPrimary:n.isPrimary?!0:!1,account_action:"load-account"},a))),t(n,r)})}function w(t){var n='[data-fid="'+t.id+'"]',r=e.one(n),i=NeoConfig.strings,o,u;r&&(o=t.description,o||(t.isPrimary?o=i.str_branding:o=t.email),u=r.one(".foldername"),u&&u.setHTML(s(o)))}function E(e){var t=e.id,n='[data-fid="'+t+'"]',r=p.one(n),s=i.getCurrentAccountId(),o=p.one(".account-item-li.primary");t!==Neo.getPrimaryAccountId()&&r&&v>1&&(v--,r.remove(),t===s&&x({currentTarget:o}),v===1&&d.replaceClass(c,l))}function S(t){t.preventDefault(),e.fire("openOptions",{view:"accounts"})}function x(t){var n=t.target,r=t.currentTarget,s=!r.hasClass("selected"),o=i.getCurrentAccountId(),u=r.getAttribute("data-fid"),a,f,l;if(r.hasClass("pending")||r.hasClass("unsynced"))return;if(n&&n.getAttribute("data-action")==="reauth"){t.halt(),e.fire("openOptions",{view:"accounts",subView:{sid:"edit",accId:u}});return}e.fire("accounts:select",{acctId:u,isPrimary:r.hasClass("primary"),switchAccount:s,prevAcctId:o}),e.fire("mt:click",{action:"account_switch_"+(u==="1"?"primary":"external")}),s?(i.setCurrentAccount(u),a=h.all(".account-item-li"),a.removeClass("selected"),r.addClass("selected")):(f=m.one(".in"),l=f.hasClass("selected"),l||(a=m.all(".sysfolder, .folder"),a.removeClass("selected"),f.addClass("selected")))}function T(t){e.use("mail-ui-folderevents",function(e){t.isAccount=!0,e.mail.ui.FolderEvents.handle(t)})}function N(t){var n=h.menu.getContextTarget(),r,i;if(n){t.target=n.ancestor(".account-item-li",!0),i=t.dataAction,r=t.target.getAttribute("data-fid");switch(i){case"account-new":e.fire("openOptions",{view:"accounts",subView:{sid:"add"}});break;case"account-rename":T(t);break;case"account-edit":e.fire("openOptions",{view:"accounts",subView:{sid:"edit",accId:r}})}e.fire("mt:click",{action:"cntxt_mnu_imap_acct_itm_"+i})}}function C(){var t=h.menu,n=t.getContextTarget().ancestor(".account-item-li"),r=e.one("#menu-account");r.setAttribute("data-context",n.hasClass("pending")||n.hasClass("unsynced")?"rclick-disabled":"")}function k(t){t.preventDefault(),e.use("common-ui-menu-helper","minty_module_shell_navigation_pane_account_menu",function(e){if(!h.menu){var n=e.common.ui.MenuHelper,r=e.ui.Templates.minty_module_shell_navigation_pane_account_menu,i=e.Node.create(u(r.base,{},r));d.append(i),n.create(h,{menu:i,isContext:!0,xy:[t.clientX,t.clientY],contextTarget:t.target,setVisibleCbk:C},function(){i.on("menuSelected",N)})}})}function L(t){var n=t.target,r=n.getAttribute("data-action");switch(r){case"manage-accounts":S(t);break;case"folder-search":e.use("mail-ui-folderevents",function(e){e.mail.ui.FolderEvents.handle({dataAction:"folder-search",target:t.currentTarget})});break;case"add-new-folder":e.fire("newfolder:pressed",n.getAttribute("id"));break;default:}}function A(t){var n,i,s,o,f;for(f in t)i=t[f],o=h.one('.account-item-li[data-fid="'+f+'"]'),o&&(s=o.one(".unread-count"),i.acctUnreadCount>0?(s.setHTML("("+r.getNormalizedMessageCount(i.acctUnreadCount)+")"),s.removeClass(a)):(s.addClass(a),s.setHTML("")),s.set("title",u(strings.str_nav_folder_unread_cnt,{unread_cnt:i.acctUnreadCount+""})));n=e.mail.model.DataStore.Accounts.getCurrentAccount(),n=n&&n.id||Neo.getPrimaryAccountId(),e.mail.FoldersView.updateFolderUnreadCountMarkup(t[n])}function O(){var t=p.one(".list-separator"),n="collapsed";p.hasClass(n)?(t.setAttribute("title",strings.str_nav_left_accounts_expanded),e.fire("mt:click",{action:"toggle_account_list_expand"})):(t.setAttribute("title",strings.str_nav_left_accounts_colapsed),e.fire("mt:click",{action:"toggle_account_list_collapse"})),p.toggleClass(n)}function M(){var t=window.Mousetrap;e.on("ds:account:add",b),e.on("ds:account:remove",E),e.on("ds:account:update",w),e.on("ds:folder:change",function(){var e=y.length,t,r,i,s;for(s=0;s<e;s++)t=y[s],g.getInboxFid(t)&&(r=h.one('[data-fid="'+t+'"]'),i={id:t},n(i,r,"done"))}),p.delegate("click",L,"a .btn-action"),h.delegate("click",x,"li"),h.delegate("contextmenu",k,"li"),h.delegate("dblclick",function(e){e.halt();if(e.currentTarget.hasClass("pending")||e.currentTarget.hasClass("unsynced"))return;o.handleFolderActions({dataAction:"account-rename",target:e.currentTarget,actionSource:"activeFolder",isAccount:!0})},"li"),p.one(".list-separator").on("click",O),t.bind(["command+shift+a","ctrl+shift+a"],S,"keydown")}function _(){M()}_(),e.mix(this,{updateAccountsUnreadCount:A,addAccountItemMarkup:b,updateAccountItemMarkup
:w,removeAccountItemMarkup:E,addSyncingMarkup:t,switchSyncingIcon:f,toggleAccounts:O,manageAccount:S,selectAccount:x,renameAccount:T,accountMenuSelected:N,accountContextMenu:k,handleImapNav:L,bindUI:M,init:_})},e.namespace("mail.ui").ImapIn=new t},"1.0.0",{requires:["common-utils","mail-controller-imapin","mail-ui-foldersview-base","mail-model-datastore","mail-ui-folder-utils"]});
