YUI.add("mail-ui-onboarding-configmap",function(e){e.namespace("mail.ui.onboarding").configMap={winAppOnboarding:{module:"mail-ui-windows-helper",afterDelay:0,closeTimeout:120},imapInPreV2:{closeTimeout:120,afterDelay:3600},winAppStoreOnboarding:{module:"mail-ui-onboarding-winapp-store",beforeDelay:120,afterDelay:120,closeTimeout:15},imapInPre:{closeTimeout:120,afterDelay:3600},imapInPost:{closeTimeout:300,beforeDelay:0,afterDelay:3600},archiveOnboarding:{closeTimeout:300,beforeDelay:0,afterDelay:3600},restoreInboxOnboarding:{closeTimeout:300,beforeDelay:0,afterDelay:3600},contactImportReonboarding:{closeTimeout:120,beforeDelay:0,afterDelay:3600},compromisedAccountOnboarding:{module:"mail-ui-onboarding-compromised-account",beforeDelay:0,afterDelay:3600,closeTimeout:1800},valentinesMenu:{beforeDelay:10,closeTimeout:300,afterDelay:120},valentinesStationery:{beforeDelay:0,closeTimeout:300,afterDelay:120},valentinesComposeAssist:{beforeDelay:0,closeTimeout:300,afterDelay:120},mailWebsearchOnboarding:{module:"mail-ui-onboarding-web-search",closeTimeout:15,beforeDelay:3600,afterDelay:3600},folderSearchOnboarding:{beforeDelay:120,afterDelay:120,closeTimeout:15},smartviewsOnboarding:{beforeDelay:3600,afterDelay:3600,closeTimeout:15},desktopNotificationsOnboarding:{module:"mail-ui-onboarding-desktop-notification",beforeDelay:3600,afterDelay:120,closeTimeout:15},composeAssistOnboarding:{module:"mail-ui-richcompose-view",beforeDelay:0,afterDelay:120,closeTimeout:60},composeAssistSpotlight:{module:"mail-ui-onboarding-compose-assist-spotlight",beforeDelay:0,afterDelay:120,closeTimeout:60},widerMailExtOnboarding:{beforeDelay:5,afterDelay:900,closeTimeout:20},newTabExtOnboarding:{beforeDelay:5,afterDelay:900,closeTimeout:20},restart:{module:"mail-ui-onboarding-restart",beforeDelay:0,afterDelay:0,closeTimeout:120},restartError:{beforeDelay:0,afterDelay:0,closeTimeout:120},restartOutro:{beforeDelay:0,afterDelay:30,closeTimeout:15},tripodInTray:{beforeDelay:0,afterDelay:0,closeTimeout:300},convTutorial:{beforeDelay:2,afterDelay:900,closeTimeout:20}}},"1.0.0",{requires:[]});
YUI.add("mail-ui-onboarding-calloutlist-model",function(e){function i(e){return r[e]?r[e].state==="skipped":!0}function s(e){return r[e]?r[e].state==="shown":!0}function o(){return t.isLaunchOnboardingShown()}function u(e){return r[e]&&r[e].pages.indexOf("launch")>=0}function a(e){return r[e]?r[e].state==="ready":!1}function f(e){return r[e]?!!r[e].force:!1}function l(e){r[e]&&!s(e)&&(r[e].state="skipped")}function c(e){r[e]&&(r[e].state="shown",r[e].pages.indexOf("launch")>=0&&t.setLaunchOnboardingShown(1))}function h(e){r[e]&&!s(e)&&(r[e].state="ready")}function p(t){return e.Lang.isObject(r[t])?r[t]:null}function d(e){var t,r,u;if(e==="launch"&&o())return null;if(!e||!n[e])return null;u=n[e];if(u){for(r=0;r<u.length;r++){t=u[r];if(t&&!s(t)&&!i(t)&&(a(t)||f(t)))return t}for(r=0;r<u.length;r++){t=u[r];if(t&&!s(t)&&!i(t))return t}}return e!=="default"?d("default"):null}function v(e){r[e]&&(r[e].state="")}function m(e){var t,r,s;if(!e||!n[e])return;s=n[e];for(t=0;t<s.length;t++)r=s[t],r&&i(r)&&v(r)}function g(){var i=e.Lang.isObject(NeoConfig.onboardingList)?t.wcopy(NeoConfig.onboardingList):{},s,o;for(s in i)if(i.hasOwnProperty(s)){n[s]=[];for(o in i[s])i[s].hasOwnProperty(o)&&(n[s][i[s][o].order]=o,r[o]?r[o].pages.push(s):(r[o]=i[s][o],r[o].pages=[s],r[o].state=""))}}var t=e.common.Utils,n={},r={};e.namespace("mail.ui.onboarding").calloutListModel={isSkipped:i,isShown:s,isReady:a,isLaunchCallout:u,isLaunchCalloutShown:o,markAsReady:h,markAsShown:c,markAsSkipped:l,getCalloutObj:p,resetCallout:v,resetAllSkippedCallouts:m,nextEligibleCallout:d},g()},"1.0.0",{requires:["common-utils"]});
YUI.add("mail-ui-onboarding-dispatcher",function(e){var t,n=e.common.Utils,r=n.settings.value("beforeCalloutDelay",30),i=n.settings.value("afterCalloutDelay",30),s=n.settings.value("closeCalloutDelay",30),o=n.settings.value("skipCalloutDelay",30),u={module:"mail-common-utils-features",beforeDelay:r,afterDelay:i,closeTimeout:s},a=e.mail.ui.onboarding.calloutListModel,f="",l="",c=Date.now(),h=Date.now(),p=null,d=null,v=null;t=function(){function t(){var t={messagepane:"read",convpane:"read",messagelist:"list",convlist:"list",author:"compose",search:"search"},n=e.mail.Tabs.getActiveTab(),r=n&&n.widget,i=r&&r.type;return t[i]?t[i]:"default"}function r(t,n){var r=e.mail.ui.onboarding.configMap[t];return r&&r[n]!==undefined?r[n]:u[n]?u[n]:null}function i(t,n){return e.Lang.isNumber(t)||(t=0),e.Lang.isNumber(n)||(n=0),Math.round(Math.max(t,n))}function m(t,n,r){r=r?1:0,e.fire("util:ymstats",{name:"scout_dispatcher",tags:{callout:t,action:n,isSystem:r},include:{bucket:!0}})}function g(e){return e&&e.cancel&&e.cancel(),null}function y(t){v=g(v);if(a.isShown(t)){x();return}if(NeoConfig.isRegOnboardingEnabled)return;l=t;if(!NeoGV.isWindowFocused){e.one("window").once("focus",function(){y(t)});return}e.use(r(t,"module"),function(e){E(t),e.fire("initCallout:"+t)})}function b(e){v=g(v),d=g(d),a.markAsSkipped(e),x()}function w(t){var n=r(f,"afterDelay");v=g(v),d=g(d),p=g(p),t&&e.fire("closeCallout:"+f),m(f,"close",t),f="",c=Date.now(),h=c+n*1e3,x()}function E(t){d=g(d),d=e.later(o*1e3,null,function(){!a.isSkipped(t)&&!a.isShown(t)&&(m(t,"skip",1),b(t))})}function S(t){var i=r(t,"closeTimeout");p=g(p),i<=30&&n.features.enabled("increaseCloseLatency")&&(i=s),p=e.later(i*1e3,null,function(){f===t&&w(!0)})}function x(s){var o,u,f,p,d;if(NeoConfig.isRegOnboardingEnabled)return;s||(s=t());if(v)return;o=a.nextEligibleCallout(s),l="";if(!o){v=null,s==="launch"&&x();return}u=r(o,"beforeDelay"),f=c+u*1e3,p=i(h,f),d=p-Date.now(),d<0||s==="launch"?d=0:n.features.enabled("forceCalloutDelay")&&(d=n.settings.value("fixCalloutDelay",3)*1e3),v=e.later(d,null,function(){m(o,"init",1),y(o)})}function T(t,n,r){var i={};m(t,"setKey",1),n.keygroup==="udb"?(i[t]=r,i.type="onboarding",e.fire("setUdbKey",i)):n.keygroup==="msdb"&&(e.mail.persist.MetaData.set(n.key,r),e.mail.persist.MetaData.save())}function N(e){var t=e.name,n=a.getCalloutObj(t);if(e.action&&n)switch(e.action){case"init":if(!a.isShown(t)&&(!a.isLaunchCalloutShown()||!a.isLaunchCallout(t))||e.force){a.markAsReady(t);if(!l||l===t)m(t,"init",0),y(t)}break;case"shown":a.isSkipped(t)||(a.markAsShown(t),f=t,d=g(d),m(t,"shown",0),S(t),e.keyValue&&T(t,n,e.keyValue));break;case"skip":a.isShown(t)||(b(t),m(t,"skip",0));break;case"close":f===t&&(w(!1),e.keyValue&&T(t,n,e.keyValue));break;default:}}function C(){v=g(v),a.resetAllSkippedCallouts(t());if(f){w(!0);return}x()}NeoGV.isWindowFocused=!0,e.mail.FoldersView.before("fidChange",function(t){var n=t.prevVal.fid||e.mail.ui.FolderUtils.getInboxFid();n!==t.newVal.fid&&C()},this),e.before("tabChange",C),e.on("callout:action",N),e.mix(this,{getActivePage:t,getCalloutConfig:r,setNextCalloutTimer:x,setCalloutKey:T})},e.namespace("mail.ui.onboarding").dispatcher=new t},"1.0.0",{requires:["common-ui-tabs-base","mail-common-utils-features","mail-ui-onboarding-configmap","mail-ui-onboarding-calloutlist-model","mail-persist-meta-data","mail-ui-foldersview-base","mail-ui-folder-utils"]});
