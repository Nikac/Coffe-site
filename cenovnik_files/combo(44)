YUI.add("tictac-smartviews-rollups",function(a){a.namespace("Tictac.smartviews.rollups"),a.Tictac.smartviews.rollups.container=a.Handlebars.template(function(a,b,c,d,e){function f(a,b){return"display:none;"}this.compilerInfo=[4,">= 1.0.0"],c=this.merge(c,a.helpers),e=e||{};var g,h,i="",j=this,k="function",l=c.blockHelperMissing;return i+='<li id="smartviews" class="openable nav-open" style="',h={hash:{},inverse:j.noop,fn:j.program(1,f,e),data:e},(g=c.is_hidden)?g=g.call(b,h):(g=b.is_hidden,g=typeof g===k?g.apply(b):g),c.is_hidden||(g=l.call(b,g,h)),(g||0===g)&&(i+=g),i+='">    <a class="section-title x-gap btn" href="#" aria-expanded="true" role="button" title="Click to hide Smart Views">        <span class="listnav-toggle icon"></span>        <span class="icon-text">Smart Views</span>    </a><ul id="smartviews-app-list" class="listnav-container" role="presentation"></ul></li>'}),a.Tictac.smartviews.rollups.smartviews_onboarding=a.Handlebars.template(function(a,b,c,d,e){return this.compilerInfo=[4,">= 1.0.0"],c=this.merge(c,a.helpers),e=e||{},'<div id="smartviewsOnboarding" class="convstooltip yui3-tooltips" style="width: 265px;">    <div class="tooltip-arrow-left" style="left: -9px; top: 11px; border-right: 10px solid #0654FC;; border-left-width: 0px; border-top: 10px solid transparent; border-bottom: 10px solid transparent;">        <div class="inner-arrow" style="border-right: 9px solid #fff; border-top: 9px solid transparent; border-bottom: 9px solid transparent; bottom: -9px; right: -10px;"></div>    </div>    <div class="modal tooltips-text" style="width: 265px; padding: 11px 20px 17px 20px; border: 1px solid #0078ff; box-sizing: border-box;">        <div class="modal-bd" style="padding: 0; padding-bottom: 11px;">            <div class="hd" style="font-size: 16px; font-weight: 700; margin-bottom: 7px;">                Smart filters for your email            </div>            <div class="bd" style="line-height: 16px;">                Automatic categories in <b>Smart Views</b> help you find your emails fast.            </div>        </div>        <div class="modal-ft" style="padding: 0;">            <button style="font-size: 12px; line-height: 12px; height: 25px; padding: 0; margin: 0; min-width: 50px; box-shadow: none;" class="btn left right default" data-action="ok">Got it</button>        </div>    <div></div>'}),a.Tictac.smartviews.rollups.systemcontainer=a.Handlebars.template(function(a,b,c,d,e){return this.compilerInfo=[4,">= 1.0.0"],c=this.merge(c,a.helpers),e=e||{},'<li id="system-app"><ul id="system-app-list"></ul></li>'}),a.Tictac.smartviews.rollups.view=a.Handlebars.template(function(a,b,c,d,e){function f(a,b){return'data-custom="true"'}function g(a,b){return'        <span class="icon icon-close listnav-item" title="Remove">        </span>    '}function h(a,b){return'        <span class="icon icon-settings listnav-item" title="Settings">        </span>    '}this.compilerInfo=[4,">= 1.0.0"],c=this.merge(c,a.helpers),e=e||{};var i,j="",k="function",l=this.escapeExpression,m=this;return j+='<li role="presentation"    class="btn-apps"    data-id="',(i=c.viewId)?i=i.call(b,{hash:{},data:e}):(i=b.viewId,i=typeof i===k?i.apply(b):i),j+=l(i)+'"    ',i=c.if.call(b,b.custom,{hash:{},inverse:m.noop,fn:m.program(1,f,e),data:e}),(i||0===i)&&(j+=i),j+=">    ",i=c.if.call(b,b.custom,{hash:{},inverse:m.noop,fn:m.program(3,g,e),data:e}),(i||0===i)&&(j+=i),j+="    ",i=c.if.call(b,b.settings,{hash:{},inverse:m.noop,fn:m.program(5,h,e),data:e}),(i||0===i)&&(j+=i),j+='    <a class="listnav-item btn"       href="#"       tabindex="-1"       title="',(i=c.title)?i=i.call(b,{hash:{},data:e}):(i=b.title,i=typeof i===k?i.apply(b):i),j+=l(i)+'">        ',(i=c.label)?i=i.call(b,{hash:{},data:e}):(i=b.label,i=typeof i===k?i.apply(b):i),j+=l(i)+"    </a></li>"})},"1.0.0",{requires:["handlebars-base"]});YUI.add("tictac-smartviews-strings",function(a){a.namespace("Tictac.smartviews").strings={str_smartviews_hide:"Click to hide Smart Views",str_smartviews_show:"Click to show Smart Views",last:null}},"1.0.0");"use strict";YUI.add("tictac-smartviews-controller",function(a){var b,c=a.Tictac.smartviews.rollups,d=a.Tictac.smartviews.strings,e=a.Tictac.base.mailpreferences;b={_entryQueue:[],_appQueue:[],init:function(b,c){var f,g=this,h=e.get("smartviewsCollapsedViews");g._appListNode=b,g._systemAppListNode=c,g._isInit||(g._appListNode&&("undefined"==typeof h?(e.set("smartviewsCollapsedViews",!1),e.save()):h&&(f=g._appListNode.one("a"),g._appListNode.removeClass("nav-open"),f.set("title",d.str_smartviews_show),f.set("aria-expanded",!1))),g.bindEvents(),g._isInit=!0,a.Array.each(g._appQueue,function(a){g.insertView(a)}),a.common.Utils.features.enabled("scout")?yui.on("initCallout:smartviewsOnboarding",function(){a.use("common-ui-tabs-base","tictac-smartviews-onboarding",function(a){var b=a.mail.Tabs.getActiveTab();b&&b.get("title")&&"inbox"===b.get("title").toLowerCase()?a.Tictac.smartviews.onboarding.renderSmartviewOnboarding():yui.fire("callout:action",{name:"smartviewsOnboarding",action:"skip"})})}):yui.on(["tabChange","tab:title"],function(b){var c=b.tab&&b.tab.get("title")||arguments[1]||"";"inbox"===c.toLowerCase()&&a.Tictac.smartviews.onboarding.renderSmartviewOnboarding()}))},addAppView:function(a,b,d,e){var f;return this.prepare(),f=yui.Node.create(c.view({viewId:a,label:b,title:b,custom:!!e})),f.setData("name",b),this.insertView(f),f},addView:function(a){return this.prepare(),a.node=yui.Node.create(c.view({viewId:a.viewId||a.name,label:a.name,title:a.title||a.name,custom:!!a.custom||"custom"===a.type,system:"system"===a.type,settings:!!a.settings})),a.node.setData("name",a.name),this.insertView(a),a.node},insertView:function(b){var c,d=this;d._isInit?(c="system"===b.type?d._systemAppListNode.one("ul#system-app-list"):d._appListNode.one("ul#smartviews-app-list"),c.append(b.node),d._appListNode&&d._appListNode.setStyle("display",""),"simple-important"===b.viewId&&b.settings&&a.use("tictac-important",function(a){a.Tictac.important.launcher()})):d._appQueue.push(b)},revealView:function(a){var b;this._appListNode&&(this.setOpen(),b=this._appListNode.one('[data-id="'+a+'"]'),b.scrollIntoView())},updateView:function(a){var b=this._systemAppListNode.one('[data-id="'+a.viewId+'"]');b.one("a").set("title",a.name).set("text",a.name)},renameView:function(b){function c(){var c=a.Escape.html(i.get("value"));c&&c!==h&&(g.set("title",c).set("text",c),b.setData("name",c),b.fire("rename",c)),d()}function d(){b.removeClass("smartview-edit"),i.remove(),a.Array.each(f,function(a){a.detach()}),window.removeEventListener("click",e,!0)}function e(a){a.target!==i.getDOMNode()&&c()}var f=[],g=b.one("a"),h=b.getData("name"),i=a.Node.create('<input type="text" id="saved-search-rename"></input>').set("value",h).setStyles({position:"fixed","z-index":1e4,top:g.getY(),left:g.getX()+10,width:g.get("offsetWidth")-10});f.push(i.on("keydown",function(a){switch(a.keyCode){case 13:c();break;case 27:d()}a.stopPropagation()})),window.addEventListener("click",e,!0),b.addClass("smartview-edit"),a.one("body").append(i),i.focus(),i.getDOMNode().setSelectionRange(0,h.length)},removeView:function(a){var b,c,d;if(this._appListNode&&(b=this._appListNode.one('[data-id="'+a+'"]')),b)b.remove();else for(c=0;this._entryQueue&&c<this._entryQueue.length;c++)d=this._entryQueue[c],d.viewId===a&&this._entryQueue.splice(c,1);return b},hideView:function(a){var b,c,d;if(this._appListNode&&(b=this._appListNode.one('[data-id="'+a+'"]')),b)b.setStyle("display","none");else for(c=0;this._entryQueue&&c<this._entryQueue.length;c++)d=this._entryQueue[c],d.viewId===a&&(d.is_hidden=!0);return b},createTab:function(b){return b.widget||(b.widget=new a.mail.ui.BaseWidget),b.hideToolbar&&(b.widget.set("hideToolbar",!0),b.forcePane=!0),b.hideNavbar&&(b.widget.set("hideNavbar",!0),b.forcePane=!0),void 0!==b.noDefault&&(b.noDefault=!0),void 0!==b.sync&&(b.sync=!0),a.mail.ui.Workspace.addContentWidget(b)},isOpen:function(){return this._appListNode.hasClass("nav-open")},setOpen:function(){this.isOpen()||this._appListNode.one("a").getDOMNode().click()},bindEvents:function(){var b=this,c=a.one("#storm-listnav"),f=".folder, .sysfolder, .btn-apps",g="selected";return b.prepare(),b._appListNode?(b._appListNode.setAttribute("data-posIdx",0),b._appListNode.delegate("keydown",function(d){var e,h,i=1*b._appListNode.getAttribute("data-posIdx"),j=a.all("#smartviews a")._nodes,k=j[i],l=d.keyCode,m=d.currentTarget;40===l?i<j.length-1&&(k.setAttribute("tabindex",-1),i+=1,e=j[i],e.setAttribute("tabindex",0),e.focus()):38===l?i>0&&(k.setAttribute("tabindex",-1),i-=1,h=j[i],h.setAttribute("tabindex",0),h.focus()):13===l&&(c.all(f).removeClass(g),k.setAttribute("tabindex",0),m.get("parentNode").addClass(g)),b._appListNode.setAttribute("data-posIdx",i)},"a"),b._appListNode.one("a").on("click",function(){var a=b._appListNode.one("a");b.isOpen()?(a.set("title",d.str_smartviews_show),a.set("aria-expanded",!1),e.set("CollapsedViews",!0,"smartviews")):(a.set("title",d.str_smartviews_hide),a.set("aria-expanded",!0),e.set("CollapsedViews",!1,"smartviews")),e.save()}),b._appListNode.delegate("click",function(a){var b=a.currentTarget,d=b.ancestor("[data-id]");return c.all(f).removeClass(g),b.get("parentNode").addClass(g),d.fire("launch"),a.halt(),!1},"li a"),b._systemAppListNode.delegate("click",function(a){var b=a.currentTarget,d=b.ancestor("[data-id]");return c.all(f).removeClass(g),b.get("parentNode").addClass(g),d.fire("launch"),a.halt(),!1},"li a"),b._appListNode.delegate("dblclick",function(a){var c=a.currentTarget,d=c.ancestor("[data-id]"),e=d.hasAttribute("data-custom");return e&&b.renameView(d),a.halt(),!1},"li a"),b._appListNode.delegate("click",function(a){var c=a.currentTarget,d=c.ancestor("[data-id]"),e=d.getAttribute("data-id");return b.removeView(e),d.fire("remove"),a.halt(),!1},"li .icon-close"),b._appListNode.delegate("click",function(a){var b=a.currentTarget,c=b.ancestor("[data-id]"),d=c.getAttribute("data-id");return yui.fire(d+":settings"),!1},"li .icon-settings"),void b._systemAppListNode.delegate("click",function(a){var b=a.currentTarget,c=b.ancestor("[data-id]"),d=c.getAttribute("data-id");return yui.fire(d+":settings"),!1},"li .icon-settings")):!1},prepare:function(){a.Tictac.smartviews.on||a.augment(a.Tictac.smartviews,a.EventTarget)}},a.mix(a.Tictac.smartviews,b)},"1.0.0",{requires:["tictac-smartviews","tictac-smartviews-rollups","mail-common-utils-features","tictac-smartviews-onboarding","event-custom","tictac-smartviews-strings","tictac-base-mailpreferences","tictac-smartviews-css","escape"]});